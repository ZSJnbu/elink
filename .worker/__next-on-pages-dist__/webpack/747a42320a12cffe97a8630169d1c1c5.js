var Tt={},ln=(Ks,ir,Hs)=>(Tt.__chunk_84960=(lt,He,me)=>{"use strict";me.d(He,{Q:()=>ee});var h=me(31054),W=me(11914);let n="https://api.openai.com/v1",Oe="gpt-4o-mini",ee=(0,h.v)()((0,W.Zr)((M,C)=>({apiKey:null,baseUrl:n,model:Oe,provider:"openai",setAPIKey:x=>M({apiKey:x}),setBaseUrl:x=>M({baseUrl:x}),setModel:x=>M({model:x}),setProvider:x=>{M(x==="openai"?{provider:x,baseUrl:n,model:Oe}:{provider:x})},clearSettings:()=>M({apiKey:null,baseUrl:n,model:Oe,provider:"openai"}),hasAPIKey:()=>!!C().apiKey}),{name:"api-settings-storage",partialize:M=>({apiKey:M.apiKey,baseUrl:M.baseUrl,model:M.model,provider:M.provider})}))},Tt.__chunk_24846=(lt,He,me)=>{"use strict";function h(W,n){function Oe(M){return n?[n(M),void 0]:[M instanceof Error?M:Error(String(M)),void 0]}function ee(M){return[void 0,M]}if(typeof W=="function")try{return ee(W())}catch(M){return Oe(M)}return W.then(ee).catch(Oe)}me.d(He,{W:()=>h})},Tt.__chunk_918=(lt,He,me)=>{"use strict";me.d(He,{s:()=>Oe});var h=me(31054),W=me(11914);function n(ee){try{return new URL(ee.startsWith("http")?ee:`https://${ee}`).hostname.replace(/^www\./,"")}catch{return ee.toLowerCase()}}let Oe=(0,h.v)()((0,W.Zr)(ee=>({blacklist:[],preferredSites:[],addToBlacklist:M=>ee(C=>{let x=n(M);return C.blacklist.some(q=>q.domain===x)?C:{blacklist:[...C.blacklist,{domain:x,addedAt:new Date().toISOString()}]}}),removeFromBlacklist:M=>ee(C=>({blacklist:C.blacklist.filter(x=>x.domain!==M)})),addToPreferredSites:M=>ee(C=>{if(C.preferredSites.length>=3)return C;let x=n(M);return C.preferredSites.some(q=>q.domain===x)?C:{preferredSites:[...C.preferredSites,{domain:x,addedAt:new Date().toISOString()}]}}),removeFromPreferredSites:M=>ee(C=>({preferredSites:C.preferredSites.filter(x=>x.domain!==M)}))}),{name:"site-preferences"}))},Tt.__chunk_96848=(lt,He,me)=>{me.d(He,{Ch:()=>Z,Di:()=>Ot,Kq:()=>gt,M3:()=>k,Tt:()=>mt,b8:()=>g,bD:()=>J,cj:()=>Te,eM:()=>F,hL:()=>st,iM:()=>z,k9:()=>_e,u1:()=>_t,u6:()=>Ue,xn:()=>be});var h,W,n,Oe,ee,M,C,x,q,he,ce,Ce,ge="vercel.ai.error",je=Symbol.for(ge),tt=class ba extends Error{constructor({name:w,message:re,cause:ie}){super(re),this[h]=!0,this.name=w,this.cause=ie}static isInstance(w){return ba.hasMarker(w,ge)}static hasMarker(w,re){let ie=Symbol.for(re);return w!=null&&typeof w=="object"&&ie in w&&typeof w[ie]=="boolean"&&w[ie]===!0}};h=je;var J=tt,ct="AI_APICallError",f=`vercel.ai.error.${ct}`,ae=Symbol.for(f),st=class extends J{constructor({message:y,url:w,requestBodyValues:re,statusCode:ie,responseHeaders:we,responseBody:Y,cause:$e,isRetryable:Be=ie!=null&&(ie===408||ie===409||ie===429||ie>=500),data:de}){super({name:ct,message:y,cause:$e}),this[W]=!0,this.url=w,this.requestBodyValues=re,this.statusCode=ie,this.responseHeaders=we,this.responseBody=Y,this.isRetryable=Be,this.data=de}static isInstance(y){return J.hasMarker(y,f)}};W=ae;var Se="AI_EmptyResponseBodyError",i=`vercel.ai.error.${Se}`,dt=Symbol.for(i),mt=class extends J{constructor({message:y="Empty response body"}={}){super({name:Se,message:y}),this[n]=!0}static isInstance(y){return J.hasMarker(y,i)}};function _t(y){return y==null?"unknown error":typeof y=="string"?y:y instanceof Error?y.message:JSON.stringify(y)}n=dt;var Nt="AI_InvalidArgumentError",Mt=`vercel.ai.error.${Nt}`,fe=Symbol.for(Mt),Ot=class extends J{constructor({message:y,cause:w,argument:re}){super({name:Nt,message:y,cause:w}),this[Oe]=!0,this.argument=re}static isInstance(y){return J.hasMarker(y,Mt)}};Oe=fe;var qt="AI_InvalidPromptError",_=`vercel.ai.error.${qt}`,j=Symbol.for(_),k=class extends J{constructor({prompt:y,message:w,cause:re}){super({name:qt,message:`Invalid prompt: ${w}`,cause:re}),this[ee]=!0,this.prompt=y}static isInstance(y){return J.hasMarker(y,_)}};ee=j;var E="AI_InvalidResponseDataError",te=`vercel.ai.error.${E}`,Ee=Symbol.for(te),be=class extends J{constructor({data:y,message:w=`Invalid response data: ${JSON.stringify(y)}.`}){super({name:E,message:w}),this[M]=!0,this.data=y}static isInstance(y){return J.hasMarker(y,te)}};M=Ee;var ye="AI_JSONParseError",Ae=`vercel.ai.error.${ye}`,We=Symbol.for(Ae),Ue=class extends J{constructor({text:y,cause:w}){super({name:ye,message:`JSON parsing failed: Text: ${y}.
Error message: ${_t(w)}`,cause:w}),this[C]=!0,this.text=y}static isInstance(y){return J.hasMarker(y,Ae)}};C=We;var ne="AI_LoadAPIKeyError",rt=`vercel.ai.error.${ne}`,nt=Symbol.for(rt),gt=class extends J{constructor({message:y}){super({name:ne,message:y}),this[x]=!0}static isInstance(y){return J.hasMarker(y,rt)}};x=nt;var V=Symbol.for("vercel.ai.error.AI_LoadSettingError"),Ut=Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),u="AI_NoSuchModelError",b=`vercel.ai.error.${u}`,S=Symbol.for(b),F=class extends J{constructor({errorName:y=u,modelId:w,modelType:re,message:ie=`No such ${re}: ${w}`}){super({name:y,message:ie}),this[q]=!0,this.modelId=w,this.modelType=re}static isInstance(y){return J.hasMarker(y,b)}};q=S;var A="AI_TooManyEmbeddingValuesForCallError",L=`vercel.ai.error.${A}`,D=Symbol.for(L),Z=class extends J{constructor(y){super({name:A,message:`Too many values for a single embedding call. The ${y.provider} model "${y.modelId}" can only embed up to ${y.maxEmbeddingsPerCall} values per call, but ${y.values.length} values were provided.`}),this[he]=!0,this.provider=y.provider,this.modelId=y.modelId,this.maxEmbeddingsPerCall=y.maxEmbeddingsPerCall,this.values=y.values}static isInstance(y){return J.hasMarker(y,L)}};he=D;var $="AI_TypeValidationError",O=`vercel.ai.error.${$}`,X=Symbol.for(O),N=class wr extends J{constructor({value:w,cause:re}){super({name:$,message:`Type validation failed: Value: ${JSON.stringify(w)}.
Error message: ${_t(re)}`,cause:re}),this[ce]=!0,this.value=w}static isInstance(w){return J.hasMarker(w,O)}static wrap({value:w,cause:re}){return wr.isInstance(re)&&re.value===w?re:new wr({value:w,cause:re})}};ce=X;var z=N,oe="AI_UnsupportedFunctionalityError",U=`vercel.ai.error.${oe}`,I=Symbol.for(U),g=class extends J{constructor({functionality:y,message:w=`'${y}' functionality not supported.`}){super({name:oe,message:w}),this[Ce]=!0,this.functionality=y}static isInstance(y){return J.hasMarker(y,U)}};function T(y){return y===null||typeof y=="string"||typeof y=="number"||typeof y=="boolean"||(Array.isArray(y)?y.every(T):typeof y=="object"&&Object.entries(y).every(([w,re])=>typeof w=="string"&&T(re)))}function Te(y){return Array.isArray(y)&&y.every(T)}function _e(y){return y!=null&&typeof y=="object"&&Object.entries(y).every(([w,re])=>typeof w=="string"&&T(re))}Ce=I},Tt.__chunk_74313=(lt,He,me)=>{me.d(He,{N:()=>Ut,r:()=>V});var h=me(36528),W=me(96848),n=me(71023);function Oe(u){var b,S;return(S=(b=u?.content)==null?void 0:b.map(({token:F,logprob:A,top_logprobs:L})=>({token:F,logprob:A,topLogprobs:L?L.map(({token:D,logprob:Z})=>({token:D,logprob:Z})):[]})))!=null?S:void 0}function ee(u){switch(u){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var M=n.Ik({error:n.Ik({message:n.Yj(),type:n.Yj().nullish(),param:n.bz().nullish(),code:n.KC([n.Yj(),n.ai()]).nullish()})}),C=(0,h.sl)({errorSchema:M,errorToMessage:u=>u.error.message});function x({id:u,model:b,created:S}){return{id:u??void 0,modelId:b??void 0,timestamp:S!=null?new Date(1e3*S):void 0}}var q=class{constructor(u,b,S){this.specificationVersion="v1",this.modelId=u,this.settings=b,this.config=S}get supportsStructuredOutputs(){var u;return(u=this.settings.structuredOutputs)!=null?u:ge(this.modelId)}get defaultObjectGenerationMode(){return this.modelId.startsWith("gpt-4o-audio-preview")?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:u,prompt:b,maxTokens:S,temperature:F,topP:A,topK:L,frequencyPenalty:D,presencePenalty:Z,stopSequences:$,responseFormat:O,seed:X,providerMetadata:N}){var z,oe,U,I,g,T,Te,_e,y,w,re;let ie=u.type,we=[];L!=null&&we.push({type:"unsupported-setting",setting:"topK"}),O?.type!=="json"||O.schema==null||this.supportsStructuredOutputs||we.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let Y=this.settings.useLegacyFunctionCalling;if(Y&&this.settings.parallelToolCalls===!0)throw new W.b8({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(Y&&this.supportsStructuredOutputs)throw new W.b8({functionality:"structuredOutputs with useLegacyFunctionCalling"});let{messages:$e,warnings:Be}=function({prompt:ze,useLegacyFunctionCalling:R=!1,systemMessageMode:Le="system"}){let Pe=[],Xe=[];for(let{role:ke,content:Ie}of ze)switch(ke){case"system":switch(Le){case"system":Pe.push({role:"system",content:Ie});break;case"developer":Pe.push({role:"developer",content:Ie});break;case"remove":Xe.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${Le}`)}break;case"user":if(Ie.length===1&&Ie[0].type==="text"){Pe.push({role:"user",content:Ie[0].text});break}Pe.push({role:"user",content:Ie.map((Q,le)=>{var Qe,ut,jt,wt;switch(Q.type){case"text":return{type:"text",text:Q.text};case"image":return{type:"image_url",image_url:{url:Q.image instanceof URL?Q.image.toString():`data:${(Qe=Q.mimeType)!=null?Qe:"image/jpeg"};base64,${(0,h.n_)(Q.image)}`,detail:(jt=(ut=Q.providerMetadata)==null?void 0:ut.openai)==null?void 0:jt.imageDetail}};case"file":if(Q.data instanceof URL)throw new W.b8({functionality:"'File content parts with URL data' functionality not supported."});switch(Q.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:Q.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:Q.data,format:"mp3"}};case"application/pdf":return{type:"file",file:{filename:(wt=Q.filename)!=null?wt:`part-${le}.pdf`,file_data:`data:application/pdf;base64,${Q.data}`}};default:throw new W.b8({functionality:`File content part type ${Q.mimeType} in user messages`})}}})});break;case"assistant":{let Q="",le=[];for(let Qe of Ie)switch(Qe.type){case"text":Q+=Qe.text;break;case"tool-call":le.push({id:Qe.toolCallId,type:"function",function:{name:Qe.toolName,arguments:JSON.stringify(Qe.args)}})}if(R){if(le.length>1)throw new W.b8({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});Pe.push({role:"assistant",content:Q,function_call:le.length>0?le[0].function:void 0})}else Pe.push({role:"assistant",content:Q,tool_calls:le.length>0?le:void 0});break}case"tool":for(let Q of Ie)R?Pe.push({role:"function",name:Q.toolName,content:JSON.stringify(Q.result)}):Pe.push({role:"tool",tool_call_id:Q.toolCallId,content:JSON.stringify(Q.result)});break;default:throw Error(`Unsupported role: ${ke}`)}return{messages:Pe,warnings:Xe}}({prompt:b,useLegacyFunctionCalling:Y,systemMessageMode:ge(y=this.modelId)?(re=(w=je[y])==null?void 0:w.systemMessageMode)!=null?re:"developer":"system"});we.push(...Be);let de={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"||void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:S,temperature:F,top_p:A,frequency_penalty:D,presence_penalty:Z,response_format:O?.type==="json"?this.supportsStructuredOutputs&&O.schema!=null?{type:"json_schema",json_schema:{schema:O.schema,strict:!0,name:(z=O.name)!=null?z:"response",description:O.description}}:{type:"json_object"}:void 0,stop:$,seed:X,max_completion_tokens:(oe=N?.openai)==null?void 0:oe.maxCompletionTokens,store:(U=N?.openai)==null?void 0:U.store,metadata:(I=N?.openai)==null?void 0:I.metadata,prediction:(g=N?.openai)==null?void 0:g.prediction,reasoning_effort:(Te=(T=N?.openai)==null?void 0:T.reasoningEffort)!=null?Te:this.settings.reasoningEffort,messages:$e};switch(ge(this.modelId)?(de.temperature!=null&&(de.temperature=void 0,we.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),de.top_p!=null&&(de.top_p=void 0,we.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),de.frequency_penalty!=null&&(de.frequency_penalty=void 0,we.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),de.presence_penalty!=null&&(de.presence_penalty=void 0,we.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),de.logit_bias!=null&&(de.logit_bias=void 0,we.push({type:"other",message:"logitBias is not supported for reasoning models"})),de.logprobs!=null&&(de.logprobs=void 0,we.push({type:"other",message:"logprobs is not supported for reasoning models"})),de.top_logprobs!=null&&(de.top_logprobs=void 0,we.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),de.max_tokens!=null&&(de.max_completion_tokens==null&&(de.max_completion_tokens=de.max_tokens),de.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&de.temperature!=null&&(de.temperature=void 0,we.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),ie){case"regular":{let{tools:ze,tool_choice:R,functions:Le,function_call:Pe,toolWarnings:Xe}=function({mode:ke,useLegacyFunctionCalling:Ie=!1,structuredOutputs:Q}){var le;let Qe=(le=ke.tools)!=null&&le.length?ke.tools:void 0,ut=[];if(Qe==null)return{tools:void 0,tool_choice:void 0,toolWarnings:ut};let jt=ke.toolChoice;if(Ie){let ft=[];for(let kt of Qe)kt.type==="provider-defined"?ut.push({type:"unsupported-tool",tool:kt}):ft.push({name:kt.name,description:kt.description,parameters:kt.parameters});if(jt==null)return{functions:ft,function_call:void 0,toolWarnings:ut};switch(jt.type){case"auto":case"none":case void 0:return{functions:ft,function_call:void 0,toolWarnings:ut};case"required":throw new W.b8({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:ft,function_call:{name:jt.toolName},toolWarnings:ut}}}let wt=[];for(let ft of Qe)ft.type==="provider-defined"?ut.push({type:"unsupported-tool",tool:ft}):wt.push({type:"function",function:{name:ft.name,description:ft.description,parameters:ft.parameters,strict:!!Q||void 0}});if(jt==null)return{tools:wt,tool_choice:void 0,toolWarnings:ut};let rr=jt.type;switch(rr){case"auto":case"none":case"required":return{tools:wt,tool_choice:rr,toolWarnings:ut};case"tool":return{tools:wt,tool_choice:{type:"function",function:{name:jt.toolName}},toolWarnings:ut};default:throw new W.b8({functionality:`Unsupported tool choice type: ${rr}`})}}({mode:u,useLegacyFunctionCalling:Y,structuredOutputs:this.supportsStructuredOutputs});return{args:{...de,tools:ze,tool_choice:R,functions:Le,function_call:Pe},warnings:[...we,...Xe]}}case"object-json":return{args:{...de,response_format:this.supportsStructuredOutputs&&u.schema!=null?{type:"json_schema",json_schema:{schema:u.schema,strict:!0,name:(_e=u.name)!=null?_e:"response",description:u.description}}:{type:"json_object"}},warnings:we};case"object-tool":return{args:Y?{...de,function_call:{name:u.tool.name},functions:[{name:u.tool.name,description:u.tool.description,parameters:u.tool.parameters}]}:{...de,tool_choice:{type:"function",function:{name:u.tool.name}},tools:[{type:"function",function:{name:u.tool.name,description:u.tool.description,parameters:u.tool.parameters,strict:!!this.supportsStructuredOutputs||void 0}}]},warnings:we};default:throw Error(`Unsupported type: ${ie}`)}}async doGenerate(u){var b,S,F,A,L,D,Z,$;let{args:O,warnings:X}=this.getArgs(u),{responseHeaders:N,value:z,rawValue:oe}=await(0,h.GU)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,h.m2)(this.config.headers(),u.headers),body:O,failedResponseHandler:C,successfulResponseHandler:(0,h.cV)(ce),abortSignal:u.abortSignal,fetch:this.config.fetch}),{messages:U,...I}=O,g=z.choices[0],T=(b=z.usage)==null?void 0:b.completion_tokens_details,Te=(S=z.usage)==null?void 0:S.prompt_tokens_details,_e={openai:{}};return T?.reasoning_tokens!=null&&(_e.openai.reasoningTokens=T?.reasoning_tokens),T?.accepted_prediction_tokens!=null&&(_e.openai.acceptedPredictionTokens=T?.accepted_prediction_tokens),T?.rejected_prediction_tokens!=null&&(_e.openai.rejectedPredictionTokens=T?.rejected_prediction_tokens),Te?.cached_tokens!=null&&(_e.openai.cachedPromptTokens=Te?.cached_tokens),{text:(F=g.message.content)!=null?F:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&g.message.function_call?[{toolCallType:"function",toolCallId:(0,h.$C)(),toolName:g.message.function_call.name,args:g.message.function_call.arguments}]:(A=g.message.tool_calls)==null?void 0:A.map(y=>{var w;return{toolCallType:"function",toolCallId:(w=y.id)!=null?w:(0,h.$C)(),toolName:y.function.name,args:y.function.arguments}}),finishReason:ee(g.finish_reason),usage:{promptTokens:(D=(L=z.usage)==null?void 0:L.prompt_tokens)!=null?D:NaN,completionTokens:($=(Z=z.usage)==null?void 0:Z.completion_tokens)!=null?$:NaN},rawCall:{rawPrompt:U,rawSettings:I},rawResponse:{headers:N,body:oe},request:{body:JSON.stringify(O)},response:x(z),warnings:X,logprobs:Oe(g.logprobs),providerMetadata:_e}}async doStream(u){let b;if(this.settings.simulateStreaming){let I=await this.doGenerate(u);return{stream:new ReadableStream({start(g){if(g.enqueue({type:"response-metadata",...I.response}),I.text&&g.enqueue({type:"text-delta",textDelta:I.text}),I.toolCalls)for(let T of I.toolCalls)g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:T.toolCallId,toolName:T.toolName,argsTextDelta:T.args}),g.enqueue({type:"tool-call",...T});g.enqueue({type:"finish",finishReason:I.finishReason,usage:I.usage,logprobs:I.logprobs,providerMetadata:I.providerMetadata}),g.close()}}),rawCall:I.rawCall,rawResponse:I.rawResponse,warnings:I.warnings}}let{args:S,warnings:F}=this.getArgs(u),A={...S,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:L,value:D}=await(0,h.GU)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,h.m2)(this.config.headers(),u.headers),body:A,failedResponseHandler:C,successfulResponseHandler:(0,h.Ds)(Ce),abortSignal:u.abortSignal,fetch:this.config.fetch}),{messages:Z,...$}=S,O=[],X="unknown",N={promptTokens:void 0,completionTokens:void 0},z=!0,{useLegacyFunctionCalling:oe}=this.settings,U={openai:{}};return{stream:D.pipeThrough(new TransformStream({transform(I,g){var T,Te,_e,y,w,re,ie,we,Y,$e,Be,de;if(!I.success){X="error",g.enqueue({type:"error",error:I.error});return}let ze=I.value;if("error"in ze){X="error",g.enqueue({type:"error",error:ze.error});return}if(z&&(z=!1,g.enqueue({type:"response-metadata",...x(ze)})),ze.usage!=null){let{prompt_tokens:ke,completion_tokens:Ie,prompt_tokens_details:Q,completion_tokens_details:le}=ze.usage;N={promptTokens:ke??void 0,completionTokens:Ie??void 0},le?.reasoning_tokens!=null&&(U.openai.reasoningTokens=le?.reasoning_tokens),le?.accepted_prediction_tokens!=null&&(U.openai.acceptedPredictionTokens=le?.accepted_prediction_tokens),le?.rejected_prediction_tokens!=null&&(U.openai.rejectedPredictionTokens=le?.rejected_prediction_tokens),Q?.cached_tokens!=null&&(U.openai.cachedPromptTokens=Q?.cached_tokens)}let R=ze.choices[0];if(R?.finish_reason!=null&&(X=ee(R.finish_reason)),R?.delta==null)return;let Le=R.delta;Le.content!=null&&g.enqueue({type:"text-delta",textDelta:Le.content});let Pe=Oe(R?.logprobs);Pe?.length&&(b===void 0&&(b=[]),b.push(...Pe));let Xe=oe&&Le.function_call!=null?[{type:"function",id:(0,h.$C)(),function:Le.function_call,index:0}]:Le.tool_calls;if(Xe!=null)for(let ke of Xe){let Ie=ke.index;if(O[Ie]==null){if(ke.type!=="function")throw new W.xn({data:ke,message:"Expected 'function' type."});if(ke.id==null)throw new W.xn({data:ke,message:"Expected 'id' to be a string."});if(((T=ke.function)==null?void 0:T.name)==null)throw new W.xn({data:ke,message:"Expected 'function.name' to be a string."});O[Ie]={id:ke.id,type:"function",function:{name:ke.function.name,arguments:(Te=ke.function.arguments)!=null?Te:""},hasFinished:!1};let le=O[Ie];((_e=le.function)==null?void 0:_e.name)!=null&&((y=le.function)==null?void 0:y.arguments)!=null&&(le.function.arguments.length>0&&g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:le.id,toolName:le.function.name,argsTextDelta:le.function.arguments}),(0,h.v0)(le.function.arguments)&&(g.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(w=le.id)!=null?w:(0,h.$C)(),toolName:le.function.name,args:le.function.arguments}),le.hasFinished=!0));continue}let Q=O[Ie];!Q.hasFinished&&(((re=ke.function)==null?void 0:re.arguments)!=null&&(Q.function.arguments+=(we=(ie=ke.function)==null?void 0:ie.arguments)!=null?we:""),g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:Q.id,toolName:Q.function.name,argsTextDelta:(Y=ke.function.arguments)!=null?Y:""}),(($e=Q.function)==null?void 0:$e.name)!=null&&((Be=Q.function)==null?void 0:Be.arguments)!=null&&(0,h.v0)(Q.function.arguments)&&(g.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(de=Q.id)!=null?de:(0,h.$C)(),toolName:Q.function.name,args:Q.function.arguments}),Q.hasFinished=!0))}},flush(I){var g,T;I.enqueue({type:"finish",finishReason:X,logprobs:b,usage:{promptTokens:(g=N.promptTokens)!=null?g:NaN,completionTokens:(T=N.completionTokens)!=null?T:NaN},...U!=null?{providerMetadata:U}:{}})}})),rawCall:{rawPrompt:Z,rawSettings:$},rawResponse:{headers:L},request:{body:JSON.stringify(A)},warnings:F}}},he=n.Ik({prompt_tokens:n.ai().nullish(),completion_tokens:n.ai().nullish(),prompt_tokens_details:n.Ik({cached_tokens:n.ai().nullish()}).nullish(),completion_tokens_details:n.Ik({reasoning_tokens:n.ai().nullish(),accepted_prediction_tokens:n.ai().nullish(),rejected_prediction_tokens:n.ai().nullish()}).nullish()}).nullish(),ce=n.Ik({id:n.Yj().nullish(),created:n.ai().nullish(),model:n.Yj().nullish(),choices:n.YO(n.Ik({message:n.Ik({role:n.eu("assistant").nullish(),content:n.Yj().nullish(),function_call:n.Ik({arguments:n.Yj(),name:n.Yj()}).nullish(),tool_calls:n.YO(n.Ik({id:n.Yj().nullish(),type:n.eu("function"),function:n.Ik({name:n.Yj(),arguments:n.Yj()})})).nullish()}),index:n.ai(),logprobs:n.Ik({content:n.YO(n.Ik({token:n.Yj(),logprob:n.ai(),top_logprobs:n.YO(n.Ik({token:n.Yj(),logprob:n.ai()}))})).nullable()}).nullish(),finish_reason:n.Yj().nullish()})),usage:he}),Ce=n.KC([n.Ik({id:n.Yj().nullish(),created:n.ai().nullish(),model:n.Yj().nullish(),choices:n.YO(n.Ik({delta:n.Ik({role:n.k5(["assistant"]).nullish(),content:n.Yj().nullish(),function_call:n.Ik({name:n.Yj().optional(),arguments:n.Yj().optional()}).nullish(),tool_calls:n.YO(n.Ik({index:n.ai(),id:n.Yj().nullish(),type:n.eu("function").nullish(),function:n.Ik({name:n.Yj().nullish(),arguments:n.Yj().nullish()})})).nullish()}).nullish(),logprobs:n.Ik({content:n.YO(n.Ik({token:n.Yj(),logprob:n.ai(),top_logprobs:n.YO(n.Ik({token:n.Yj(),logprob:n.ai()}))})).nullable()}).nullish(),finish_reason:n.Yj().nullish(),index:n.ai()})),usage:he}),M]);function ge(u){return u.startsWith("o")}var je={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function tt(u){return u?.tokens.map((b,S)=>({token:b,logprob:u.token_logprobs[S],topLogprobs:u.top_logprobs?Object.entries(u.top_logprobs[S]).map(([F,A])=>({token:F,logprob:A})):[]}))}var J=class{constructor(u,b,S){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=u,this.settings=b,this.config=S}get provider(){return this.config.provider}getArgs({mode:u,inputFormat:b,prompt:S,maxTokens:F,temperature:A,topP:L,topK:D,frequencyPenalty:Z,presencePenalty:$,stopSequences:O,responseFormat:X,seed:N}){var z;let oe=u.type,U=[];D!=null&&U.push({type:"unsupported-setting",setting:"topK"}),X!=null&&X.type!=="text"&&U.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:I,stopSequences:g}=function({prompt:_e,inputFormat:y,user:w="user",assistant:re="assistant"}){if(y==="prompt"&&_e.length===1&&_e[0].role==="user"&&_e[0].content.length===1&&_e[0].content[0].type==="text")return{prompt:_e[0].content[0].text};let ie="";for(let{role:we,content:Y}of(_e[0].role==="system"&&(ie+=`${_e[0].content}

`,_e=_e.slice(1)),_e))switch(we){case"system":throw new W.M3({message:"Unexpected system message in prompt: ${content}",prompt:_e});case"user":{let $e=Y.map(Be=>{switch(Be.type){case"text":return Be.text;case"image":throw new W.b8({functionality:"images"})}}).join("");ie+=`${w}:
${$e}

`;break}case"assistant":{let $e=Y.map(Be=>{switch(Be.type){case"text":return Be.text;case"tool-call":throw new W.b8({functionality:"tool-call messages"})}}).join("");ie+=`${re}:
${$e}

`;break}case"tool":throw new W.b8({functionality:"tool messages"});default:throw Error(`Unsupported role: ${we}`)}return{prompt:ie+=`${re}:
`,stopSequences:[`
${w}:`]}}({prompt:S,inputFormat:b}),T=[...g??[],...O??[]],Te={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:F,temperature:A,top_p:L,frequency_penalty:Z,presence_penalty:$,seed:N,prompt:I,stop:T.length>0?T:void 0};switch(oe){case"regular":if((z=u.tools)!=null&&z.length)throw new W.b8({functionality:"tools"});if(u.toolChoice)throw new W.b8({functionality:"toolChoice"});return{args:Te,warnings:U};case"object-json":throw new W.b8({functionality:"object-json mode"});case"object-tool":throw new W.b8({functionality:"object-tool mode"});default:throw Error(`Unsupported type: ${oe}`)}}async doGenerate(u){let{args:b,warnings:S}=this.getArgs(u),{responseHeaders:F,value:A,rawValue:L}=await(0,h.GU)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,h.m2)(this.config.headers(),u.headers),body:b,failedResponseHandler:C,successfulResponseHandler:(0,h.cV)(ct),abortSignal:u.abortSignal,fetch:this.config.fetch}),{prompt:D,...Z}=b,$=A.choices[0];return{text:$.text,usage:{promptTokens:A.usage.prompt_tokens,completionTokens:A.usage.completion_tokens},finishReason:ee($.finish_reason),logprobs:tt($.logprobs),rawCall:{rawPrompt:D,rawSettings:Z},rawResponse:{headers:F,body:L},response:x(A),warnings:S,request:{body:JSON.stringify(b)}}}async doStream(u){let b,{args:S,warnings:F}=this.getArgs(u),A={...S,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:L,value:D}=await(0,h.GU)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,h.m2)(this.config.headers(),u.headers),body:A,failedResponseHandler:C,successfulResponseHandler:(0,h.Ds)(f),abortSignal:u.abortSignal,fetch:this.config.fetch}),{prompt:Z,...$}=S,O="unknown",X={promptTokens:Number.NaN,completionTokens:Number.NaN},N=!0;return{stream:D.pipeThrough(new TransformStream({transform(z,oe){if(!z.success){O="error",oe.enqueue({type:"error",error:z.error});return}let U=z.value;if("error"in U){O="error",oe.enqueue({type:"error",error:U.error});return}N&&(N=!1,oe.enqueue({type:"response-metadata",...x(U)})),U.usage!=null&&(X={promptTokens:U.usage.prompt_tokens,completionTokens:U.usage.completion_tokens});let I=U.choices[0];I?.finish_reason!=null&&(O=ee(I.finish_reason)),I?.text!=null&&oe.enqueue({type:"text-delta",textDelta:I.text});let g=tt(I?.logprobs);g?.length&&(b===void 0&&(b=[]),b.push(...g))},flush(z){z.enqueue({type:"finish",finishReason:O,logprobs:b,usage:X})}})),rawCall:{rawPrompt:Z,rawSettings:$},rawResponse:{headers:L},warnings:F,request:{body:JSON.stringify(A)}}}},ct=n.Ik({id:n.Yj().nullish(),created:n.ai().nullish(),model:n.Yj().nullish(),choices:n.YO(n.Ik({text:n.Yj(),finish_reason:n.Yj(),logprobs:n.Ik({tokens:n.YO(n.Yj()),token_logprobs:n.YO(n.ai()),top_logprobs:n.YO(n.g1(n.Yj(),n.ai())).nullable()}).nullish()})),usage:n.Ik({prompt_tokens:n.ai(),completion_tokens:n.ai()})}),f=n.KC([n.Ik({id:n.Yj().nullish(),created:n.ai().nullish(),model:n.Yj().nullish(),choices:n.YO(n.Ik({text:n.Yj(),finish_reason:n.Yj().nullish(),index:n.ai(),logprobs:n.Ik({tokens:n.YO(n.Yj()),token_logprobs:n.YO(n.ai()),top_logprobs:n.YO(n.g1(n.Yj(),n.ai())).nullable()}).nullish()})),usage:n.Ik({prompt_tokens:n.ai(),completion_tokens:n.ai()}).nullish()}),M]),ae=class{constructor(u,b,S){this.specificationVersion="v1",this.modelId=u,this.settings=b,this.config=S}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var u;return(u=this.settings.maxEmbeddingsPerCall)!=null?u:2048}get supportsParallelCalls(){var u;return(u=this.settings.supportsParallelCalls)==null||u}async doEmbed({values:u,headers:b,abortSignal:S}){if(u.length>this.maxEmbeddingsPerCall)throw new W.Ch({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:u});let{responseHeaders:F,value:A}=await(0,h.GU)({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:(0,h.m2)(this.config.headers(),b),body:{model:this.modelId,input:u,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:C,successfulResponseHandler:(0,h.cV)(st),abortSignal:S,fetch:this.config.fetch});return{embeddings:A.data.map(L=>L.embedding),usage:A.usage?{tokens:A.usage.prompt_tokens}:void 0,rawResponse:{headers:F}}}},st=n.Ik({data:n.YO(n.Ik({embedding:n.YO(n.ai())})),usage:n.Ik({prompt_tokens:n.ai()}).nullish()}),Se={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},i=new Set(["gpt-image-1"]),dt=class{constructor(u,b,S){this.modelId=u,this.settings=b,this.config=S,this.specificationVersion="v1"}get maxImagesPerCall(){var u,b;return(b=(u=this.settings.maxImagesPerCall)!=null?u:Se[this.modelId])!=null?b:1}get provider(){return this.config.provider}async doGenerate({prompt:u,n:b,size:S,aspectRatio:F,seed:A,providerOptions:L,headers:D,abortSignal:Z}){var $,O,X,N;let z=[];F!=null&&z.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),A!=null&&z.push({type:"unsupported-setting",setting:"seed"});let oe=(X=(O=($=this.config._internal)==null?void 0:$.currentDate)==null?void 0:O.call($))!=null?X:new Date,{value:U,responseHeaders:I}=await(0,h.GU)({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:(0,h.m2)(this.config.headers(),D),body:{model:this.modelId,prompt:u,n:b,size:S,...(N=L.openai)!=null?N:{},...i.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:C,successfulResponseHandler:(0,h.cV)(mt),abortSignal:Z,fetch:this.config.fetch});return{images:U.data.map(g=>g.b64_json),warnings:z,response:{timestamp:oe,modelId:this.modelId,headers:I}}}},mt=n.Ik({data:n.YO(n.Ik({b64_json:n.Yj()}))}),_t=n.Ik({include:n.YO(n.Yj()).nullish(),language:n.Yj().nullish(),prompt:n.Yj().nullish(),temperature:n.ai().min(0).max(1).nullish().default(0),timestampGranularities:n.YO(n.k5(["word","segment"])).nullish().default(["segment"])}),Nt={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},Mt=class{constructor(u,b){this.modelId=u,this.config=b,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({audio:u,mediaType:b,providerOptions:S}){var F,A,L,D,Z;let $=(0,h.xI)({provider:"openai",providerOptions:S,schema:_t}),O=new FormData,X=u instanceof Uint8Array?new Blob([u]):new Blob([(0,h.Z9)(u)]);if(O.append("model",this.modelId),O.append("file",new File([X],"audio",{type:b})),$){let N={include:(F=$.include)!=null?F:void 0,language:(A=$.language)!=null?A:void 0,prompt:(L=$.prompt)!=null?L:void 0,temperature:(D=$.temperature)!=null?D:void 0,timestamp_granularities:(Z=$.timestampGranularities)!=null?Z:void 0};for(let z in N){let oe=N[z];oe!==void 0&&O.append(z,String(oe))}}return{formData:O,warnings:[]}}async doGenerate(u){var b,S,F,A,L,D;let Z=(F=(S=(b=this.config._internal)==null?void 0:b.currentDate)==null?void 0:S.call(b))!=null?F:new Date,{formData:$,warnings:O}=this.getArgs(u),{value:X,responseHeaders:N,rawValue:z}=await(0,h.S)({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:(0,h.m2)(this.config.headers(),u.headers),formData:$,failedResponseHandler:C,successfulResponseHandler:(0,h.cV)(fe),abortSignal:u.abortSignal,fetch:this.config.fetch}),oe=X.language!=null&&X.language in Nt?Nt[X.language]:void 0;return{text:X.text,segments:(L=(A=X.words)==null?void 0:A.map(U=>({text:U.word,startSecond:U.start,endSecond:U.end})))!=null?L:[],language:oe,durationInSeconds:(D=X.duration)!=null?D:void 0,warnings:O,response:{timestamp:Z,modelId:this.modelId,headers:N,body:z}}}},fe=n.Ik({text:n.Yj(),language:n.Yj().nullish(),duration:n.ai().nullish(),words:n.YO(n.Ik({word:n.Yj(),start:n.ai(),end:n.ai()})).nullish()});function Ot({finishReason:u,hasToolCalls:b}){switch(u){case void 0:case null:return b?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return b?"tool-calls":"unknown"}}var qt=class{constructor(u,b){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsStructuredOutputs=!0,this.modelId=u,this.config=b}get provider(){return this.config.provider}getArgs({mode:u,maxTokens:b,temperature:S,stopSequences:F,topP:A,topK:L,presencePenalty:D,frequencyPenalty:Z,seed:$,prompt:O,providerMetadata:X,responseFormat:N}){var z,oe,U,I;let g=[],T=(I=this.modelId).startsWith("o")?I.startsWith("o1-mini")||I.startsWith("o1-preview")?{isReasoningModel:!0,systemMessageMode:"remove",requiredAutoTruncation:!1}:{isReasoningModel:!0,systemMessageMode:"developer",requiredAutoTruncation:!1}:{isReasoningModel:!1,systemMessageMode:"system",requiredAutoTruncation:!1},Te=u.type;L!=null&&g.push({type:"unsupported-setting",setting:"topK"}),$!=null&&g.push({type:"unsupported-setting",setting:"seed"}),D!=null&&g.push({type:"unsupported-setting",setting:"presencePenalty"}),Z!=null&&g.push({type:"unsupported-setting",setting:"frequencyPenalty"}),F!=null&&g.push({type:"unsupported-setting",setting:"stopSequences"});let{messages:_e,warnings:y}=function({prompt:we,systemMessageMode:Y}){let $e=[],Be=[];for(let{role:de,content:ze}of we)switch(de){case"system":switch(Y){case"system":$e.push({role:"system",content:ze});break;case"developer":$e.push({role:"developer",content:ze});break;case"remove":Be.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${Y}`)}break;case"user":$e.push({role:"user",content:ze.map((R,Le)=>{var Pe,Xe,ke,Ie;switch(R.type){case"text":return{type:"input_text",text:R.text};case"image":return{type:"input_image",image_url:R.image instanceof URL?R.image.toString():`data:${(Pe=R.mimeType)!=null?Pe:"image/jpeg"};base64,${(0,h.n_)(R.image)}`,detail:(ke=(Xe=R.providerMetadata)==null?void 0:Xe.openai)==null?void 0:ke.imageDetail};case"file":if(R.data instanceof URL)throw new W.b8({functionality:"File URLs in user messages"});if(R.mimeType==="application/pdf")return{type:"input_file",filename:(Ie=R.filename)!=null?Ie:`part-${Le}.pdf`,file_data:`data:application/pdf;base64,${R.data}`};throw new W.b8({functionality:"Only PDF files are supported in user messages"})}})});break;case"assistant":for(let R of ze)switch(R.type){case"text":$e.push({role:"assistant",content:[{type:"output_text",text:R.text}]});break;case"tool-call":$e.push({type:"function_call",call_id:R.toolCallId,name:R.toolName,arguments:JSON.stringify(R.args)})}break;case"tool":for(let R of ze)$e.push({type:"function_call_output",call_id:R.toolCallId,output:JSON.stringify(R.result)});break;default:throw Error(`Unsupported role: ${de}`)}return{messages:$e,warnings:Be}}({prompt:O,systemMessageMode:T.systemMessageMode});g.push(...y);let w=(0,h.xI)({provider:"openai",providerOptions:X,schema:Ue}),re=(z=w?.strictSchemas)==null||z,ie={model:this.modelId,input:_e,temperature:S,top_p:A,max_output_tokens:b,...N?.type==="json"&&{text:{format:N.schema!=null?{type:"json_schema",strict:re,name:(oe=N.name)!=null?oe:"response",description:N.description,schema:N.schema}:{type:"json_object"}}},metadata:w?.metadata,parallel_tool_calls:w?.parallelToolCalls,previous_response_id:w?.previousResponseId,store:w?.store,user:w?.user,instructions:w?.instructions,...T.isReasoningModel&&(w?.reasoningEffort!=null||w?.reasoningSummary!=null)&&{reasoning:{...w?.reasoningEffort!=null&&{effort:w.reasoningEffort},...w?.reasoningSummary!=null&&{summary:w.reasoningSummary}}},...T.requiredAutoTruncation&&{truncation:"auto"}};switch(T.isReasoningModel&&(ie.temperature!=null&&(ie.temperature=void 0,g.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),ie.top_p!=null&&(ie.top_p=void 0,g.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))),Te){case"regular":{let{tools:we,tool_choice:Y,toolWarnings:$e}=function({mode:Be,strict:de}){var ze;let R=(ze=Be.tools)!=null&&ze.length?Be.tools:void 0,Le=[];if(R==null)return{tools:void 0,tool_choice:void 0,toolWarnings:Le};let Pe=Be.toolChoice,Xe=[];for(let Ie of R)switch(Ie.type){case"function":Xe.push({type:"function",name:Ie.name,description:Ie.description,parameters:Ie.parameters,strict:!!de||void 0});break;case"provider-defined":Ie.id==="openai.web_search_preview"?Xe.push({type:"web_search_preview",search_context_size:Ie.args.searchContextSize,user_location:Ie.args.userLocation}):Le.push({type:"unsupported-tool",tool:Ie});break;default:Le.push({type:"unsupported-tool",tool:Ie})}if(Pe==null)return{tools:Xe,tool_choice:void 0,toolWarnings:Le};let ke=Pe.type;switch(ke){case"auto":case"none":case"required":return{tools:Xe,tool_choice:ke,toolWarnings:Le};case"tool":return Pe.toolName==="web_search_preview"?{tools:Xe,tool_choice:{type:"web_search_preview"},toolWarnings:Le}:{tools:Xe,tool_choice:{type:"function",name:Pe.toolName},toolWarnings:Le};default:throw new W.b8({functionality:`Unsupported tool choice type: ${ke}`})}}({mode:u,strict:re});return{args:{...ie,tools:we,tool_choice:Y},warnings:[...g,...$e]}}case"object-json":return{args:{...ie,text:{format:u.schema!=null?{type:"json_schema",strict:re,name:(U=u.name)!=null?U:"response",description:u.description,schema:u.schema}:{type:"json_object"}}},warnings:g};case"object-tool":return{args:{...ie,tool_choice:{type:"function",name:u.tool.name},tools:[{type:"function",name:u.tool.name,description:u.tool.description,parameters:u.tool.parameters,strict:re}]},warnings:g};default:throw Error(`Unsupported type: ${Te}`)}}async doGenerate(u){var b,S,F,A,L,D,Z;let{args:$,warnings:O}=this.getArgs(u),{responseHeaders:X,value:N,rawValue:z}=await(0,h.GU)({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:(0,h.m2)(this.config.headers(),u.headers),body:$,failedResponseHandler:C,successfulResponseHandler:(0,h.cV)(n.Ik({id:n.Yj(),created_at:n.ai(),model:n.Yj(),output:n.YO(n.gM("type",[n.Ik({type:n.eu("message"),role:n.eu("assistant"),content:n.YO(n.Ik({type:n.eu("output_text"),text:n.Yj(),annotations:n.YO(n.Ik({type:n.eu("url_citation"),start_index:n.ai(),end_index:n.ai(),url:n.Yj(),title:n.Yj()}))}))}),n.Ik({type:n.eu("function_call"),call_id:n.Yj(),name:n.Yj(),arguments:n.Yj()}),n.Ik({type:n.eu("web_search_call")}),n.Ik({type:n.eu("computer_call")}),n.Ik({type:n.eu("reasoning"),summary:n.YO(n.Ik({type:n.eu("summary_text"),text:n.Yj()}))})])),incomplete_details:n.Ik({reason:n.Yj()}).nullable(),usage:_})),abortSignal:u.abortSignal,fetch:this.config.fetch}),oe=N.output.filter(g=>g.type==="message").flatMap(g=>g.content).filter(g=>g.type==="output_text"),U=N.output.filter(g=>g.type==="function_call").map(g=>({toolCallType:"function",toolCallId:g.call_id,toolName:g.name,args:g.arguments})),I=(S=(b=N.output.find(g=>g.type==="reasoning"))==null?void 0:b.summary)!=null?S:null;return{text:oe.map(g=>g.text).join(`
`),sources:oe.flatMap(g=>g.annotations.map(T=>{var Te,_e,y;return{sourceType:"url",id:(y=(_e=(Te=this.config).generateId)==null?void 0:_e.call(Te))!=null?y:(0,h.$C)(),url:T.url,title:T.title}})),finishReason:Ot({finishReason:(F=N.incomplete_details)==null?void 0:F.reason,hasToolCalls:U.length>0}),toolCalls:U.length>0?U:void 0,reasoning:I?I.map(g=>({type:"text",text:g.text})):void 0,usage:{promptTokens:N.usage.input_tokens,completionTokens:N.usage.output_tokens},rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:X,body:z},request:{body:JSON.stringify($)},response:{id:N.id,timestamp:new Date(1e3*N.created_at),modelId:N.model},providerMetadata:{openai:{responseId:N.id,cachedPromptTokens:(L=(A=N.usage.input_tokens_details)==null?void 0:A.cached_tokens)!=null?L:null,reasoningTokens:(Z=(D=N.usage.output_tokens_details)==null?void 0:D.reasoning_tokens)!=null?Z:null}},warnings:O}}async doStream(u){let{args:b,warnings:S}=this.getArgs(u),{responseHeaders:F,value:A}=await(0,h.GU)({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:(0,h.m2)(this.config.headers(),u.headers),body:{...b,stream:!0},failedResponseHandler:C,successfulResponseHandler:(0,h.Ds)(We),abortSignal:u.abortSignal,fetch:this.config.fetch}),L=this,D="unknown",Z=NaN,$=NaN,O=null,X=null,N=null,z={},oe=!1;return{stream:A.pipeThrough(new TransformStream({transform(U,I){var g,T,Te,_e,y,w,re,ie,we;if(!U.success){D="error",I.enqueue({type:"error",error:U.error});return}let Y=U.value;if(Y.type==="response.output_item.added")Y.item.type==="function_call"&&(z[Y.output_index]={toolName:Y.item.name,toolCallId:Y.item.call_id},I.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:Y.item.call_id,toolName:Y.item.name,argsTextDelta:Y.item.arguments}));else if(Y.type==="response.function_call_arguments.delta"){let $e=z[Y.output_index];$e!=null&&I.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:$e.toolCallId,toolName:$e.toolName,argsTextDelta:Y.delta})}else Y.type==="response.created"?(N=Y.response.id,I.enqueue({type:"response-metadata",id:Y.response.id,timestamp:new Date(1e3*Y.response.created_at),modelId:Y.response.model})):Y.type==="response.output_text.delta"?I.enqueue({type:"text-delta",textDelta:Y.delta}):Y.type==="response.reasoning_summary_text.delta"?I.enqueue({type:"reasoning",textDelta:Y.delta}):Y.type==="response.output_item.done"&&Y.item.type==="function_call"?(z[Y.output_index]=void 0,oe=!0,I.enqueue({type:"tool-call",toolCallType:"function",toolCallId:Y.item.call_id,toolName:Y.item.name,args:Y.item.arguments})):(we=Y).type==="response.completed"||we.type==="response.incomplete"?(D=Ot({finishReason:(g=Y.response.incomplete_details)==null?void 0:g.reason,hasToolCalls:oe}),Z=Y.response.usage.input_tokens,$=Y.response.usage.output_tokens,O=(Te=(T=Y.response.usage.input_tokens_details)==null?void 0:T.cached_tokens)!=null?Te:O,X=(y=(_e=Y.response.usage.output_tokens_details)==null?void 0:_e.reasoning_tokens)!=null?y:X):Y.type==="response.output_text.annotation.added"&&I.enqueue({type:"source",source:{sourceType:"url",id:(ie=(re=(w=L.config).generateId)==null?void 0:re.call(w))!=null?ie:(0,h.$C)(),url:Y.annotation.url,title:Y.annotation.title}})},flush(U){U.enqueue({type:"finish",finishReason:D,usage:{promptTokens:Z,completionTokens:$},...(O!=null||X!=null)&&{providerMetadata:{openai:{responseId:N,cachedPromptTokens:O,reasoningTokens:X}}}})}})),rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:F},request:{body:JSON.stringify(b)},warnings:S}}},_=n.Ik({input_tokens:n.ai(),input_tokens_details:n.Ik({cached_tokens:n.ai().nullish()}).nullish(),output_tokens:n.ai(),output_tokens_details:n.Ik({reasoning_tokens:n.ai().nullish()}).nullish()}),j=n.Ik({type:n.eu("response.output_text.delta"),delta:n.Yj()}),k=n.Ik({type:n.k5(["response.completed","response.incomplete"]),response:n.Ik({incomplete_details:n.Ik({reason:n.Yj()}).nullish(),usage:_})}),E=n.Ik({type:n.eu("response.created"),response:n.Ik({id:n.Yj(),created_at:n.ai(),model:n.Yj()})}),te=n.Ik({type:n.eu("response.output_item.done"),output_index:n.ai(),item:n.gM("type",[n.Ik({type:n.eu("message")}),n.Ik({type:n.eu("function_call"),id:n.Yj(),call_id:n.Yj(),name:n.Yj(),arguments:n.Yj(),status:n.eu("completed")})])}),Ee=n.Ik({type:n.eu("response.function_call_arguments.delta"),item_id:n.Yj(),output_index:n.ai(),delta:n.Yj()}),be=n.Ik({type:n.eu("response.output_item.added"),output_index:n.ai(),item:n.gM("type",[n.Ik({type:n.eu("message")}),n.Ik({type:n.eu("function_call"),id:n.Yj(),call_id:n.Yj(),name:n.Yj(),arguments:n.Yj()})])}),ye=n.Ik({type:n.eu("response.output_text.annotation.added"),annotation:n.Ik({type:n.eu("url_citation"),url:n.Yj(),title:n.Yj()})}),Ae=n.Ik({type:n.eu("response.reasoning_summary_text.delta"),item_id:n.Yj(),output_index:n.ai(),summary_index:n.ai(),delta:n.Yj()}),We=n.KC([j,k,E,te,Ee,be,ye,Ae,n.Ik({type:n.Yj()}).passthrough()]),Ue=n.Ik({metadata:n.bz().nullish(),parallelToolCalls:n.zM().nullish(),previousResponseId:n.Yj().nullish(),store:n.zM().nullish(),user:n.Yj().nullish(),reasoningEffort:n.Yj().nullish(),strictSchemas:n.zM().nullish(),instructions:n.Yj().nullish(),reasoningSummary:n.Yj().nullish()}),ne=n.Ik({}),rt={webSearchPreview:function({searchContextSize:u,userLocation:b}={}){return{type:"provider-defined",id:"openai.web_search_preview",args:{searchContextSize:u,userLocation:b},parameters:ne}}},nt=n.Ik({instructions:n.Yj().nullish(),speed:n.ai().min(.25).max(4).default(1).nullish()}),gt=class{constructor(u,b){this.modelId=u,this.config=b,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({text:u,voice:b="alloy",outputFormat:S="mp3",speed:F,instructions:A,providerOptions:L}){let D=[],Z=(0,h.xI)({provider:"openai",providerOptions:L,schema:nt}),$={model:this.modelId,input:u,voice:b,response_format:"mp3",speed:F,instructions:A};if(S&&(["mp3","opus","aac","flac","wav","pcm"].includes(S)?$.response_format=S:D.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${S}. Using mp3 instead.`})),Z){let O={};for(let X in O){let N=O[X];N!==void 0&&($[X]=N)}}return{requestBody:$,warnings:D}}async doGenerate(u){var b,S,F;let A=(F=(S=(b=this.config._internal)==null?void 0:b.currentDate)==null?void 0:S.call(b))!=null?F:new Date,{requestBody:L,warnings:D}=this.getArgs(u),{value:Z,responseHeaders:$,rawValue:O}=await(0,h.GU)({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:(0,h.m2)(this.config.headers(),u.headers),body:L,failedResponseHandler:C,successfulResponseHandler:(0,h.HD)(),abortSignal:u.abortSignal,fetch:this.config.fetch});return{audio:Z,warnings:D,request:{body:JSON.stringify(L)},response:{timestamp:A,modelId:this.modelId,headers:$,body:O}}}};function V(u={}){var b,S,F;let A=(b=(0,h.ae)(u.baseURL))!=null?b:"https://api.openai.com/v1",L=(S=u.compatibility)!=null?S:"compatible",D=(F=u.name)!=null?F:"openai",Z=()=>({Authorization:`Bearer ${(0,h.WL)({apiKey:u.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":u.organization,"OpenAI-Project":u.project,...u.headers}),$=(g,T={})=>new q(g,T,{provider:`${D}.chat`,url:({path:Te})=>`${A}${Te}`,headers:Z,compatibility:L,fetch:u.fetch}),O=(g,T={})=>new J(g,T,{provider:`${D}.completion`,url:({path:Te})=>`${A}${Te}`,headers:Z,compatibility:L,fetch:u.fetch}),X=(g,T={})=>new ae(g,T,{provider:`${D}.embedding`,url:({path:Te})=>`${A}${Te}`,headers:Z,fetch:u.fetch}),N=(g,T={})=>new dt(g,T,{provider:`${D}.image`,url:({path:Te})=>`${A}${Te}`,headers:Z,fetch:u.fetch}),z=g=>new Mt(g,{provider:`${D}.transcription`,url:({path:T})=>`${A}${T}`,headers:Z,fetch:u.fetch}),oe=g=>new gt(g,{provider:`${D}.speech`,url:({path:T})=>`${A}${T}`,headers:Z,fetch:u.fetch}),U=(g,T)=>{if(new.target)throw Error("The OpenAI model function cannot be called with the new keyword.");return g==="gpt-3.5-turbo-instruct"?O(g,T):$(g,T)},I=function(g,T){return U(g,T)};return I.languageModel=U,I.chat=$,I.completion=O,I.responses=g=>new qt(g,{provider:`${D}.responses`,url:({path:T})=>`${A}${T}`,headers:Z,fetch:u.fetch}),I.embedding=X,I.textEmbedding=X,I.textEmbeddingModel=X,I.image=N,I.imageModel=N,I.transcription=z,I.transcriptionModel=z,I.speech=oe,I.speechModel=oe,I.tools=rt,I}var Ut=V({compatibility:"strict"})},Tt.__chunk_64858=(lt,He,me)=>{let h;me.d(He,{pY:()=>Qa,Df:()=>fs});var W,n,Oe,ee,M,C,x,q,he,ce,Ce,ge,je,tt,J,ct,f=me(96848),ae=me(36528),st=me(15283),Se=me(36720),i=me(71023);let dt=Symbol("Let zodToJsonSchema decide on which parser to use"),mt={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},_t=e=>typeof e=="string"?{...mt,name:e}:{...mt,...e},Nt=e=>{let r=_t(e),a=r.name!==void 0?[...r.basePath,r.definitionPath,r.name]:r.basePath;return{...r,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(r.definitions).map(([t,s])=>[s._def,{def:s._def,path:[...r.basePath,r.definitionPath,t],jsonSchema:void 0}]))}};function Mt(e,r,a,t){t?.errorMessages&&a&&(e.errorMessage={...e.errorMessage,[r]:a})}function fe(e,r,a,t,s){e[r]=a,Mt(e,r,t,s)}function Ot(e,r){return V(e.type._def,r)}let qt=(e,r)=>V(e.innerType._def,r),_=(e,r)=>{let a={type:"integer",format:"unix-time"};if(r.target==="openApi3")return a;for(let t of e.checks)switch(t.kind){case"min":fe(a,"minimum",t.value,t.message,r);break;case"max":fe(a,"maximum",t.value,t.message,r)}return a},j=e=>(!("type"in e)||e.type!=="string")&&"allOf"in e,k={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(h===void 0&&(h=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),h),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function E(e,r){let a={type:"string"};if(e.checks)for(let t of e.checks)switch(t.kind){case"min":fe(a,"minLength",typeof a.minLength=="number"?Math.max(a.minLength,t.value):t.value,t.message,r);break;case"max":fe(a,"maxLength",typeof a.maxLength=="number"?Math.min(a.maxLength,t.value):t.value,t.message,r);break;case"email":switch(r.emailStrategy){case"format:email":be(a,"email",t.message,r);break;case"format:idn-email":be(a,"idn-email",t.message,r);break;case"pattern:zod":ye(a,k.email,t.message,r)}break;case"url":be(a,"uri",t.message,r);break;case"uuid":be(a,"uuid",t.message,r);break;case"regex":ye(a,t.regex,t.message,r);break;case"cuid":ye(a,k.cuid,t.message,r);break;case"cuid2":ye(a,k.cuid2,t.message,r);break;case"startsWith":ye(a,RegExp(`^${te(t.value,r)}`),t.message,r);break;case"endsWith":ye(a,RegExp(`${te(t.value,r)}$`),t.message,r);break;case"datetime":be(a,"date-time",t.message,r);break;case"date":be(a,"date",t.message,r);break;case"time":be(a,"time",t.message,r);break;case"duration":be(a,"duration",t.message,r);break;case"length":fe(a,"minLength",typeof a.minLength=="number"?Math.max(a.minLength,t.value):t.value,t.message,r),fe(a,"maxLength",typeof a.maxLength=="number"?Math.min(a.maxLength,t.value):t.value,t.message,r);break;case"includes":ye(a,RegExp(te(t.value,r)),t.message,r);break;case"ip":t.version!=="v6"&&be(a,"ipv4",t.message,r),t.version!=="v4"&&be(a,"ipv6",t.message,r);break;case"base64url":ye(a,k.base64url,t.message,r);break;case"jwt":ye(a,k.jwt,t.message,r);break;case"cidr":t.version!=="v6"&&ye(a,k.ipv4Cidr,t.message,r),t.version!=="v4"&&ye(a,k.ipv6Cidr,t.message,r);break;case"emoji":ye(a,k.emoji(),t.message,r);break;case"ulid":ye(a,k.ulid,t.message,r);break;case"base64":switch(r.base64Strategy){case"format:binary":be(a,"binary",t.message,r);break;case"contentEncoding:base64":fe(a,"contentEncoding","base64",t.message,r);break;case"pattern:zod":ye(a,k.base64,t.message,r)}break;case"nanoid":ye(a,k.nanoid,t.message,r)}return a}function te(e,r){return r.patternStrategy==="escape"?function(a){let t="";for(let s=0;s<a.length;s++)Ee.has(a[s])||(t+="\\"),t+=a[s];return t}(e):e}let Ee=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function be(e,r,a,t){e.format||e.anyOf?.some(s=>s.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&t.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:r,...a&&t.errorMessages&&{errorMessage:{format:a}}})):fe(e,"format",r,a,t)}function ye(e,r,a,t){e.pattern||e.allOf?.some(s=>s.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&t.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:Ae(r,t),...a&&t.errorMessages&&{errorMessage:{pattern:a}}})):fe(e,"pattern",Ae(r,t),a,t)}function Ae(e,r){if(!r.applyRegexFlags||!e.flags)return e.source;let a={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},t=a.i?e.source.toLowerCase():e.source,s="",o=!1,l=!1,p=!1;for(let c=0;c<t.length;c++){if(o){s+=t[c],o=!1;continue}if(a.i){if(l){if(t[c].match(/[a-z]/)){p?(s+=t[c],s+=`${t[c-2]}-${t[c]}`.toUpperCase(),p=!1):t[c+1]==="-"&&t[c+2]?.match(/[a-z]/)?(s+=t[c],p=!0):s+=`${t[c]}${t[c].toUpperCase()}`;continue}}else if(t[c].match(/[a-z]/)){s+=`[${t[c]}${t[c].toUpperCase()}]`;continue}}if(a.m){if(t[c]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(t[c]==="$"){s+=`($|(?=[\r
]))`;continue}}if(a.s&&t[c]==="."){s+=l?`${t[c]}\r
`:`[${t[c]}\r
]`;continue}s+=t[c],t[c]==="\\"?o=!0:l&&t[c]==="]"?l=!1:l||t[c]!=="["||(l=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${r.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s}function We(e,r){if(r.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),r.target==="openApi3"&&e.keyType?._def.typeName===i.kY.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((t,s)=>({...t,[s]:V(e.valueType._def,{...r,currentPath:[...r.currentPath,"properties",s]})??{}}),{}),additionalProperties:!1};let a={type:"object",additionalProperties:V(e.valueType._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]})??{}};if(r.target==="openApi3")return a;if(e.keyType?._def.typeName===i.kY.ZodString&&e.keyType._def.checks?.length){let{type:t,...s}=E(e.keyType._def,r);return{...a,propertyNames:s}}if(e.keyType?._def.typeName===i.kY.ZodEnum)return{...a,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===i.kY.ZodBranded&&e.keyType._def.type._def.typeName===i.kY.ZodString&&e.keyType._def.type._def.checks?.length){let{type:t,...s}=Ot(e.keyType._def,r);return{...a,propertyNames:s}}return a}let Ue={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},ne=(e,r)=>{let a=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((t,s)=>V(t._def,{...r,currentPath:[...r.currentPath,"anyOf",`${s}`]})).filter(t=>!!t&&(!r.strictUnions||typeof t=="object"&&Object.keys(t).length>0));return a.length?{anyOf:a}:void 0},rt=(e,r)=>{if(r.currentPath.toString()===r.propertyPath?.toString())return V(e.innerType._def,r);let a=V(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","1"]});return a?{anyOf:[{not:{}},a]}:{}},nt=(e,r)=>{if(r.pipeStrategy==="input")return V(e.in._def,r);if(r.pipeStrategy==="output")return V(e.out._def,r);let a=V(e.in._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),t=V(e.out._def,{...r,currentPath:[...r.currentPath,"allOf",a?"1":"0"]});return{allOf:[a,t].filter(s=>s!==void 0)}},gt=(e,r)=>V(e.innerType._def,r);function V(e,r,a=!1){let t=r.seen.get(e);if(r.override){let l=r.override?.(e,r,t,a);if(l!==dt)return l}if(t&&!a){let l=Ut(t,r);if(l!==void 0)return l}let s={def:e,path:r.currentPath,jsonSchema:void 0};r.seen.set(e,s);let o=b(e,e.typeName,r);return o&&S(e,r,o),s.jsonSchema=o,o}let Ut=(e,r)=>{switch(r.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:u(r.currentPath,e.path)};case"none":case"seen":return e.path.length<r.currentPath.length&&e.path.every((a,t)=>r.currentPath[t]===a)?(console.warn(`Recursive reference detected at ${r.currentPath.join("/")}! Defaulting to any`),{}):r.$refStrategy==="seen"?{}:void 0}},u=(e,r)=>{let a=0;for(;a<e.length&&a<r.length&&e[a]===r[a];a++);return[(e.length-a).toString(),...r.slice(a)].join("/")},b=(e,r,a)=>{switch(r){case i.kY.ZodString:return E(e,a);case i.kY.ZodNumber:return function(t,s){let o={type:"number"};if(!t.checks)return o;for(let l of t.checks)switch(l.kind){case"int":o.type="integer",Mt(o,"type",l.message,s);break;case"min":s.target==="jsonSchema7"?l.inclusive?fe(o,"minimum",l.value,l.message,s):fe(o,"exclusiveMinimum",l.value,l.message,s):(l.inclusive||(o.exclusiveMinimum=!0),fe(o,"minimum",l.value,l.message,s));break;case"max":s.target==="jsonSchema7"?l.inclusive?fe(o,"maximum",l.value,l.message,s):fe(o,"exclusiveMaximum",l.value,l.message,s):(l.inclusive||(o.exclusiveMaximum=!0),fe(o,"maximum",l.value,l.message,s));break;case"multipleOf":fe(o,"multipleOf",l.value,l.message,s)}return o}(e,a);case i.kY.ZodObject:return function(t,s){let o=s.target==="openAi",l={type:"object",...Object.entries(t.shape()).reduce((p,[c,v])=>{if(v===void 0||v._def===void 0)return p;let d=v.isOptional();d&&o&&(v instanceof i.Ii&&(v=v._def.innerType),v.isNullable()||(v=v.nullable()),d=!1);let m=V(v._def,{...s,currentPath:[...s.currentPath,"properties",c],propertyPath:[...s.currentPath,"properties",c]});return m===void 0?p:{properties:{...p.properties,[c]:m},required:d?p.required:[...p.required,c]}},{properties:{},required:[]}),additionalProperties:s.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":V(t.catchall._def,{...s,currentPath:[...s.currentPath,"additionalProperties"]})??!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":V(t.catchall._def,{...s,currentPath:[...s.currentPath,"additionalProperties"]})??!0};return l.required.length||delete l.required,l}(e,a);case i.kY.ZodBigInt:return function(t,s){let o={type:"integer",format:"int64"};if(!t.checks)return o;for(let l of t.checks)switch(l.kind){case"min":s.target==="jsonSchema7"?l.inclusive?fe(o,"minimum",l.value,l.message,s):fe(o,"exclusiveMinimum",l.value,l.message,s):(l.inclusive||(o.exclusiveMinimum=!0),fe(o,"minimum",l.value,l.message,s));break;case"max":s.target==="jsonSchema7"?l.inclusive?fe(o,"maximum",l.value,l.message,s):fe(o,"exclusiveMaximum",l.value,l.message,s):(l.inclusive||(o.exclusiveMaximum=!0),fe(o,"maximum",l.value,l.message,s));break;case"multipleOf":fe(o,"multipleOf",l.value,l.message,s)}return o}(e,a);case i.kY.ZodBoolean:return{type:"boolean"};case i.kY.ZodDate:return function t(s,o,l){let p=l??o.dateStrategy;if(Array.isArray(p))return{anyOf:p.map((c,v)=>t(s,o,c))};switch(p){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return _(s,o)}}(e,a);case i.kY.ZodUndefined:return{not:{}};case i.kY.ZodNull:return a.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"};case i.kY.ZodArray:return function(t,s){let o={type:"array"};return t.type?._def&&t.type?._def?.typeName!==i.kY.ZodAny&&(o.items=V(t.type._def,{...s,currentPath:[...s.currentPath,"items"]})),t.minLength&&fe(o,"minItems",t.minLength.value,t.minLength.message,s),t.maxLength&&fe(o,"maxItems",t.maxLength.value,t.maxLength.message,s),t.exactLength&&(fe(o,"minItems",t.exactLength.value,t.exactLength.message,s),fe(o,"maxItems",t.exactLength.value,t.exactLength.message,s)),o}(e,a);case i.kY.ZodUnion:case i.kY.ZodDiscriminatedUnion:return function(t,s){if(s.target==="openApi3")return ne(t,s);let o=t.options instanceof Map?Array.from(t.options.values()):t.options;if(o.every(l=>l._def.typeName in Ue&&(!l._def.checks||!l._def.checks.length))){let l=o.reduce((p,c)=>{let v=Ue[c._def.typeName];return v&&!p.includes(v)?[...p,v]:p},[]);return{type:l.length>1?l:l[0]}}if(o.every(l=>l._def.typeName==="ZodLiteral"&&!l.description)){let l=o.reduce((p,c)=>{let v=typeof c._def.value;switch(v){case"string":case"number":case"boolean":return[...p,v];case"bigint":return[...p,"integer"];case"object":if(c._def.value===null)return[...p,"null"];default:return p}},[]);if(l.length===o.length){let p=l.filter((c,v,d)=>d.indexOf(c)===v);return{type:p.length>1?p:p[0],enum:o.reduce((c,v)=>c.includes(v._def.value)?c:[...c,v._def.value],[])}}}else if(o.every(l=>l._def.typeName==="ZodEnum"))return{type:"string",enum:o.reduce((l,p)=>[...l,...p._def.values.filter(c=>!l.includes(c))],[])};return ne(t,s)}(e,a);case i.kY.ZodIntersection:return function(t,s){let o=[V(t.left._def,{...s,currentPath:[...s.currentPath,"allOf","0"]}),V(t.right._def,{...s,currentPath:[...s.currentPath,"allOf","1"]})].filter(c=>!!c),l=s.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,p=[];return o.forEach(c=>{if(j(c))p.push(...c.allOf),c.unevaluatedProperties===void 0&&(l=void 0);else{let v=c;if("additionalProperties"in c&&c.additionalProperties===!1){let{additionalProperties:d,...m}=c;v=m}else l=void 0;p.push(v)}}),p.length?{allOf:p,...l}:void 0}(e,a);case i.kY.ZodTuple:return function(t,s){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((o,l)=>V(o._def,{...s,currentPath:[...s.currentPath,"items",`${l}`]})).reduce((o,l)=>l===void 0?o:[...o,l],[]),additionalItems:V(t.rest._def,{...s,currentPath:[...s.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((o,l)=>V(o._def,{...s,currentPath:[...s.currentPath,"items",`${l}`]})).reduce((o,l)=>l===void 0?o:[...o,l],[])}}(e,a);case i.kY.ZodRecord:return We(e,a);case i.kY.ZodLiteral:return function(t,s){let o=typeof t.value;return o!=="bigint"&&o!=="number"&&o!=="boolean"&&o!=="string"?{type:Array.isArray(t.value)?"array":"object"}:s.target==="openApi3"?{type:o==="bigint"?"integer":o,enum:[t.value]}:{type:o==="bigint"?"integer":o,const:t.value}}(e,a);case i.kY.ZodEnum:return{type:"string",enum:Array.from(e.values)};case i.kY.ZodNativeEnum:return function(t){let s=t.values,o=Object.keys(t.values).filter(p=>typeof s[s[p]]!="number").map(p=>s[p]),l=Array.from(new Set(o.map(p=>typeof p)));return{type:l.length===1?l[0]==="string"?"string":"number":["string","number"],enum:o}}(e);case i.kY.ZodNullable:return function(t,s){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return s.target==="openApi3"?{type:Ue[t.innerType._def.typeName],nullable:!0}:{type:[Ue[t.innerType._def.typeName],"null"]};if(s.target==="openApi3"){let l=V(t.innerType._def,{...s,currentPath:[...s.currentPath]});return l&&"$ref"in l?{allOf:[l],nullable:!0}:l&&{...l,nullable:!0}}let o=V(t.innerType._def,{...s,currentPath:[...s.currentPath,"anyOf","0"]});return o&&{anyOf:[o,{type:"null"}]}}(e,a);case i.kY.ZodOptional:return rt(e,a);case i.kY.ZodMap:return function(t,s){return s.mapStrategy==="record"?We(t,s):{type:"array",maxItems:125,items:{type:"array",items:[V(t.keyType._def,{...s,currentPath:[...s.currentPath,"items","items","0"]})||{},V(t.valueType._def,{...s,currentPath:[...s.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,a);case i.kY.ZodSet:return function(t,s){let o={type:"array",uniqueItems:!0,items:V(t.valueType._def,{...s,currentPath:[...s.currentPath,"items"]})};return t.minSize&&fe(o,"minItems",t.minSize.value,t.minSize.message,s),t.maxSize&&fe(o,"maxItems",t.maxSize.value,t.maxSize.message,s),o}(e,a);case i.kY.ZodLazy:return V(e.getter()._def,a);case i.kY.ZodPromise:return V(e.type._def,a);case i.kY.ZodNaN:case i.kY.ZodNever:return{not:{}};case i.kY.ZodEffects:return function(t,s){return s.effectStrategy==="input"?V(t.schema._def,s):{}}(e,a);case i.kY.ZodAny:case i.kY.ZodUnknown:return{};case i.kY.ZodDefault:return function(t,s){return{...V(t.innerType._def,s),default:t.defaultValue()}}(e,a);case i.kY.ZodBranded:return Ot(e,a);case i.kY.ZodReadonly:return gt(e,a);case i.kY.ZodCatch:return qt(e,a);case i.kY.ZodPipeline:return nt(e,a);case i.kY.ZodFunction:case i.kY.ZodVoid:case i.kY.ZodSymbol:default:return}},S=(e,r,a)=>(e.description&&(a.description=e.description,r.markdownDescription&&(a.markdownDescription=e.description)),a),F=(e,r)=>{let a=Nt(r),t=typeof r=="object"&&r.definitions?Object.entries(r.definitions).reduce((c,[v,d])=>({...c,[v]:V(d._def,{...a,currentPath:[...a.basePath,a.definitionPath,v]},!0)??{}}),{}):void 0,s=typeof r=="string"?r:r?.nameStrategy==="title"?void 0:r?.name,o=V(e._def,s===void 0?a:{...a,currentPath:[...a.basePath,a.definitionPath,s]},!1)??{},l=typeof r=="object"&&r.name!==void 0&&r.nameStrategy==="title"?r.name:void 0;l!==void 0&&(o.title=l);let p=s===void 0?t?{...o,[a.definitionPath]:t}:o:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,s].join("/"),[a.definitionPath]:{...t,[s]:o}};return a.target==="jsonSchema7"?p.$schema="http://json-schema.org/draft-07/schema#":(a.target==="jsonSchema2019-09"||a.target==="openAi")&&(p.$schema="https://json-schema.org/draft/2019-09/schema#"),a.target==="openAi"&&("anyOf"in p||"oneOf"in p||"allOf"in p||"type"in p&&Array.isArray(p.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),p};var A={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},L={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},D={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(r=>r!=null&&typeof r=="object"&&"type"in r&&r.type==="text"&&"text"in r&&r.text!=null&&typeof r.text=="object"&&"value"in r.text&&typeof r.text.value=="string"))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},Z={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},$={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},O=[A,L,D,Z,$],X={[A.code]:A,[L.code]:L,[D.code]:D,[Z.code]:Z,[$.code]:$};A.name,A.code,L.name,L.code,D.name,D.code,Z.name,Z.code,$.name,$.code;var N=O.map(e=>e.code);function z(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let r=(0,ae.N8)({text:e});return r.success?{value:r.value,state:"successful-parse"}:(r=(0,ae.N8)({text:function(a){let t=["ROOT"],s=-1,o=null;function l(d,m,K){switch(d){case'"':s=m,t.pop(),t.push(K),t.push("INSIDE_STRING");break;case"f":case"t":case"n":s=m,o=m,t.pop(),t.push(K),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(K),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":s=m,t.pop(),t.push(K),t.push("INSIDE_NUMBER");break;case"{":s=m,t.pop(),t.push(K),t.push("INSIDE_OBJECT_START");break;case"[":s=m,t.pop(),t.push(K),t.push("INSIDE_ARRAY_START")}}function p(d,m){switch(d){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":s=m,t.pop()}}function c(d,m){switch(d){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":s=m,t.pop()}}for(let d=0;d<a.length;d++){let m=a[d];switch(t[t.length-1]){case"ROOT":l(m,d,"FINISH");break;case"INSIDE_OBJECT_START":switch(m){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":s=d,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":m==='"'&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":m==='"'&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":m===":"&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":l(m,d,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":p(m,d);break;case"INSIDE_STRING":switch(m){case'"':t.pop(),s=d;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:s=d}break;case"INSIDE_ARRAY_START":m==="]"?(s=d,t.pop()):(s=d,l(m,d,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(m){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":s=d,t.pop();break;default:s=d}break;case"INSIDE_ARRAY_AFTER_COMMA":l(m,d,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),s=d;break;case"INSIDE_NUMBER":switch(m){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":s=d;break;case"e":case"E":case"-":case".":break;case",":t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&c(m,d),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&p(m,d);break;case"}":t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&p(m,d);break;case"]":t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&c(m,d);break;default:t.pop()}break;case"INSIDE_LITERAL":{let K=a.substring(o,d+1);"false".startsWith(K)||"true".startsWith(K)||"null".startsWith(K)?s=d:(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?p(m,d):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&c(m,d))}}}let v=a.slice(0,s+1);for(let d=t.length-1;d>=0;d--)switch(t[d]){case"INSIDE_STRING":v+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":v+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":v+="]";break;case"INSIDE_LITERAL":{let m=a.substring(o,a.length);"true".startsWith(m)?v+="true".slice(m.length):"false".startsWith(m)?v+="false".slice(m.length):"null".startsWith(m)&&(v+="null".slice(m.length))}}return v}(e)})).success?{value:r.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}var oe=[{code:"0",name:"text",parse:e=>{if(typeof e!="string")throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},{code:"3",name:"error",parse:e=>{if(typeof e!="string")throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},{code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},{code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},{code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},{code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},{code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw Error('"finish_message" parts expect an object with a "finishReason" property.');let r={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(r.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:r}}},{code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw Error('"finish_step" parts expect an object with a "finishReason" property.');let r={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(r.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(r.isContinued=e.isContinued),{type:"finish_step",value:r}}},{code:"f",name:"start_step",parse:e=>{if(e==null||typeof e!="object"||!("messageId"in e)||typeof e.messageId!="string")throw Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},{code:"g",name:"reasoning",parse:e=>{if(typeof e!="string")throw Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},{code:"h",name:"source",parse:e=>{if(e==null||typeof e!="object")throw Error('"source" parts expect a Source object.');return{type:"source",value:e}}},{code:"i",name:"redacted_reasoning",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string")throw Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},{code:"j",name:"reasoning_signature",parse:e=>{if(e==null||typeof e!="object"||!("signature"in e)||typeof e.signature!="string")throw Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},{code:"k",name:"file",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string"||!("mimeType"in e)||typeof e.mimeType!="string")throw Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}}],U=Object.fromEntries(oe.map(e=>[e.code,e]));Object.fromEntries(oe.map(e=>[e.name,e.code]));var I=oe.map(e=>e.code),g=e=>{let r=e.indexOf(":");if(r===-1)throw Error("Failed to parse stream string. No separator found.");let a=e.slice(0,r);if(!I.includes(a))throw Error(`Failed to parse stream string. Invalid code ${a}.`);let t=JSON.parse(e.slice(r+1));return U[a].parse(t)};function T(e,r){let a=oe.find(t=>t.name===e);if(!a)throw Error(`Invalid stream part type: ${e}`);return`${a.code}:${JSON.stringify(r)}
`}async function Te({stream:e,onTextPart:r,onReasoningPart:a,onReasoningSignaturePart:t,onRedactedReasoningPart:s,onSourcePart:o,onFilePart:l,onDataPart:p,onErrorPart:c,onToolCallStreamingStartPart:v,onToolCallDeltaPart:d,onToolCallPart:m,onToolResultPart:K,onMessageAnnotationsPart:Re,onFinishMessagePart:ve,onFinishStepPart:H,onStartStepPart:ue}){let Ze=e.getReader(),Ge=new TextDecoder,xe=[],De=0;for(;;){let{value:Ne}=await Ze.read();if(Ne&&(xe.push(Ne),De+=Ne.length,Ne[Ne.length-1]!==10))continue;if(xe.length===0)break;let G=function(Me,P){let pe=new Uint8Array(P),Fe=0;for(let se of Me)pe.set(se,Fe),Fe+=se.length;return Me.length=0,pe}(xe,De);for(let{type:Me,value:P}of(De=0,Ge.decode(G,{stream:!0}).split(`
`).filter(pe=>pe!=="").map(g)))switch(Me){case"text":await r?.(P);break;case"reasoning":await a?.(P);break;case"reasoning_signature":await t?.(P);break;case"redacted_reasoning":await s?.(P);break;case"file":await l?.(P);break;case"source":await o?.(P);break;case"data":await p?.(P);break;case"error":await c?.(P);break;case"message_annotations":await Re?.(P);break;case"tool_call_streaming_start":await v?.(P);break;case"tool_call_delta":await d?.(P);break;case"tool_call":await m?.(P);break;case"tool_result":await K?.(P);break;case"finish_message":await ve?.(P);break;case"finish_step":await H?.(P);break;case"start_step":await ue?.(P);break;default:throw Error(`Unknown stream part type: ${Me}`)}}}async function _e({stream:e,onTextPart:r}){let a=e.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:t,value:s}=await a.read();if(t)break;await r(s)}}var y=Symbol.for("vercel.ai.schema");function w(e){return typeof e=="object"&&e!==null&&y in e&&e[y]===!0&&"jsonSchema"in e&&"validate"in e?e:function(r,{validate:a}={}){return{[y]:!0,_type:void 0,[ae.eu]:!0,jsonSchema:r,validate:a}}(F(e,{$refStrategy:"none",target:"jsonSchema7"}),{validate:r=>{let a=e.safeParse(r);return a.success?{success:!0,value:a.data}:{success:!1,error:a.error}}})}var re=Object.defineProperty,ie=(e,r)=>{for(var a in r)re(e,a,{get:r[a],enumerable:!0})};function we(e,{contentType:r,dataStreamVersion:a}){let t=new Headers(e??{});return t.has("Content-Type")||t.set("Content-Type",r),a!==void 0&&t.set("X-Vercel-AI-Data-Stream",a),t}function Y(e,{contentType:r,dataStreamVersion:a}){let t={};if(e!=null)for(let[s,o]of Object.entries(e))t[s]=o;return t["Content-Type"]==null&&(t["Content-Type"]=r),a!==void 0&&(t["X-Vercel-AI-Data-Stream"]=a),t}function $e({response:e,status:r,statusText:a,headers:t,stream:s}){e.writeHead(r??200,a,t);let o=s.getReader();(async()=>{try{for(;;){let{done:l,value:p}=await o.read();if(l)break;e.write(p)}}catch(l){throw l}finally{e.end()}})()}var Be="AI_InvalidArgumentError",de=`vercel.ai.error.${Be}`,ze=Symbol.for(de),R=class extends f.bD{constructor({parameter:e,value:r,message:a}){super({name:Be,message:`Invalid argument for parameter ${e}: ${a}`}),this[W]=!0,this.parameter=e,this.value=r}static isInstance(e){return f.bD.hasMarker(e,de)}};W=ze;var Le="AI_RetryError",Pe=`vercel.ai.error.${Le}`,Xe=Symbol.for(Pe),ke=class extends f.bD{constructor({message:e,reason:r,errors:a}){super({name:Le,message:e}),this[n]=!0,this.reason=r,this.errors=a,this.lastError=a[a.length-1]}static isInstance(e){return f.bD.hasMarker(e,Pe)}};n=Xe;var Ie=({maxRetries:e=2,initialDelayInMs:r=2e3,backoffFactor:a=2}={})=>async t=>Q(t,{maxRetries:e,delayInMs:r,backoffFactor:a});async function Q(e,{maxRetries:r,delayInMs:a,backoffFactor:t},s=[]){try{return await e()}catch(o){if((0,ae.zf)(o)||r===0)throw o;let l=(0,ae.u1)(o),p=[...s,o],c=p.length;if(c>r)throw new ke({message:`Failed after ${c} attempts. Last error: ${l}`,reason:"maxRetriesExceeded",errors:p});if(o instanceof Error&&f.hL.isInstance(o)&&o.isRetryable===!0&&c<=r)return await(0,ae.cb)(a),Q(e,{maxRetries:r,delayInMs:t*a,backoffFactor:t},p);throw c===1?o:new ke({message:`Failed after ${c} attempts with non-retryable error: '${l}'`,reason:"errorNotRetryable",errors:p})}}function le({maxRetries:e}){if(e!=null){if(!Number.isInteger(e))throw new R({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new R({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let r=e??2;return{maxRetries:r,retry:Ie({maxRetries:r})}}function Qe({operationId:e,telemetry:r}){return{"operation.name":`${e}${r?.functionId!=null?` ${r.functionId}`:""}`,"resource.name":r?.functionId,"ai.operationId":e,"ai.telemetry.functionId":r?.functionId}}function ut({model:e,settings:r,telemetry:a,headers:t}){var s;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(r).reduce((o,[l,p])=>(o[`ai.settings.${l}`]=p,o),{}),...Object.entries((s=a?.metadata)!=null?s:{}).reduce((o,[l,p])=>(o[`ai.telemetry.metadata.${l}`]=p,o),{}),...Object.entries(t??{}).reduce((o,[l,p])=>(p!==void 0&&(o[`ai.request.headers.${l}`]=p),o),{})}}var jt={startSpan:()=>wt,startActiveSpan:(e,r,a,t)=>typeof r=="function"?r(wt):typeof a=="function"?a(wt):typeof t=="function"?t(wt):void 0},wt={spanContext:()=>rr,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},rr={traceId:"",spanId:"",traceFlags:0};function ft({isEnabled:e=!1,tracer:r}={}){return e?r||st.u.getTracer("ai"):jt}function kt({name:e,tracer:r,attributes:a,fn:t,endWhenDone:s=!0}){return r.startActiveSpan(e,{attributes:a},async o=>{try{let l=await t(o);return s&&o.end(),l}catch(l){try{l instanceof Error?(o.recordException({name:l.name,message:l.message,stack:l.stack}),o.setStatus({code:Se.s.ERROR,message:l.message})):o.setStatus({code:Se.s.ERROR})}finally{o.end()}throw l}})}function It({telemetry:e,attributes:r}){return e?.isEnabled!==!0?{}:Object.entries(r).reduce((a,[t,s])=>{if(s===void 0)return a;if(typeof s=="object"&&"input"in s&&typeof s.input=="function"){if(e?.recordInputs===!1)return a;let o=s.input();return o===void 0?a:{...a,[t]:o}}if(typeof s=="object"&&"output"in s&&typeof s.output=="function"){if(e?.recordOutputs===!1)return a;let o=s.output();return o===void 0?a:{...a,[t]:o}}return{...a,[t]:s}},{})}var _a="AI_NoImageGeneratedError",wa=`vercel.ai.error.${_a}`,ka=Symbol.for(wa);f.bD,Oe=ka;var kr=class{constructor({data:e,mimeType:r}){let a=e instanceof Uint8Array;this.base64Data=a?void 0:e,this.uint8ArrayData=a?e:void 0,this.mimeType=r}get base64(){return this.base64Data==null&&(this.base64Data=(0,ae.n_)(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=(0,ae.Z9)(this.base64Data)),this.uint8ArrayData}},Gs=class extends kr{constructor(e){super(e),this.type="file"}},Ia=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],xa=e=>{let r=typeof e=="string"?(0,ae.Z9)(e):e,a=(127&r[6])<<21|(127&r[7])<<14|(127&r[8])<<7|127&r[9];return r.slice(a+10)},Ir="AI_NoObjectGeneratedError",xr=`vercel.ai.error.${Ir}`,Sa=Symbol.for(xr),Ft=class extends f.bD{constructor({message:e="No object generated.",cause:r,text:a,response:t,usage:s,finishReason:o}){super({name:Ir,message:e,cause:r}),this[ee]=!0,this.text=a,this.response=t,this.usage=s,this.finishReason=o}static isInstance(e){return f.bD.hasMarker(e,xr)}};ee=Sa;var Sr="AI_DownloadError",Tr=`vercel.ai.error.${Sr}`,Ta=Symbol.for(Tr),lr=class extends f.bD{constructor({url:e,statusCode:r,statusText:a,cause:t,message:s=t==null?`Failed to download ${e}: ${r} ${a}`:`Failed to download ${e}: ${t}`}){super({name:Sr,message:s,cause:t}),this[M]=!0,this.url=e,this.statusCode=r,this.statusText=a}static isInstance(e){return f.bD.hasMarker(e,Tr)}};async function ja({url:e}){var r;let a=e.toString();try{let t=await fetch(a);if(!t.ok)throw new lr({url:a,statusCode:t.status,statusText:t.statusText});return{data:new Uint8Array(await t.arrayBuffer()),mimeType:(r=t.headers.get("content-type"))!=null?r:void 0}}catch(t){throw lr.isInstance(t)?t:new lr({url:a,cause:t})}}M=Ta;var jr="AI_InvalidDataContentError",Er=`vercel.ai.error.${jr}`,Ea=Symbol.for(Er),Rr=class extends f.bD{constructor({content:e,cause:r,message:a=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:jr,message:a,cause:r}),this[C]=!0,this.content=e}static isInstance(e){return f.bD.hasMarker(e,Er)}};C=Ea;var Cr=i.KC([i.Yj(),i.Nl(Uint8Array),i.Nl(ArrayBuffer),i.Ie(e=>{var r,a;return(a=(r=ir.Buffer)==null?void 0:r.isBuffer(e))!=null&&a},{message:"Must be a Buffer"})]);function ur(e){return typeof e=="string"?e:e instanceof ArrayBuffer?(0,ae.n_)(new Uint8Array(e)):(0,ae.n_)(e)}function nr(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return(0,ae.Z9)(e)}catch(r){throw new Rr({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:r})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new Rr({content:e})}var Ar="AI_InvalidMessageRoleError",Nr=`vercel.ai.error.${Ar}`,Ra=Symbol.for(Nr),Ca=class extends f.bD{constructor({role:e,message:r=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:Ar,message:r}),this[x]=!0,this.role=e}static isInstance(e){return f.bD.hasMarker(e,Nr)}};async function pr({prompt:e,modelSupportsImageUrls:r=!0,modelSupportsUrl:a=()=>!1,downloadImplementation:t=ja}){let s=await Aa(e.messages,t,r,a);return[...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(o=>function(l,p){var c,v,d,m,K,Re;let ve=l.role;switch(ve){case"system":return{role:"system",content:l.content,providerMetadata:(c=l.providerOptions)!=null?c:l.experimental_providerMetadata};case"user":return typeof l.content=="string"?{role:"user",content:[{type:"text",text:l.content}],providerMetadata:(v=l.providerOptions)!=null?v:l.experimental_providerMetadata}:{role:"user",content:l.content.map(H=>function(ue,Ze){var Ge,xe,De,Ne;let G,Me,P;if(ue.type==="text")return{type:"text",text:ue.text,providerMetadata:(Ge=ue.providerOptions)!=null?Ge:ue.experimental_providerMetadata};let pe=ue.mimeType,Fe=ue.type;switch(Fe){case"image":G=ue.image;break;case"file":G=ue.data;break;default:throw Error(`Unsupported part type: ${Fe}`)}try{Me=typeof G=="string"?new URL(G):G}catch{Me=G}if(Me instanceof URL)if(Me.protocol==="data:"){let{mimeType:se,base64Content:Ke}=function(ot){try{let[qe,it]=ot.split(",");return{mimeType:qe.split(";")[0].split(":")[1],base64Content:it}}catch{return{mimeType:void 0,base64Content:void 0}}}(Me.toString());if(se==null||Ke==null)throw Error(`Invalid data URL format in part ${Fe}`);pe=se,P=nr(Ke)}else{let se=Ze[Me.toString()];se?(P=se.data,pe!=null||(pe=se.mimeType)):P=Me}else P=nr(Me);switch(Fe){case"image":return P instanceof Uint8Array&&(pe=(xe=function({data:se,signatures:Ke}){let ot=typeof se=="string"&&se.startsWith("SUQz")||typeof se!="string"&&se.length>10&&se[0]===73&&se[1]===68&&se[2]===51?xa(se):se;for(let qe of Ke)if(typeof ot=="string"?ot.startsWith(qe.base64Prefix):ot.length>=qe.bytesPrefix.length&&qe.bytesPrefix.every((it,yt)=>ot[yt]===it))return qe.mimeType}({data:P,signatures:Ia}))!=null?xe:pe),{type:"image",image:P,mimeType:pe,providerMetadata:(De=ue.providerOptions)!=null?De:ue.experimental_providerMetadata};case"file":if(pe==null)throw Error("Mime type is missing for file part");return{type:"file",data:P instanceof Uint8Array?ur(P):P,filename:ue.filename,mimeType:pe,providerMetadata:(Ne=ue.providerOptions)!=null?Ne:ue.experimental_providerMetadata}}}(H,p)).filter(H=>H.type!=="text"||H.text!==""),providerMetadata:(d=l.providerOptions)!=null?d:l.experimental_providerMetadata};case"assistant":return typeof l.content=="string"?{role:"assistant",content:[{type:"text",text:l.content}],providerMetadata:(m=l.providerOptions)!=null?m:l.experimental_providerMetadata}:{role:"assistant",content:l.content.filter(H=>H.type!=="text"||H.text!=="").map(H=>{var ue;let Ze=(ue=H.providerOptions)!=null?ue:H.experimental_providerMetadata;switch(H.type){case"file":return{type:"file",data:H.data instanceof URL?H.data:ur(H.data),filename:H.filename,mimeType:H.mimeType,providerMetadata:Ze};case"reasoning":return{type:"reasoning",text:H.text,signature:H.signature,providerMetadata:Ze};case"redacted-reasoning":return{type:"redacted-reasoning",data:H.data,providerMetadata:Ze};case"text":return{type:"text",text:H.text,providerMetadata:Ze};case"tool-call":return{type:"tool-call",toolCallId:H.toolCallId,toolName:H.toolName,args:H.args,providerMetadata:Ze}}}),providerMetadata:(K=l.providerOptions)!=null?K:l.experimental_providerMetadata};case"tool":return{role:"tool",content:l.content.map(H=>{var ue;return{type:"tool-result",toolCallId:H.toolCallId,toolName:H.toolName,result:H.result,content:H.experimental_content,isError:H.isError,providerMetadata:(ue=H.providerOptions)!=null?ue:H.experimental_providerMetadata}}),providerMetadata:(Re=l.providerOptions)!=null?Re:l.experimental_providerMetadata};default:throw new Ca({role:ve})}}(o,s))]}async function Aa(e,r,a,t){let s=e.filter(o=>o.role==="user").map(o=>o.content).filter(o=>Array.isArray(o)).flat().filter(o=>o.type==="image"||o.type==="file").filter(o=>o.type!=="image"||a!==!0).map(o=>o.type==="image"?o.image:o.data).map(o=>typeof o=="string"&&(o.startsWith("http:")||o.startsWith("https:"))?new URL(o):o).filter(o=>o instanceof URL).filter(o=>!t(o));return Object.fromEntries((await Promise.all(s.map(async o=>({url:o,data:await r({url:o})})))).map(({url:o,data:l})=>[o.toString(),l]))}function cr({maxTokens:e,temperature:r,topP:a,topK:t,presencePenalty:s,frequencyPenalty:o,stopSequences:l,seed:p}){if(e!=null){if(!Number.isInteger(e))throw new R({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new R({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(r!=null&&typeof r!="number")throw new R({parameter:"temperature",value:r,message:"temperature must be a number"});if(a!=null&&typeof a!="number")throw new R({parameter:"topP",value:a,message:"topP must be a number"});if(t!=null&&typeof t!="number")throw new R({parameter:"topK",value:t,message:"topK must be a number"});if(s!=null&&typeof s!="number")throw new R({parameter:"presencePenalty",value:s,message:"presencePenalty must be a number"});if(o!=null&&typeof o!="number")throw new R({parameter:"frequencyPenalty",value:o,message:"frequencyPenalty must be a number"});if(p!=null&&!Number.isInteger(p))throw new R({parameter:"seed",value:p,message:"seed must be an integer"});return{maxTokens:e,temperature:r??0,topP:a,topK:t,presencePenalty:s,frequencyPenalty:o,stopSequences:l!=null&&l.length>0?l:void 0,seed:p}}function Mr(e){var r,a,t;let s=[];for(let o of e){let l;try{l=new URL(o.url)}catch{throw Error(`Invalid URL: ${o.url}`)}switch(l.protocol){case"http:":case"https:":if((r=o.contentType)!=null&&r.startsWith("image/"))s.push({type:"image",image:l});else{if(!o.contentType)throw Error("If the attachment is not an image, it must specify a content type");s.push({type:"file",data:l,mimeType:o.contentType})}break;case"data:":{let p,c,v;try{[p,c]=o.url.split(","),v=p.split(";")[0].split(":")[1]}catch{throw Error(`Error processing data URL: ${o.url}`)}if(v==null||c==null)throw Error(`Invalid data URL format: ${o.url}`);if((a=o.contentType)!=null&&a.startsWith("image/"))s.push({type:"image",image:nr(c)});else if((t=o.contentType)!=null&&t.startsWith("text/"))s.push({type:"text",text:function(d){try{return new TextDecoder().decode(d)}catch{throw Error("Error decoding Uint8Array to text")}}(nr(c))});else{if(!o.contentType)throw Error("If the attachment is not an image or text, it must specify a content type");s.push({type:"file",data:c,mimeType:o.contentType})}break}default:throw Error(`Unsupported URL protocol: ${l.protocol}`)}}return s}x=Ra;var Or="AI_MessageConversionError",Pr=`vercel.ai.error.${Or}`,Na=Symbol.for(Pr),dr=class extends f.bD{constructor({originalMessage:e,message:r}){super({name:Or,message:r}),this[q]=!0,this.originalMessage=e}static isInstance(e){return f.bD.hasMarker(e,Pr)}};q=Na;var mr=i.RZ(()=>i.KC([i.ch(),i.Yj(),i.ai(),i.zM(),i.g1(i.Yj(),mr),i.YO(mr)])),Ve=i.g1(i.Yj(),i.g1(i.Yj(),mr)),Ma=i.YO(i.KC([i.Ik({type:i.eu("text"),text:i.Yj()}),i.Ik({type:i.eu("image"),data:i.Yj(),mimeType:i.Yj().optional()})])),Yr=i.Ik({type:i.eu("text"),text:i.Yj(),providerOptions:Ve.optional(),experimental_providerMetadata:Ve.optional()}),Oa=i.Ik({type:i.eu("image"),image:i.KC([Cr,i.Nl(URL)]),mimeType:i.Yj().optional(),providerOptions:Ve.optional(),experimental_providerMetadata:Ve.optional()}),$r=i.Ik({type:i.eu("file"),data:i.KC([Cr,i.Nl(URL)]),filename:i.Yj().optional(),mimeType:i.Yj(),providerOptions:Ve.optional(),experimental_providerMetadata:Ve.optional()}),Pa=i.Ik({type:i.eu("reasoning"),text:i.Yj(),providerOptions:Ve.optional(),experimental_providerMetadata:Ve.optional()}),Ya=i.Ik({type:i.eu("redacted-reasoning"),data:i.Yj(),providerOptions:Ve.optional(),experimental_providerMetadata:Ve.optional()}),$a=i.Ik({type:i.eu("tool-call"),toolCallId:i.Yj(),toolName:i.Yj(),args:i.L5(),providerOptions:Ve.optional(),experimental_providerMetadata:Ve.optional()}),Da=i.Ik({type:i.eu("tool-result"),toolCallId:i.Yj(),toolName:i.Yj(),result:i.L5(),content:Ma.optional(),isError:i.zM().optional(),providerOptions:Ve.optional(),experimental_providerMetadata:Ve.optional()}),qa=i.Ik({role:i.eu("system"),content:i.Yj(),providerOptions:Ve.optional(),experimental_providerMetadata:Ve.optional()}),Ua=i.Ik({role:i.eu("user"),content:i.KC([i.Yj(),i.YO(i.KC([Yr,Oa,$r]))]),providerOptions:Ve.optional(),experimental_providerMetadata:Ve.optional()}),Fa=i.Ik({role:i.eu("assistant"),content:i.KC([i.Yj(),i.YO(i.KC([Yr,$r,Pa,Ya,$a]))]),providerOptions:Ve.optional(),experimental_providerMetadata:Ve.optional()}),La=i.Ik({role:i.eu("tool"),content:i.YO(Da),providerOptions:Ve.optional(),experimental_providerMetadata:Ve.optional()}),Za=i.KC([qa,Ua,Fa,La]);function hr({prompt:e,tools:r}){if(e.prompt==null&&e.messages==null)throw new f.M3({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new f.M3({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new f.M3({prompt:e,message:"system must be a string"});if(e.prompt!=null){if(typeof e.prompt!="string")throw new f.M3({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(e.messages!=null){let a=function(s){if(!Array.isArray(s))throw new f.M3({prompt:s,message:`messages must be an array of CoreMessage or UIMessage
Received non-array value: ${JSON.stringify(s)}`,cause:s});if(s.length===0)return"messages";let o=s.map(Ba);if(o.some(p=>p==="has-ui-specific-parts"))return"ui-messages";let l=o.findIndex(p=>p!=="has-core-specific-parts"&&p!=="message");if(l===-1)return"messages";throw new f.M3({prompt:s,message:`messages must be an array of CoreMessage or UIMessage
Received message of type: "${o[l]}" at index ${l}
messages[${l}]: ${JSON.stringify(s[l])}`,cause:s})}(e.messages)==="ui-messages"?function(s,o){var l,p;let c=(l=o?.tools)!=null?l:{},v=[];for(let d=0;d<s.length;d++){let m=s[d],K=d===s.length-1,{role:Re,content:ve,experimental_attachments:H}=m;switch(Re){case"system":v.push({role:"system",content:ve});break;case"user":if(m.parts==null)v.push({role:"user",content:H?[{type:"text",text:ve},...Mr(H)]:ve});else{let ue=m.parts.filter(Ze=>Ze.type==="text").map(Ze=>({type:"text",text:Ze.text}));v.push({role:"user",content:H?[...ue,...Mr(H)]:ue})}break;case"assistant":{if(m.parts!=null){let Ge=function(){let G=[];for(let P of Ne)switch(P.type){case"file":case"text":G.push(P);break;case"reasoning":for(let pe of P.details)switch(pe.type){case"text":G.push({type:"reasoning",text:pe.text,signature:pe.signature});break;case"redacted":G.push({type:"redacted-reasoning",data:pe.data})}break;case"tool-invocation":G.push({type:"tool-call",toolCallId:P.toolInvocation.toolCallId,toolName:P.toolInvocation.toolName,args:P.toolInvocation.args});break;default:throw Error(`Unsupported part: ${P}`)}v.push({role:"assistant",content:G});let Me=Ne.filter(P=>P.type==="tool-invocation").map(P=>P.toolInvocation);Me.length>0&&v.push({role:"tool",content:Me.map(P=>{if(!("result"in P))throw new dr({originalMessage:m,message:"ToolInvocation must have a result: "+JSON.stringify(P)});let{toolCallId:pe,toolName:Fe,result:se}=P,Ke=c[Fe];return Ke?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:pe,toolName:Fe,result:Ke.experimental_toToolResultContent(se),experimental_content:Ke.experimental_toToolResultContent(se)}:{type:"tool-result",toolCallId:pe,toolName:Fe,result:se}})}),Ne=[],De=!1,xe++},xe=0,De=!1,Ne=[];for(let G of m.parts)switch(G.type){case"text":De&&Ge(),Ne.push(G);break;case"file":case"reasoning":Ne.push(G);break;case"tool-invocation":((p=G.toolInvocation.step)!=null?p:0)!==xe&&Ge(),Ne.push(G),De=!0}Ge();break}let ue=m.toolInvocations;if(ue==null||ue.length===0){v.push({role:"assistant",content:ve});break}let Ze=ue.reduce((Ge,xe)=>{var De;return Math.max(Ge,(De=xe.step)!=null?De:0)},0);for(let Ge=0;Ge<=Ze;Ge++){let xe=ue.filter(De=>{var Ne;return((Ne=De.step)!=null?Ne:0)===Ge});xe.length!==0&&(v.push({role:"assistant",content:[...K&&ve&&Ge===0?[{type:"text",text:ve}]:[],...xe.map(({toolCallId:De,toolName:Ne,args:G})=>({type:"tool-call",toolCallId:De,toolName:Ne,args:G}))]}),v.push({role:"tool",content:xe.map(De=>{if(!("result"in De))throw new dr({originalMessage:m,message:"ToolInvocation must have a result: "+JSON.stringify(De)});let{toolCallId:Ne,toolName:G,result:Me}=De,P=c[G];return P?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:Ne,toolName:G,result:P.experimental_toToolResultContent(Me),experimental_content:P.experimental_toToolResultContent(Me)}:{type:"tool-result",toolCallId:Ne,toolName:G,result:Me}})}))}ve&&!K&&v.push({role:"assistant",content:ve});break}case"data":break;default:throw new dr({originalMessage:m,message:`Unsupported role: ${Re}`})}}return v}(e.messages,{tools:r}):e.messages;if(a.length===0)throw new f.M3({prompt:e,message:"messages must not be empty"});let t=(0,ae.ZZ)({value:a,schema:i.YO(Za)});if(!t.success)throw new f.M3({prompt:e,message:`message must be a CoreMessage or a UI message
Validation error: ${t.error.message}`,cause:t.error});return{type:"messages",messages:a,system:e.system}}throw Error("unreachable")}function Ba(e){return typeof e=="object"&&e!==null&&(e.role==="function"||e.role==="data"||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":typeof e=="object"&&e!==null&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":typeof e=="object"&&e!==null&&"role"in e&&"content"in e&&typeof e.content=="string"&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function Zt({promptTokens:e,completionTokens:r}){return{promptTokens:e,completionTokens:r,totalTokens:e+r}}function Va(e,r){return{promptTokens:e.promptTokens+r.promptTokens,completionTokens:e.completionTokens+r.completionTokens,totalTokens:e.totalTokens+r.totalTokens}}function gr({prompt:e,schema:r,schemaPrefix:a=r!=null?"JSON schema:":void 0,schemaSuffix:t=r!=null?"You MUST answer with a JSON object that matches the JSON schema above.":"You MUST answer with JSON."}){return[e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?"":void 0,a,r!=null?JSON.stringify(r):void 0,t].filter(s=>s!=null).join(`
`)}function Ja(e){let r=e.pipeThrough(new TransformStream);return r[Symbol.asyncIterator]=()=>{let a=r.getReader();return{async next(){let{done:t,value:s}=await a.read();return t?{done:!0,value:void 0}:{done:!1,value:s}}}},r}var za={type:"no-schema",jsonSchema:void 0,validatePartialResult:({value:e,textDelta:r})=>({success:!0,value:{partial:e,textDelta:r}}),validateFinalResult:(e,r)=>e===void 0?{success:!1,error:new Ft({message:"No object generated: response did not match schema.",text:r.text,response:r.response,usage:r.usage,finishReason:r.finishReason})}:{success:!0,value:e},createElementStream(){throw new f.b8({functionality:"element streams in no-schema mode"})}},Ka=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult:({value:r,textDelta:a})=>({success:!0,value:{partial:r,textDelta:a}}),validateFinalResult:r=>(0,ae.ZZ)({value:r,schema:e}),createElementStream(){throw new f.b8({functionality:"element streams in object mode"})}}),Ha=e=>{let{$schema:r,...a}=e.jsonSchema;return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:a}},required:["elements"],additionalProperties:!1},validatePartialResult({value:t,latestObject:s,isFirstDelta:o,isFinalDelta:l}){var p;if(!(0,f.k9)(t)||!(0,f.cj)(t.elements))return{success:!1,error:new f.iM({value:t,cause:"value must be an object that contains an array of elements"})};let c=t.elements,v=[];for(let K=0;K<c.length;K++){let Re=c[K],ve=(0,ae.ZZ)({value:Re,schema:e});if(K!==c.length-1||l){if(!ve.success)return ve;v.push(ve.value)}}let d=(p=s?.length)!=null?p:0,m="";return o&&(m+="["),d>0&&(m+=","),m+=v.slice(d).map(K=>JSON.stringify(K)).join(","),l&&(m+="]"),{success:!0,value:{partial:v,textDelta:m}}},validateFinalResult(t){if(!(0,f.k9)(t)||!(0,f.cj)(t.elements))return{success:!1,error:new f.iM({value:t,cause:"value must be an object that contains an array of elements"})};let s=t.elements;for(let o of s){let l=(0,ae.ZZ)({value:o,schema:e});if(!l.success)return l}return{success:!0,value:s}},createElementStream(t){let s=0;return Ja(t.pipeThrough(new TransformStream({transform(o,l){switch(o.type){case"object":{let p=o.object;for(;s<p.length;s++)l.enqueue(p[s]);break}case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${o}`)}}})))}}},Ga=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},validateFinalResult(r){if(!(0,f.k9)(r)||typeof r.result!="string")return{success:!1,error:new f.iM({value:r,cause:'value must be an object that contains a string in the "result" property.'})};let a=r.result;return e.includes(a)?{success:!0,value:a}:{success:!1,error:new f.iM({value:r,cause:"value must be a string in the enum"})}},validatePartialResult(){throw new f.b8({functionality:"partial results in enum mode"})},createElementStream(){throw new f.b8({functionality:"element streams in enum mode"})}});function Dr(e){return JSON.stringify(e.map(r=>({...r,content:typeof r.content=="string"?r.content:r.content.map(Wa)})))}function Wa(e){return e.type==="image"?{...e,image:e.image instanceof Uint8Array?ur(e.image):e.image}:e}var Xa=(0,ae.hK)({prefix:"aiobj",size:24});async function Qa({model:e,enum:r,schema:a,schemaName:t,schemaDescription:s,mode:o,output:l="object",system:p,prompt:c,messages:v,maxRetries:d,abortSignal:m,headers:K,experimental_repairText:Re,experimental_telemetry:ve,experimental_providerMetadata:H,providerOptions:ue=H,_internal:{generateId:Ze=Xa,currentDate:Ge=()=>new Date}={},...xe}){(function({output:pe,mode:Fe,schema:se,schemaName:Ke,schemaDescription:ot,enumValues:qe}){if(pe!=null&&pe!=="object"&&pe!=="array"&&pe!=="enum"&&pe!=="no-schema")throw new R({parameter:"output",value:pe,message:"Invalid output type."});if(pe==="no-schema"){if(Fe==="auto"||Fe==="tool")throw new R({parameter:"mode",value:Fe,message:'Mode must be "json" for no-schema output.'});if(se!=null)throw new R({parameter:"schema",value:se,message:"Schema is not supported for no-schema output."});if(ot!=null)throw new R({parameter:"schemaDescription",value:ot,message:"Schema description is not supported for no-schema output."});if(Ke!=null)throw new R({parameter:"schemaName",value:Ke,message:"Schema name is not supported for no-schema output."});if(qe!=null)throw new R({parameter:"enumValues",value:qe,message:"Enum values are not supported for no-schema output."})}if(pe==="object"){if(se==null)throw new R({parameter:"schema",value:se,message:"Schema is required for object output."});if(qe!=null)throw new R({parameter:"enumValues",value:qe,message:"Enum values are not supported for object output."})}if(pe==="array"){if(se==null)throw new R({parameter:"schema",value:se,message:"Element schema is required for array output."});if(qe!=null)throw new R({parameter:"enumValues",value:qe,message:"Enum values are not supported for array output."})}if(pe==="enum"){if(se!=null)throw new R({parameter:"schema",value:se,message:"Schema is not supported for enum output."});if(ot!=null)throw new R({parameter:"schemaDescription",value:ot,message:"Schema description is not supported for enum output."});if(Ke!=null)throw new R({parameter:"schemaName",value:Ke,message:"Schema name is not supported for enum output."});if(qe==null)throw new R({parameter:"enumValues",value:qe,message:"Enum values are required for enum output."});for(let it of qe)if(typeof it!="string")throw new R({parameter:"enumValues",value:it,message:"Enum values must be strings."})}})({output:l,mode:o,schema:a,schemaName:t,schemaDescription:s,enumValues:r});let{maxRetries:De,retry:Ne}=le({maxRetries:d}),G=function({output:pe,schema:Fe,enumValues:se}){switch(pe){case"object":return Ka(w(Fe));case"array":return Ha(w(Fe));case"enum":return Ga(se);case"no-schema":return za;default:throw Error(`Unsupported output: ${pe}`)}}({output:l,schema:a,enumValues:r});G.type==="no-schema"&&o===void 0&&(o="json");let Me=ut({model:e,telemetry:ve,headers:K,settings:{...xe,maxRetries:De}}),P=ft(ve);return kt({name:"ai.generateObject",attributes:It({telemetry:ve,attributes:{...Qe({operationId:"ai.generateObject",telemetry:ve}),...Me,"ai.prompt":{input:()=>JSON.stringify({system:p,prompt:c,messages:v})},"ai.schema":G.jsonSchema!=null?{input:()=>JSON.stringify(G.jsonSchema)}:void 0,"ai.schema.name":t,"ai.schema.description":s,"ai.settings.output":G.type,"ai.settings.mode":o}}),tracer:P,fn:async pe=>{var Fe,se,Ke,ot;let qe,it,yt,zt,Pt,Yt,Kt,Ht,Gt,Vt;switch((o==="auto"||o==null)&&(o=e.defaultObjectGenerationMode),o){case"json":{let Je=hr({prompt:{system:G.jsonSchema==null?gr({prompt:p}):e.supportsStructuredOutputs?p:gr({prompt:p,schema:G.jsonSchema}),prompt:c,messages:v},tools:void 0}),pt=await pr({prompt:Je,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(Fe=e.supportsUrl)==null?void 0:Fe.bind(e)}),et=await Ne(()=>kt({name:"ai.generateObject.doGenerate",attributes:It({telemetry:ve,attributes:{...Qe({operationId:"ai.generateObject.doGenerate",telemetry:ve}),...Me,"ai.prompt.format":{input:()=>Je.type},"ai.prompt.messages":{input:()=>JSON.stringify(pt)},"ai.settings.mode":o,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":xe.frequencyPenalty,"gen_ai.request.max_tokens":xe.maxTokens,"gen_ai.request.presence_penalty":xe.presencePenalty,"gen_ai.request.temperature":xe.temperature,"gen_ai.request.top_k":xe.topK,"gen_ai.request.top_p":xe.topP}}),tracer:P,fn:async B=>{var Wt,ht,Et,Rt,$t,xt;let Ye=await e.doGenerate({mode:{type:"object-json",schema:G.jsonSchema,name:t,description:s},...cr(xe),inputFormat:Je.type,prompt:pt,providerMetadata:ue,abortSignal:m,headers:K}),vt={id:(ht=(Wt=Ye.response)==null?void 0:Wt.id)!=null?ht:Ze(),timestamp:(Rt=(Et=Ye.response)==null?void 0:Et.timestamp)!=null?Rt:Ge(),modelId:(xt=($t=Ye.response)==null?void 0:$t.modelId)!=null?xt:e.modelId};if(Ye.text===void 0)throw new Ft({message:"No object generated: the model did not return a response.",response:vt,usage:Zt(Ye.usage),finishReason:Ye.finishReason});return B.setAttributes(It({telemetry:ve,attributes:{"ai.response.finishReason":Ye.finishReason,"ai.response.object":{output:()=>Ye.text},"ai.response.id":vt.id,"ai.response.model":vt.modelId,"ai.response.timestamp":vt.timestamp.toISOString(),"ai.usage.promptTokens":Ye.usage.promptTokens,"ai.usage.completionTokens":Ye.usage.completionTokens,"gen_ai.response.finish_reasons":[Ye.finishReason],"gen_ai.response.id":vt.id,"gen_ai.response.model":vt.modelId,"gen_ai.usage.prompt_tokens":Ye.usage.promptTokens,"gen_ai.usage.completion_tokens":Ye.usage.completionTokens}})),{...Ye,objectText:Ye.text,responseData:vt}}}));qe=et.objectText,it=et.finishReason,yt=et.usage,zt=et.warnings,Pt=et.rawResponse,Ht=et.logprobs,Gt=et.providerMetadata,Kt=(se=et.request)!=null?se:{},Yt=et.responseData;break}case"tool":{let Je=hr({prompt:{system:p,prompt:c,messages:v},tools:void 0}),pt=await pr({prompt:Je,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(Ke=e.supportsUrl)==null?void 0:Ke.bind(e)}),et=Je.type,B=await Ne(()=>kt({name:"ai.generateObject.doGenerate",attributes:It({telemetry:ve,attributes:{...Qe({operationId:"ai.generateObject.doGenerate",telemetry:ve}),...Me,"ai.prompt.format":{input:()=>et},"ai.prompt.messages":{input:()=>Dr(pt)},"ai.settings.mode":o,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":xe.frequencyPenalty,"gen_ai.request.max_tokens":xe.maxTokens,"gen_ai.request.presence_penalty":xe.presencePenalty,"gen_ai.request.temperature":xe.temperature,"gen_ai.request.top_k":xe.topK,"gen_ai.request.top_p":xe.topP}}),tracer:P,fn:async Wt=>{var ht,Et,Rt,$t,xt,Ye,vt,Xt;let at=await e.doGenerate({mode:{type:"object-tool",tool:{type:"function",name:t??"json",description:s??"Respond with a JSON object.",parameters:G.jsonSchema}},...cr(xe),inputFormat:et,prompt:pt,providerMetadata:ue,abortSignal:m,headers:K}),At=(Et=(ht=at.toolCalls)==null?void 0:ht[0])==null?void 0:Et.args,Ct={id:($t=(Rt=at.response)==null?void 0:Rt.id)!=null?$t:Ze(),timestamp:(Ye=(xt=at.response)==null?void 0:xt.timestamp)!=null?Ye:Ge(),modelId:(Xt=(vt=at.response)==null?void 0:vt.modelId)!=null?Xt:e.modelId};if(At===void 0)throw new Ft({message:"No object generated: the tool was not called.",response:Ct,usage:Zt(at.usage),finishReason:at.finishReason});return Wt.setAttributes(It({telemetry:ve,attributes:{"ai.response.finishReason":at.finishReason,"ai.response.object":{output:()=>At},"ai.response.id":Ct.id,"ai.response.model":Ct.modelId,"ai.response.timestamp":Ct.timestamp.toISOString(),"ai.usage.promptTokens":at.usage.promptTokens,"ai.usage.completionTokens":at.usage.completionTokens,"gen_ai.response.finish_reasons":[at.finishReason],"gen_ai.response.id":Ct.id,"gen_ai.response.model":Ct.modelId,"gen_ai.usage.input_tokens":at.usage.promptTokens,"gen_ai.usage.output_tokens":at.usage.completionTokens}})),{...at,objectText:At,responseData:Ct}}}));qe=B.objectText,it=B.finishReason,yt=B.usage,zt=B.warnings,Pt=B.rawResponse,Ht=B.logprobs,Gt=B.providerMetadata,Kt=(ot=B.request)!=null?ot:{},Yt=B.responseData;break}case void 0:throw Error("Model does not have a default object generation mode.");default:throw Error(`Unsupported mode: ${o}`)}function ar(Je){let pt=(0,ae.N8)({text:Je});if(!pt.success)throw new Ft({message:"No object generated: could not parse the response.",cause:pt.error,text:Je,response:Yt,usage:Zt(yt),finishReason:it});let et=G.validateFinalResult(pt.value,{text:Je,response:Yt,usage:Zt(yt)});if(!et.success)throw new Ft({message:"No object generated: response did not match schema.",cause:et.error,text:Je,response:Yt,usage:Zt(yt),finishReason:it});return et.value}try{Vt=ar(qe)}catch(Je){if(Re!=null&&Ft.isInstance(Je)&&(f.u6.isInstance(Je.cause)||f.iM.isInstance(Je.cause))){let pt=await Re({text:qe,error:Je.cause});if(pt===null)throw Je;Vt=ar(pt)}else throw Je}return pe.setAttributes(It({telemetry:ve,attributes:{"ai.response.finishReason":it,"ai.response.object":{output:()=>JSON.stringify(Vt)},"ai.usage.promptTokens":yt.promptTokens,"ai.usage.completionTokens":yt.completionTokens}})),new es({object:Vt,finishReason:it,usage:Zt(yt),warnings:zt,request:Kt,response:{...Yt,headers:Pt?.headers,body:Pt?.body},logprobs:Ht,providerMetadata:Gt})}})}var es=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.experimental_providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.logprobs=e.logprobs}toJsonResponse(e){var r;return new Response(JSON.stringify(this.object),{status:(r=e?.status)!=null?r:200,headers:we(e?.headers,{contentType:"application/json; charset=utf-8"})})}},Ws=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise||(this.promise=new Promise((e,r)=>{this.status.type==="resolved"?e(this.status.value):this.status.type==="rejected"&&r(this.status.error),this._resolve=e,this._reject=r})),this.promise}resolve(e){var r;this.status={type:"resolved",value:e},this.promise&&((r=this._resolve)==null||r.call(this,e))}reject(e){var r;this.status={type:"rejected",error:e},this.promise&&((r=this._reject)==null||r.call(this,e))}};function qr(){let e,r;return{promise:new Promise((a,t)=>{e=a,r=t}),resolve:e,reject:r}}function Xs(){let e=[],r=null,a=!1,t=qr(),s=async()=>{if(a&&e.length===0){r?.close();return}if(e.length===0)return t=qr(),await t.promise,s();try{let{value:o,done:l}=await e[0].read();l?(e.shift(),e.length>0?await s():a&&r?.close()):r?.enqueue(o)}catch(o){r?.error(o),e.shift(),a&&e.length===0&&r?.close()}};return{stream:new ReadableStream({start(o){r=o},pull:s,async cancel(){for(let o of e)await o.cancel();e=[],a=!0}}),addStream:o=>{if(a)throw Error("Cannot add inner stream: outer stream is closed");e.push(o.getReader()),t.resolve()},close:()=>{a=!0,t.resolve(),e.length===0&&r?.close()},terminate:()=>{a=!0,t.resolve(),e.forEach(o=>o.cancel()),e=[],r?.close()}}}(0,ae.hK)({prefix:"aiobj",size:24});var Ur="AI_NoOutputSpecifiedError",Fr=`vercel.ai.error.${Ur}`,ts=Symbol.for(Fr),rs=class extends f.bD{constructor({message:e="No output specified."}={}){super({name:Ur,message:e}),this[he]=!0}static isInstance(e){return f.bD.hasMarker(e,Fr)}};he=ts;var Lr="AI_ToolExecutionError",Zr=`vercel.ai.error.${Lr}`,as=Symbol.for(Zr),ss=class extends f.bD{constructor({toolArgs:e,toolName:r,toolCallId:a,cause:t,message:s=`Error executing tool ${r}: ${(0,f.u1)(t)}`}){super({name:Lr,message:s,cause:t}),this[ce]=!0,this.toolArgs=e,this.toolName=r,this.toolCallId=a}static isInstance(e){return f.bD.hasMarker(e,Zr)}};function ns({tools:e,toolChoice:r,activeTools:a}){return e!=null&&Object.keys(e).length>0?{tools:(a!=null?Object.entries(e).filter(([t])=>a.includes(t)):Object.entries(e)).map(([t,s])=>{let o=s.type;switch(o){case void 0:case"function":return{type:"function",name:t,description:s.description,parameters:w(s.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:t,id:s.id,args:s.args};default:throw Error(`Unsupported tool type: ${o}`)}}),toolChoice:r==null?{type:"auto"}:typeof r=="string"?{type:r}:{type:"tool",toolName:r.toolName}}:{tools:void 0,toolChoice:void 0}}ce=as;var os=/^([\s\S]*?)(\s+)(\S*)$/;function is(e){let r=e.match(os);return r?{prefix:r[1],whitespace:r[2],suffix:r[3]}:void 0}var Br="AI_InvalidToolArgumentsError",Vr=`vercel.ai.error.${Br}`,ls=Symbol.for(Vr),Jr=class extends f.bD{constructor({toolArgs:e,toolName:r,cause:a,message:t=`Invalid arguments for tool ${r}: ${(0,f.u1)(a)}`}){super({name:Br,message:t,cause:a}),this[Ce]=!0,this.toolArgs=e,this.toolName=r}static isInstance(e){return f.bD.hasMarker(e,Vr)}};Ce=ls;var zr="AI_NoSuchToolError",Kr=`vercel.ai.error.${zr}`,us=Symbol.for(Kr),fr=class extends f.bD{constructor({toolName:e,availableTools:r,message:a=`Model tried to call unavailable tool '${e}'. ${r===void 0?"No tools are available.":`Available tools: ${r.join(", ")}.`}`}){super({name:zr,message:a}),this[ge]=!0,this.toolName=e,this.availableTools=r}static isInstance(e){return f.bD.hasMarker(e,Kr)}};ge=us;var Hr="AI_ToolCallRepairError",Gr=`vercel.ai.error.${Hr}`,ps=Symbol.for(Gr),cs=class extends f.bD{constructor({cause:e,originalError:r,message:a=`Error repairing tool call: ${(0,f.u1)(e)}`}){super({name:Hr,message:a,cause:e}),this[je]=!0,this.originalError=r}static isInstance(e){return f.bD.hasMarker(e,Gr)}};async function ds({toolCall:e,tools:r,repairToolCall:a,system:t,messages:s}){if(r==null)throw new fr({toolName:e.toolName});try{return await Wr({toolCall:e,tools:r})}catch(o){if(a==null||!(fr.isInstance(o)||Jr.isInstance(o)))throw o;let l=null;try{l=await a({toolCall:e,tools:r,parameterSchema:({toolName:p})=>w(r[p].parameters).jsonSchema,system:t,messages:s,error:o})}catch(p){throw new cs({cause:p,originalError:o})}if(l==null)throw o;return await Wr({toolCall:l,tools:r})}}async function Wr({toolCall:e,tools:r}){let a=e.toolName,t=r[a];if(t==null)throw new fr({toolName:e.toolName,availableTools:Object.keys(r)});let s=w(t.parameters),o=e.args.trim()===""?(0,ae.ZZ)({value:{},schema:s}):(0,ae.N8)({text:e.args,schema:s});if(o.success===!1)throw new Jr({toolName:a,toolArgs:e.args,cause:o.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:a,args:o.value}}function Xr(e){let r=e.filter(a=>a.type==="text").map(a=>a.text).join("");return r.length>0?r:void 0}function ms({text:e="",files:r,reasoning:a,tools:t,toolCalls:s,toolResults:o,messageId:l,generateMessageId:p}){let c=[],v=[];return a.length>0&&v.push(...a.map(d=>d.type==="text"?{...d,type:"reasoning"}:{...d,type:"redacted-reasoning"})),r.length>0&&v.push(...r.map(d=>({type:"file",data:d.base64,mimeType:d.mimeType}))),e.length>0&&v.push({type:"text",text:e}),s.length>0&&v.push(...s),v.length>0&&c.push({role:"assistant",content:v,id:l}),o.length>0&&c.push({role:"tool",id:p(),content:o.map(d=>{let m=t[d.toolName];return m?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:d.toolCallId,toolName:d.toolName,result:m.experimental_toToolResultContent(d.result),experimental_content:m.experimental_toToolResultContent(d.result)}:{type:"tool-result",toolCallId:d.toolCallId,toolName:d.toolName,result:d.result}})}),c}je=ps;var hs=(0,ae.hK)({prefix:"aitxt",size:24}),gs=(0,ae.hK)({prefix:"msg",size:24});async function fs({model:e,tools:r,toolChoice:a,system:t,prompt:s,messages:o,maxRetries:l,abortSignal:p,headers:c,maxSteps:v=1,experimental_generateMessageId:d=gs,experimental_output:m,experimental_continueSteps:K=!1,experimental_telemetry:Re,experimental_providerMetadata:ve,providerOptions:H=ve,experimental_activeTools:ue,experimental_prepareStep:Ze,experimental_repairToolCall:Ge,_internal:{generateId:xe=hs,currentDate:De=()=>new Date}={},onStepFinish:Ne,...G}){var Me;if(v<1)throw new R({parameter:"maxSteps",value:v,message:"maxSteps must be at least 1"});let{maxRetries:P,retry:pe}=le({maxRetries:l}),Fe=ut({model:e,telemetry:Re,headers:c,settings:{...G,maxRetries:P}}),se=hr({prompt:{system:(Me=m?.injectIntoSystemPrompt({system:t,model:e}))!=null?Me:t,prompt:s,messages:o},tools:r}),Ke=ft(Re);return kt({name:"ai.generateText",attributes:It({telemetry:Re,attributes:{...Qe({operationId:"ai.generateText",telemetry:Re}),...Fe,"ai.model.provider":e.provider,"ai.model.id":e.modelId,"ai.prompt":{input:()=>JSON.stringify({system:t,prompt:s,messages:o})},"ai.settings.maxSteps":v}}),tracer:Ke,fn:async ot=>{var qe,it,yt,zt,Pt,Yt,Kt,Ht,Gt,Vt,ar,Je,pt,et;let B,Wt=cr(G),ht=[],Et=[],Rt=[],$t=0,xt=[],Ye="",vt=[],Xt=[],at={completionTokens:0,promptTokens:0,totalTokens:0},At="initial";do{let Ct=$t===0?se.type:"messages",_r=[...se.messages,...xt],Qt=await Ze?.({model:e,steps:Xt,maxSteps:v,stepNumber:$t}),Js=(qe=Qt?.toolChoice)!=null?qe:a,zs=(it=Qt?.experimental_activeTools)!=null?it:ue,Dt=(yt=Qt?.model)!=null?yt:e,ua=await pr({prompt:{type:Ct,system:se.system,messages:_r},modelSupportsImageUrls:Dt.supportsImageUrls,modelSupportsUrl:(zt=Dt.supportsUrl)==null?void 0:zt.bind(Dt)}),or={type:"regular",...ns({tools:r,toolChoice:Js,activeTools:zs})};B=await pe(()=>kt({name:"ai.generateText.doGenerate",attributes:It({telemetry:Re,attributes:{...Qe({operationId:"ai.generateText.doGenerate",telemetry:Re}),...Fe,"ai.model.provider":Dt.provider,"ai.model.id":Dt.modelId,"ai.prompt.format":{input:()=>Ct},"ai.prompt.messages":{input:()=>Dr(ua)},"ai.prompt.tools":{input:()=>{var bt;return(bt=or.tools)==null?void 0:bt.map(Lt=>JSON.stringify(Lt))}},"ai.prompt.toolChoice":{input:()=>or.toolChoice!=null?JSON.stringify(or.toolChoice):void 0},"gen_ai.system":Dt.provider,"gen_ai.request.model":Dt.modelId,"gen_ai.request.frequency_penalty":G.frequencyPenalty,"gen_ai.request.max_tokens":G.maxTokens,"gen_ai.request.presence_penalty":G.presencePenalty,"gen_ai.request.stop_sequences":G.stopSequences,"gen_ai.request.temperature":G.temperature,"gen_ai.request.top_k":G.topK,"gen_ai.request.top_p":G.topP}}),tracer:Ke,fn:async bt=>{var Lt,ha,ga,fa,ya,va;let St=await Dt.doGenerate({mode:or,...Wt,inputFormat:Ct,responseFormat:m?.responseFormat({model:e}),prompt:ua,providerMetadata:H,abortSignal:p,headers:c}),tr={id:(ha=(Lt=St.response)==null?void 0:Lt.id)!=null?ha:xe(),timestamp:(fa=(ga=St.response)==null?void 0:ga.timestamp)!=null?fa:De(),modelId:(va=(ya=St.response)==null?void 0:ya.modelId)!=null?va:Dt.modelId};return bt.setAttributes(It({telemetry:Re,attributes:{"ai.response.finishReason":St.finishReason,"ai.response.text":{output:()=>St.text},"ai.response.toolCalls":{output:()=>JSON.stringify(St.toolCalls)},"ai.response.id":tr.id,"ai.response.model":tr.modelId,"ai.response.timestamp":tr.timestamp.toISOString(),"ai.usage.promptTokens":St.usage.promptTokens,"ai.usage.completionTokens":St.usage.completionTokens,"gen_ai.response.finish_reasons":[St.finishReason],"gen_ai.response.id":tr.id,"gen_ai.response.model":tr.modelId,"gen_ai.usage.input_tokens":St.usage.promptTokens,"gen_ai.usage.output_tokens":St.usage.completionTokens}})),{...St,response:tr}}})),ht=await Promise.all(((Pt=B.toolCalls)!=null?Pt:[]).map(bt=>ds({toolCall:bt,tools:r,repairToolCall:Ge,system:t,messages:_r}))),Et=r==null?[]:await ys({toolCalls:ht,tools:r,tracer:Ke,telemetry:Re,messages:_r,abortSignal:p});let pa=Zt(B.usage);at=Va(at,pa);let er="done";++$t<v&&(K&&B.finishReason==="length"&&ht.length===0?er="continue":ht.length>0&&Et.length===ht.length&&(er="tool-result"));let ca=(Yt=B.text)!=null?Yt:"",da=At==="continue"&&Ye.trimEnd()!==Ye?ca.trimStart():ca,sr=er==="continue"?function(bt){let Lt=is(bt);return Lt?Lt.prefix+Lt.whitespace:bt}(da):da;if(Ye=er==="continue"||At==="continue"?Ye+sr:sr,Rt=Qr(B.reasoning),vt.push(...(Kt=B.sources)!=null?Kt:[]),At==="continue"){let bt=xt[xt.length-1];typeof bt.content=="string"?bt.content+=sr:bt.content.push({text:sr,type:"text"})}else xt.push(...ms({text:Ye,files:yr(B.files),reasoning:Qr(B.reasoning),tools:r??{},toolCalls:ht,toolResults:Et,messageId:d(),generateMessageId:d}));let ma={stepType:At,text:sr,reasoning:Xr(Rt),reasoningDetails:Rt,files:yr(B.files),sources:(Ht=B.sources)!=null?Ht:[],toolCalls:ht,toolResults:Et,finishReason:B.finishReason,usage:pa,warnings:B.warnings,logprobs:B.logprobs,request:(Gt=B.request)!=null?Gt:{},response:{...B.response,headers:(Vt=B.rawResponse)==null?void 0:Vt.headers,body:(ar=B.rawResponse)==null?void 0:ar.body,messages:structuredClone(xt)},providerMetadata:B.providerMetadata,experimental_providerMetadata:B.providerMetadata,isContinued:er==="continue"};Xt.push(ma),await Ne?.(ma),At=er}while(At!=="done");return ot.setAttributes(It({telemetry:Re,attributes:{"ai.response.finishReason":B.finishReason,"ai.response.text":{output:()=>B.text},"ai.response.toolCalls":{output:()=>JSON.stringify(B.toolCalls)},"ai.usage.promptTokens":B.usage.promptTokens,"ai.usage.completionTokens":B.usage.completionTokens}})),new vs({text:Ye,files:yr(B.files),reasoning:Xr(Rt),reasoningDetails:Rt,sources:vt,outputResolver:()=>{if(m==null)throw new rs;return m.parseOutput({text:Ye},{response:B.response,usage:at,finishReason:B.finishReason})},toolCalls:ht,toolResults:Et,finishReason:B.finishReason,usage:at,warnings:B.warnings,request:(Je=B.request)!=null?Je:{},response:{...B.response,headers:(pt=B.rawResponse)==null?void 0:pt.headers,body:(et=B.rawResponse)==null?void 0:et.body,messages:xt},logprobs:B.logprobs,steps:Xt,providerMetadata:B.providerMetadata})}})}async function ys({toolCalls:e,tools:r,tracer:a,telemetry:t,messages:s,abortSignal:o}){return(await Promise.all(e.map(async({toolCallId:l,toolName:p,args:c})=>{let v=r[p];if(v?.execute==null)return;let d=await kt({name:"ai.toolCall",attributes:It({telemetry:t,attributes:{...Qe({operationId:"ai.toolCall",telemetry:t}),"ai.toolCall.name":p,"ai.toolCall.id":l,"ai.toolCall.args":{output:()=>JSON.stringify(c)}}}),tracer:a,fn:async m=>{try{let K=await v.execute(c,{toolCallId:l,messages:s,abortSignal:o});try{m.setAttributes(It({telemetry:t,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(K)}}}))}catch{}return K}catch(K){throw new ss({toolCallId:l,toolName:p,toolArgs:c,cause:K})}}});return{type:"tool-result",toolCallId:l,toolName:p,args:c,result:d}}))).filter(l=>l!=null)}var vs=class{constructor(e){this.text=e.text,this.files=e.files,this.reasoning=e.reasoning,this.reasoningDetails=e.reasoningDetails,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.request=e.request,this.response=e.response,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.providerMetadata=e.providerMetadata,this.logprobs=e.logprobs,this.outputResolver=e.outputResolver,this.sources=e.sources}get experimental_output(){return this.outputResolver()}};function Qr(e){return e==null?[]:typeof e=="string"?[{type:"text",text:e}]:e}function yr(e){var r;return(r=e?.map(a=>new kr(a)))!=null?r:[]}ie({},{object:()=>ks,text:()=>ws});var ea="AI_InvalidStreamPartError",ta=`vercel.ai.error.${ea}`,bs=Symbol.for(ta),Qs=class extends f.bD{constructor({chunk:e,message:r}){super({name:ea,message:r}),this[tt]=!0,this.chunk=e}static isInstance(e){return f.bD.hasMarker(e,ta)}};tt=bs;var ra="vercel.ai.error.AI_MCPClientError",_s=Symbol.for(ra),Jt=class extends f.bD{constructor({name:e="MCPClientError",message:r,cause:a}){super({name:e,message:r,cause:a}),this[J]=!0}static isInstance(e){return f.bD.hasMarker(e,ra)}};J=_s;var ws=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt:({system:e})=>e,parsePartial:({text:e})=>({partial:e}),parseOutput:({text:e})=>e}),ks=({schema:e})=>{let r=w(e);return{type:"object",responseFormat:({model:a})=>({type:"json",schema:a.supportsStructuredOutputs?r.jsonSchema:void 0}),injectIntoSystemPrompt:({system:a,model:t})=>t.supportsStructuredOutputs?a:gr({prompt:a,schema:r.jsonSchema}),parsePartial({text:a}){let t=z(a);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let s=t.state;throw Error(`Unsupported parse state: ${s}`)}}},parseOutput({text:a},t){let s=(0,ae.N8)({text:a});if(!s.success)throw new Ft({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:t.response,usage:t.usage,finishReason:t.finishReason});let o=(0,ae.ZZ)({value:s.value,schema:r});if(!o.success)throw new Ft({message:"No object generated: response did not match schema.",cause:o.error,text:a,response:t.response,usage:t.usage,finishReason:t.finishReason});return o.value}}};async function en({stream:e,onError:r}){let a=e.getReader();try{for(;;){let{done:t}=await a.read();if(t)break}}catch(t){r?.(t)}finally{a.releaseLock()}}function aa(e,r){let a,t,s=e.getReader(),o=r.getReader(),l=!1,p=!1;async function c(d){try{a==null&&(a=s.read());let m=await a;a=void 0,m.done?d.close():d.enqueue(m.value)}catch(m){d.error(m)}}async function v(d){try{t==null&&(t=o.read());let m=await t;t=void 0,m.done?d.close():d.enqueue(m.value)}catch(m){d.error(m)}}return new ReadableStream({async pull(d){try{if(l)return void await v(d);if(p)return void await c(d);a==null&&(a=s.read()),t==null&&(t=o.read());let{result:m,reader:K}=await Promise.race([a.then(Re=>({result:Re,reader:s})),t.then(Re=>({result:Re,reader:o}))]);m.done||d.enqueue(m.value),K===s?(a=void 0,m.done&&(await v(d),l=!0)):(t=void 0,m.done&&(p=!0,await c(d)))}catch(m){d.error(m)}},cancel(){s.cancel(),o.cancel()}})}(0,ae.hK)({prefix:"aitxt",size:24}),(0,ae.hK)({prefix:"msg",size:24}),f.bD,f.bD;var sa="AI_NoSuchProviderError",na=`vercel.ai.error.${sa}`,Is=Symbol.for(na),tn=class extends f.eM{constructor({modelId:e,modelType:r,providerId:a,availableProviders:t,message:s=`No such provider: ${a} (available providers: ${t.join()})`}){super({errorName:sa,modelId:e,modelType:r,message:s}),this[ct]=!0,this.providerId=a,this.availableProviders=t}static isInstance(e){return f.bD.hasMarker(e,na)}};ct=Is;var xs="2024-11-05",rn=[xs,"2024-10-07"],Ss=i.Ik({name:i.Yj(),version:i.Yj()}).passthrough(),Bt=i.Ik({_meta:i.lq(i.Ik({}).passthrough())}).passthrough(),Ts=i.Ik({method:i.Yj(),params:i.lq(Bt)}),js=i.Ik({experimental:i.lq(i.Ik({}).passthrough()),logging:i.lq(i.Ik({}).passthrough()),prompts:i.lq(i.Ik({listChanged:i.lq(i.zM())}).passthrough()),resources:i.lq(i.Ik({subscribe:i.lq(i.zM()),listChanged:i.lq(i.zM())}).passthrough()),tools:i.lq(i.Ik({listChanged:i.lq(i.zM())}).passthrough())}).passthrough(),an=Bt.extend({protocolVersion:i.Yj(),capabilities:js,serverInfo:Ss,instructions:i.lq(i.Yj())}),Es=Bt.extend({nextCursor:i.lq(i.Yj())}),Rs=i.Ik({name:i.Yj(),description:i.lq(i.Yj()),inputSchema:i.Ik({type:i.eu("object"),properties:i.lq(i.Ik({}).passthrough())}).passthrough()}).passthrough(),sn=Es.extend({tools:i.YO(Rs)}),Cs=i.Ik({type:i.eu("text"),text:i.Yj()}).passthrough(),As=i.Ik({type:i.eu("image"),data:i.Yj().base64(),mimeType:i.Yj()}).passthrough(),oa=i.Ik({uri:i.Yj(),mimeType:i.lq(i.Yj())}).passthrough(),Ns=oa.extend({text:i.Yj()}),Ms=oa.extend({blob:i.Yj().base64()}),Os=i.Ik({type:i.eu("resource"),resource:i.KC([Ns,Ms])}).passthrough(),nn=Bt.extend({content:i.YO(i.KC([Cs,As,Os])),isError:i.zM().default(!1).optional()}).or(Bt.extend({toolResult:i.L5()})),Ps=i.Ik({jsonrpc:i.eu("2.0"),id:i.KC([i.Yj(),i.ai().int()])}).merge(Ts).strict(),Ys=i.Ik({jsonrpc:i.eu("2.0"),id:i.KC([i.Yj(),i.ai().int()]),result:Bt}).strict(),$s=i.Ik({jsonrpc:i.eu("2.0"),id:i.KC([i.Yj(),i.ai().int()]),error:i.Ik({code:i.ai().int(),message:i.Yj(),data:i.lq(i.L5())})}).strict(),Ds=i.Ik({jsonrpc:i.eu("2.0")}).merge(i.Ik({method:i.Yj(),params:i.lq(Bt)})).strict(),qs=i.KC([Ps,Ds,Ys,$s]),on=class{constructor({url:e,headers:r}){this.connected=!1,this.url=new URL(e),this.headers=r}async start(){return new Promise((e,r)=>{if(this.connected)return e();this.abortController=new AbortController,(async()=>{var a,t,s;try{let o=new Headers(this.headers);o.set("Accept","text/event-stream");let l=await fetch(this.url.href,{headers:o,signal:(a=this.abortController)==null?void 0:a.signal});if(!l.ok||!l.body){let v=new Jt({message:`MCP SSE Transport Error: ${l.status} ${l.statusText}`});return(t=this.onerror)==null||t.call(this,v),r(v)}let p=l.body.pipeThrough(new TextDecoderStream).pipeThrough(createEventSourceParserStream()).getReader(),c=async()=>{var v,d,m;try{for(;;){let{done:K,value:Re}=await p.read();if(K){if(this.connected)throw this.connected=!1,new Jt({message:"MCP SSE Transport Error: Connection closed unexpectedly"});return}let{event:ve,data:H}=Re;if(ve==="endpoint"){if(this.endpoint=new URL(H,this.url),this.endpoint.origin!==this.url.origin)throw new Jt({message:`MCP SSE Transport Error: Endpoint origin does not match connection origin: ${this.endpoint.origin}`});this.connected=!0,e()}else if(ve==="message")try{let ue=qs.parse(JSON.parse(H));(v=this.onmessage)==null||v.call(this,ue)}catch(ue){let Ze=new Jt({message:"MCP SSE Transport Error: Failed to parse message",cause:ue});(d=this.onerror)==null||d.call(this,Ze)}}}catch(K){if(K instanceof Error&&K.name==="AbortError")return;(m=this.onerror)==null||m.call(this,K),r(K)}};this.sseConnection={close:()=>p.cancel()},c()}catch(o){if(o instanceof Error&&o.name==="AbortError")return;(s=this.onerror)==null||s.call(this,o),r(o)}})()})}async close(){var e,r,a;this.connected=!1,(e=this.sseConnection)==null||e.close(),(r=this.abortController)==null||r.abort(),(a=this.onclose)==null||a.call(this)}async send(e){var r,a,t;if(!this.endpoint||!this.connected)throw new Jt({message:"MCP SSE Transport Error: Not connected"});try{let s=new Headers(this.headers);s.set("Content-Type","application/json");let o={method:"POST",headers:s,body:JSON.stringify(e),signal:(r=this.abortController)==null?void 0:r.signal},l=await fetch(this.endpoint,o);if(!l.ok){let p=await l.text().catch(()=>null),c=new Jt({message:`MCP SSE Transport Error: POSTing to endpoint (HTTP ${l.status}): ${p}`});(a=this.onerror)==null||a.call(this,c);return}}catch(s){(t=this.onerror)==null||t.call(this,s);return}}};function ia(e={}){let r=new TextEncoder,a="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(t,s){s.enqueue(r.encode(t)),a+=t,e.onToken&&await e.onToken(t),e.onText&&typeof t=="string"&&await e.onText(t)},async flush(){e.onCompletion&&await e.onCompletion(a),e.onFinal&&await e.onFinal(a)}})}function vr(e,r){return e.pipeThrough(new TransformStream({transform:async(a,t)=>{var s;if(typeof a=="string")return void t.enqueue(a);if("event"in a){a.event==="on_chat_model_stream"&&la((s=a.data)==null?void 0:s.chunk,t);return}la(a,t)}})).pipeThrough(ia(r)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(a,t)=>{t.enqueue(T("text",a))}}))}function Us(e,r){return vr(e,r).pipeThrough(new TextEncoderStream)}function Fs(e,r){var a;let t=vr(e,r?.callbacks).pipeThrough(new TextEncoderStream),s=r?.data,o=r?.init;return new Response(s?aa(s.stream,t):t,{status:(a=o?.status)!=null?a:200,statusText:o?.statusText,headers:we(o?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Ls(e,r){r.dataStream.merge(vr(e,r.callbacks))}function la(e,r){if(typeof e.content=="string")r.enqueue(e.content);else for(let a of e.content)a.type==="text"&&r.enqueue(a.text)}function br(e,r){let a,t=(a=!0,s=>(a&&(s=s.trimStart())&&(a=!1),s));return(0,ae.NR)(e[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(s,o){o.enqueue(t(s.delta))}})).pipeThrough(ia(r)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(s,o)=>{o.enqueue(T("text",s))}}))}function Zs(e,r){return br(e,r).pipeThrough(new TextEncoderStream)}function Bs(e,r={}){var a;let{init:t,data:s,callbacks:o}=r,l=br(e,o).pipeThrough(new TextEncoderStream);return new Response(s?aa(s.stream,l):l,{status:(a=t?.status)!=null?a:200,statusText:t?.statusText,headers:we(t?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Vs(e,r){r.dataStream.merge(br(e,r.callbacks))}ie({},{mergeIntoDataStream:()=>Ls,toDataStream:()=>Us,toDataStreamResponse:()=>Fs}),ie({},{mergeIntoDataStream:()=>Vs,toDataStream:()=>Zs,toDataStreamResponse:()=>Bs})},Tt.__chunk_40211=(lt,He,me)=>{me.d(He,{A:()=>h});let h=(0,me(50283).A)("settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},Tt.__chunk_36528=(lt,He,me)=>{me.d(He,{m2:()=>Oe,NR:()=>ee,Z9:()=>fe,n_:()=>Ot,HD:()=>_t,Ds:()=>dt,hK:()=>x,sl:()=>i,cV:()=>mt,cb:()=>M,$C:()=>q,u1:()=>he,zf:()=>ce,v0:()=>J,WL:()=>Ce,xI:()=>ct,S:()=>st,GU:()=>ae,N8:()=>tt,ZZ:()=>je,eu:()=>ge,ae:()=>qt});var h=me(96848);let W=(_,j=21)=>(k=j)=>{let E="",te=0|k;for(;te--;)E+=_[Math.random()*_.length|0];return E};var n=me(5233);function Oe(..._){return _.reduce((j,k)=>({...j,...k??{}}),{})}function ee(_){return new ReadableStream({async pull(j){try{let{value:k,done:E}=await _.next();E?j.close():j.enqueue(k)}catch(k){j.error(k)}},cancel(){}})}async function M(_){return _==null?Promise.resolve():new Promise(j=>setTimeout(j,_))}function C(_){let j={};return _.headers.forEach((k,E)=>{j[E]=k}),j}var x=({prefix:_,size:j=16,alphabet:k="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:E="-"}={})=>{let te=W(k,j);if(_==null)return te;if(k.includes(E))throw new h.Di({argument:"separator",message:`The separator "${E}" must not be part of the alphabet "${k}".`});return Ee=>`${_}${E}${te(Ee)}`},q=x();function he(_){return _==null?"unknown error":typeof _=="string"?_:_ instanceof Error?_.message:JSON.stringify(_)}function ce(_){return _ instanceof Error&&(_.name==="AbortError"||_.name==="TimeoutError")}function Ce({apiKey:_,environmentVariableName:j,apiKeyParameterName:k="apiKey",description:E}){if(typeof _=="string")return _;if(_!=null)throw new h.Kq({message:`${E} API key must be a string.`});if(typeof process>"u")throw new h.Kq({message:`${E} API key is missing. Pass it using the '${k}' parameter. Environment variables is not supported in this environment.`});if((_=process.env[j])==null)throw new h.Kq({message:`${E} API key is missing. Pass it using the '${k}' parameter or the ${j} environment variable.`});if(typeof _!="string")throw new h.Kq({message:`${E} API key must be a string. The value of the ${j} environment variable is not a string.`});return _}var ge=Symbol.for("vercel.ai.validator");function je({value:_,schema:j}){var k;let E=typeof j=="object"&&j!==null&&ge in j&&j[ge]===!0&&"validate"in j?j:(k=j,{[ge]:!0,validate:te=>{let Ee=k.safeParse(te);return Ee.success?{success:!0,value:Ee.data}:{success:!1,error:Ee.error}}});try{if(E.validate==null)return{success:!0,value:_};let te=E.validate(_);return te.success?te:{success:!1,error:h.iM.wrap({value:_,cause:te.error})}}catch(te){return{success:!1,error:h.iM.wrap({value:_,cause:te})}}}function tt({text:_,schema:j}){try{let k=n.parse(_);if(j==null)return{success:!0,value:k,rawValue:k};let E=je({value:k,schema:j});return E.success?{...E,rawValue:k}:E}catch(k){return{success:!1,error:h.u6.isInstance(k)?k:new h.u6({text:_,cause:k})}}}function J(_){try{return n.parse(_),!0}catch{return!1}}function ct({provider:_,providerOptions:j,schema:k}){if(j?.[_]==null)return;let E=je({value:j[_],schema:k});if(!E.success)throw new h.Di({argument:"providerOptions",message:`invalid ${_} provider options`,cause:E.error});return E.value}var f=()=>ir.fetch,ae=async({url:_,headers:j,body:k,failedResponseHandler:E,successfulResponseHandler:te,abortSignal:Ee,fetch:be})=>Se({url:_,headers:{"Content-Type":"application/json",...j},body:{content:JSON.stringify(k),values:k},failedResponseHandler:E,successfulResponseHandler:te,abortSignal:Ee,fetch:be}),st=async({url:_,headers:j,formData:k,failedResponseHandler:E,successfulResponseHandler:te,abortSignal:Ee,fetch:be})=>Se({url:_,headers:j,body:{content:k,values:Object.fromEntries(k.entries())},failedResponseHandler:E,successfulResponseHandler:te,abortSignal:Ee,fetch:be}),Se=async({url:_,headers:j={},body:k,successfulResponseHandler:E,failedResponseHandler:te,abortSignal:Ee,fetch:be=f()})=>{try{var ye;let Ae=await be(_,{method:"POST",headers:(ye=j,Object.fromEntries(Object.entries(ye).filter(([Ue,ne])=>ne!=null))),body:k.content,signal:Ee}),We=C(Ae);if(!Ae.ok){let Ue;try{Ue=await te({response:Ae,url:_,requestBodyValues:k.values})}catch(ne){throw ce(ne)||h.hL.isInstance(ne)?ne:new h.hL({message:"Failed to process error response",cause:ne,statusCode:Ae.status,url:_,responseHeaders:We,requestBodyValues:k.values})}throw Ue.value}try{return await E({response:Ae,url:_,requestBodyValues:k.values})}catch(Ue){throw Ue instanceof Error&&(ce(Ue)||h.hL.isInstance(Ue))?Ue:new h.hL({message:"Failed to process successful response",cause:Ue,statusCode:Ae.status,url:_,responseHeaders:We,requestBodyValues:k.values})}}catch(Ae){if(ce(Ae))throw Ae;if(Ae instanceof TypeError&&Ae.message==="fetch failed"){let We=Ae.cause;if(We!=null)throw new h.hL({message:`Cannot connect to API: ${We.message}`,cause:We,url:_,requestBodyValues:k.values,isRetryable:!0})}throw Ae}},i=({errorSchema:_,errorToMessage:j,isRetryable:k})=>async({response:E,url:te,requestBodyValues:Ee})=>{let be=await E.text(),ye=C(E);if(be.trim()==="")return{responseHeaders:ye,value:new h.hL({message:E.statusText,url:te,requestBodyValues:Ee,statusCode:E.status,responseHeaders:ye,responseBody:be,isRetryable:k?.(E)})};try{let Ae=function({text:We,schema:Ue}){try{let ne=n.parse(We);return Ue==null?ne:function({value:rt,schema:nt}){let gt=je({value:rt,schema:nt});if(!gt.success)throw h.iM.wrap({value:rt,cause:gt.error});return gt.value}({value:ne,schema:Ue})}catch(ne){throw h.u6.isInstance(ne)||h.iM.isInstance(ne)?ne:new h.u6({text:We,cause:ne})}}({text:be,schema:_});return{responseHeaders:ye,value:new h.hL({message:j(Ae),url:te,requestBodyValues:Ee,statusCode:E.status,responseHeaders:ye,responseBody:be,data:Ae,isRetryable:k?.(E,Ae)})}}catch{return{responseHeaders:ye,value:new h.hL({message:E.statusText,url:te,requestBodyValues:Ee,statusCode:E.status,responseHeaders:ye,responseBody:be,isRetryable:k?.(E)})}}},dt=_=>async({response:j})=>{let k=C(j);if(j.body==null)throw new h.Tt({});return{responseHeaders:k,value:j.body.pipeThrough(new TextDecoderStream).pipeThrough(function(){let E,te,Ee,be="",ye=[];function Ae(ne,rt){if(ne==="")return void We(rt);if(ne.startsWith(":"))return;let nt=ne.indexOf(":");if(nt===-1)return void Ue(ne,"");let gt=ne.slice(0,nt),V=nt+1;Ue(gt,V<ne.length&&ne[V]===" "?ne.slice(V+1):ne.slice(V))}function We(ne){ye.length>0&&(ne.enqueue({event:E,data:ye.join(`
`),id:te,retry:Ee}),ye=[],E=void 0,Ee=void 0)}function Ue(ne,rt){switch(ne){case"event":E=rt;break;case"data":ye.push(rt);break;case"id":te=rt;break;case"retry":let nt=parseInt(rt,10);isNaN(nt)||(Ee=nt)}}return new TransformStream({transform(ne,rt){let{lines:nt,incompleteLine:gt}=function(V,Ut){let u=[],b=V;for(let S=0;S<Ut.length;){let F=Ut[S++];F===`
`?(u.push(b),b=""):F==="\r"?(u.push(b),b="",Ut[S]===`
`&&S++):b+=F}return{lines:u,incompleteLine:b}}(be,ne);be=gt;for(let V=0;V<nt.length;V++)Ae(nt[V],rt)},flush(ne){Ae(be,ne),We(ne)}})}()).pipeThrough(new TransformStream({transform({data:E},te){E!=="[DONE]"&&te.enqueue(tt({text:E,schema:_}))}}))}},mt=_=>async({response:j,url:k,requestBodyValues:E})=>{let te=await j.text(),Ee=tt({text:te,schema:_}),be=C(j);if(!Ee.success)throw new h.hL({message:"Invalid JSON response",cause:Ee.error,statusCode:j.status,responseHeaders:be,responseBody:te,url:k,requestBodyValues:E});return{responseHeaders:be,value:Ee.value,rawValue:Ee.rawValue}},_t=()=>async({response:_,url:j,requestBodyValues:k})=>{let E=C(_);if(!_.body)throw new h.hL({message:"Response body is empty",url:j,requestBodyValues:k,statusCode:_.status,responseHeaders:E,responseBody:void 0});try{let te=await _.arrayBuffer();return{responseHeaders:E,value:new Uint8Array(te)}}catch(te){throw new h.hL({message:"Failed to read response as array buffer",url:j,requestBodyValues:k,statusCode:_.status,responseHeaders:E,responseBody:void 0,cause:te})}},{btoa:Nt,atob:Mt}=ir;function fe(_){let j=Mt(_.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(j,k=>k.codePointAt(0))}function Ot(_){let j="";for(let k=0;k<_.length;k++)j+=String.fromCodePoint(_[k]);return Nt(j)}function qt(_){return _?.replace(/\/$/,"")}},Tt.__chunk_31054=(lt,He,me)=>{me.d(He,{v:()=>M});var h=me(38286);let W=C=>{let x,q=new Set,he=(je,tt)=>{let J=typeof je=="function"?je(x):je;if(!Object.is(J,x)){let ct=x;x=tt??(typeof J!="object"||J===null)?J:Object.assign({},x,J),q.forEach(f=>f(x,ct))}},ce=()=>x,Ce={setState:he,getState:ce,getInitialState:()=>ge,subscribe:je=>(q.add(je),()=>q.delete(je))},ge=x=C(he,ce,Ce);return Ce},n=C=>C?W(C):W,Oe=C=>C,ee=C=>{let x=n(C),q=he=>function(ce,Ce=Oe){let ge=h.useSyncExternalStore(ce.subscribe,()=>Ce(ce.getState()),()=>Ce(ce.getInitialState()));return h.useDebugValue(ge),ge}(x,he);return Object.assign(q,x),q},M=C=>C?ee(C):ee},Tt.__chunk_11914=(lt,He,me)=>{me.d(He,{Zr:()=>W});let h=n=>Oe=>{try{let ee=n(Oe);return ee instanceof Promise?ee:{then:M=>h(M)(ee),catch(M){return this}}}catch(ee){return{then(M){return this},catch:M=>h(M)(ee)}}},W=(n,Oe)=>(ee,M,C)=>{let x,q={storage:function(f,ae){let st;try{st=f()}catch{return}return{getItem:Se=>{var i;let dt=_t=>_t===null?null:JSON.parse(_t,void 0),mt=(i=st.getItem(Se))!=null?i:null;return mt instanceof Promise?mt.then(dt):dt(mt)},setItem:(Se,i)=>st.setItem(Se,JSON.stringify(i,void 0)),removeItem:Se=>st.removeItem(Se)}}(()=>localStorage),partialize:f=>f,version:0,merge:(f,ae)=>({...ae,...f}),...Oe},he=!1,ce=new Set,Ce=new Set,ge=q.storage;if(!ge)return n((...f)=>{console.warn(`[zustand persist middleware] Unable to update item '${q.name}', the given storage is currently unavailable.`),ee(...f)},M,C);let je=()=>{let f=q.partialize({...M()});return ge.setItem(q.name,{state:f,version:q.version})},tt=C.setState;C.setState=(f,ae)=>{tt(f,ae),je()};let J=n((...f)=>{ee(...f),je()},M,C);C.getInitialState=()=>J;let ct=()=>{var f,ae;if(!ge)return;he=!1,ce.forEach(Se=>{var i;return Se((i=M())!=null?i:J)});let st=((ae=q.onRehydrateStorage)==null?void 0:ae.call(q,(f=M())!=null?f:J))||void 0;return h(ge.getItem.bind(ge))(q.name).then(Se=>{if(Se){if(typeof Se.version!="number"||Se.version===q.version)return[!1,Se.state];if(q.migrate){let i=q.migrate(Se.state,Se.version);return i instanceof Promise?i.then(dt=>[!0,dt]):[!0,i]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(Se=>{var i;let[dt,mt]=Se;if(ee(x=q.merge(mt,(i=M())!=null?i:J),!0),dt)return je()}).then(()=>{st?.(x,void 0),x=M(),he=!0,Ce.forEach(Se=>Se(x))}).catch(Se=>{st?.(void 0,Se)})};return C.persist={setOptions:f=>{q={...q,...f},f.storage&&(ge=f.storage)},clearStorage:()=>{ge?.removeItem(q.name)},getOptions:()=>q,rehydrate:()=>ct(),hasHydrated:()=>he,onHydrate:f=>(ce.add(f),()=>{ce.delete(f)}),onFinishHydration:f=>(Ce.add(f),()=>{Ce.delete(f)})},q.skipHydration||ct(),x||J}},Tt.__chunk_5233=(lt,He,me)=>{var h=me(25356).Buffer;let W=h!==void 0,n=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,Oe=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function ee(x,q,he){he==null&&q!==null&&typeof q=="object"&&(he=q,q=void 0),W&&h.isBuffer(x)&&(x=x.toString()),x&&x.charCodeAt(0)===65279&&(x=x.slice(1));let ce=JSON.parse(x,q);if(ce===null||typeof ce!="object")return ce;let Ce=he&&he.protoAction||"error",ge=he&&he.constructorAction||"error";if(Ce==="ignore"&&ge==="ignore")return ce;if(Ce!=="ignore"&&ge!=="ignore"){if(n.test(x)===!1&&Oe.test(x)===!1)return ce}else if(Ce!=="ignore"&&ge==="ignore"){if(n.test(x)===!1)return ce}else if(Oe.test(x)===!1)return ce;return M(ce,{protoAction:Ce,constructorAction:ge,safe:he&&he.safe})}function M(x,{protoAction:q="error",constructorAction:he="error",safe:ce}={}){let Ce=[x];for(;Ce.length;){let ge=Ce;for(let je of(Ce=[],ge)){if(q!=="ignore"&&Object.prototype.hasOwnProperty.call(je,"__proto__")){if(ce===!0)return null;if(q==="error")throw SyntaxError("Object contains forbidden prototype property");delete je.__proto__}if(he!=="ignore"&&Object.prototype.hasOwnProperty.call(je,"constructor")&&Object.prototype.hasOwnProperty.call(je.constructor,"prototype")){if(ce===!0)return null;if(he==="error")throw SyntaxError("Object contains forbidden prototype property");delete je.constructor}for(let tt in je){let J=je[tt];J&&typeof J=="object"&&Ce.push(J)}}}return x}function C(x,q,he){let ce=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return ee(x,q,he)}finally{Error.stackTraceLimit=ce}}lt.exports=C,lt.exports.default=C,lt.exports.parse=C,lt.exports.safeParse=function(x,q){let he=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return ee(x,q,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=he}},lt.exports.scan=M},Tt);export{ln as __getNamedExports};
