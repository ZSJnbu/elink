var hs=Object.defineProperty;var gi=Object.getOwnPropertyDescriptor;var _i=Object.getOwnPropertyNames;var yi=Object.prototype.hasOwnProperty;var ki=(q,te)=>()=>(q&&(te=q(q=0)),te);var Ta=(q,te,kt,pe)=>{if(te&&typeof te=="object"||typeof te=="function")for(let he of _i(te))!yi.call(q,he)&&he!==kt&&hs(q,he,{get:()=>te[he],enumerable:!(pe=gi(te,he))||pe.enumerable});return q},Ra=(q,te,kt)=>(Ta(q,te,"default"),kt&&Ta(kt,te,"default"));var vi=q=>Ta(hs({},"__esModule",{value:!0}),q);var Mt={};import*as Xc from"async_hooks";var fs=ki(()=>{Ra(Mt,Xc)});import{__getNamedExports as bi}from"../../../__next-on-pages-dist__/webpack/57f6ec9f336ee144fc2a910d7e789db9.js";import{__getNamedExports as wi}from"../../../__next-on-pages-dist__/webpack/1943f96f4397e7bec3e4fc9ba78f91bb.js";import{__getNamedExports as xi}from"../../../__next-on-pages-dist__/webpack/8f9e6f0a1a00e8641cf43737fdd3b90f.js";import{__getNamedExports as Ii}from"../../../__next-on-pages-dist__/webpack/a9df7b89c14586a12d9cd443a67a887b.js";import{__getNamedExports as ji}from"../../../__next-on-pages-dist__/webpack/37076.js";import{__getNamedExports as Ei}from"../../../__next-on-pages-dist__/webpack/2421.js";import{__getNamedExports as Si}from"../../../__next-on-pages-dist__/webpack/42f8a2dfa11b2ad38ad7da97014b7572.js";import{__getNamedExports as Ti}from"../../../__next-on-pages-dist__/webpack/65662.js";import{__getNamedExports as Ri}from"../../../__next-on-pages-dist__/webpack/163df07d5d9e35c188c7b3e532e50a17.js";import{__getNamedExports as Ni}from"../../../__next-on-pages-dist__/webpack/967fa6d9167e3205c72716cb7b867489.js";import{__getNamedExports as Ai}from"../../../__next-on-pages-dist__/webpack/18535.js";import{__getNamedExports as Oi}from"../../../__next-on-pages-dist__/webpack/fddf0d035ce44f454d6b317f6ea537d6.js";import{__getNamedExports as Ci}from"../../../__next-on-pages-dist__/webpack/89874.js";import{__getNamedExports as Mi}from"../../../__next-on-pages-dist__/webpack/0266278cecdcbde25365e7a9bbc6faae.js";import{__getNamedExports as Pi}from"../../../__next-on-pages-dist__/webpack/aa3f5f44ed7f7fee2d48af95132f2002.js";import{__getNamedExports as Yi}from"../../../__next-on-pages-dist__/webpack/4a8d454f73d78d269fb6c01d3896dc58.js";import{__getNamedExports as $i}from"../../../__next-on-pages-dist__/manifest/88a389dd6c068190adb2efc795e4063c.js";var C=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/external-links"),gs=bi(C,C,C),Di=gs.__chunk_96487,Ui=gs.__chunk_78335,yt=wi(C,C,C),qi=yt.__chunk_65521,Fi=yt.__chunk_25356,Li=yt.__chunk_65912,Zi=yt.__chunk_37612,zi=yt.__chunk_32223,Bi=yt.__chunk_32058,Aa=xi(C,C,C),Vi=Aa.__chunk_78446,Ki=Aa.__chunk_32042,Hi=Aa.__chunk_7218,Ge=Ii(C,C,C),Ji=Ge.__chunk_51817,Wi=Ge.__chunk_70974,Gi=Ge.__chunk_65667,Xi=Ge.__chunk_56474,Qi=Ge.__chunk_42409,el=Ge.__chunk_39491,tl=Ge.__chunk_35237,al=Ge.__chunk_32945,nl=ji(C,C,C),sl=nl.__chunk_37076,rl=Ei(C,C,C),ol=rl.__chunk_2421,Oa=Si(C,C,C),il=Oa.__chunk_89538,ll=Oa.__chunk_93432,ul=Oa.__chunk_23498,cl=Ti(C,C,C),pl=cl.__chunk_65662,ut=Ri(C,C,C),dl=ut.__chunk_52748,ml=ut.__chunk_2793,hl=ut.__chunk_85885,fl=ut.__chunk_76766,gl=ut.__chunk_38910,_l=ut.__chunk_21353,yl=ut.__chunk_11562,Ca=Ni(C,C,C),kl=Ca.__chunk_31239,vl=Ca.__chunk_2758,bl=Ca.__chunk_97799,wl=Ai(C,C,C),xl=wl.__chunk_18535,Re=Oi(C,C,C),Il=Re.__chunk_97472,jl=Re.__chunk_87903,El=Re.__chunk_86116,Sl=Re.__chunk_75565,Tl=Re.__chunk_59908,Rl=Re.__chunk_58829,Nl=Re.__chunk_58429,Al=Re.__chunk_56567,Ol=Re.__chunk_38062,Cl=Re.__chunk_25481,Ml=Re.__chunk_25325,Pl=Re.__chunk_23768,Yl=Re.__chunk_21438,$l=Re.__chunk_6640,Dl=Re.__chunk_2709,Ul=Ci(C,C,C),ql=Ul.__chunk_89874,_s=Mi(C,C,C),Fl=_s.__chunk_24949,Ll=_s.__chunk_9656,Ma=Pi(C,C,C),Zl=Ma.__chunk_27223,zl=Ma.__chunk_22710,Bl=Ma.__chunk_6133,b=Yi(C,C,C),Vl=b.__chunk_99143,Kl=b.__chunk_97530,Hl=b.__chunk_97426,Jl=b.__chunk_97205,Wl=b.__chunk_96610,Gl=b.__chunk_96534,Xl=b.__chunk_94337,Ql=b.__chunk_94186,eu=b.__chunk_93936,tu=b.__chunk_92438,au=b.__chunk_92295,nu=b.__chunk_90897,su=b.__chunk_89079,ru=b.__chunk_88006,ou=b.__chunk_85168,iu=b.__chunk_84102,lu=b.__chunk_83689,uu=b.__chunk_83543,cu=b.__chunk_82490,pu=b.__chunk_81818,du=b.__chunk_81238,mu=b.__chunk_80002,hu=b.__chunk_77935,fu=b.__chunk_77621,gu=b.__chunk_77404,_u=b.__chunk_76243,yu=b.__chunk_76237,ku=b.__chunk_73144,vu=b.__chunk_71290,bu=b.__chunk_71092,wu=b.__chunk_70424,xu=b.__chunk_69103,Iu=b.__chunk_69079,ju=b.__chunk_67855,Eu=b.__chunk_67411,Su=b.__chunk_66464,Tu=b.__chunk_64356,Ru=b.__chunk_64144,Nu=b.__chunk_61480,Au=b.__chunk_60424,Ou=b.__chunk_57779,Cu=b.__chunk_55421,Mu=b.__chunk_54195,Pu=b.__chunk_54181,Yu=b.__chunk_51251,$u=b.__chunk_47827,Du=b.__chunk_46711,Uu=b.__chunk_45375,qu=b.__chunk_44430,Fu=b.__chunk_41411,Lu=b.__chunk_40007,Zu=b.__chunk_39890,zu=b.__chunk_39055,Bu=b.__chunk_38730,Vu=b.__chunk_37753,Ku=b.__chunk_35297,Hu=b.__chunk_34319,Ju=b.__chunk_32410,Wu=b.__chunk_29691,Gu=b.__chunk_29160,Xu=b.__chunk_28123,Qu=b.__chunk_27075,ec=b.__chunk_26804,tc=b.__chunk_25951,ac=b.__chunk_24842,nc=b.__chunk_21408,sc=b.__chunk_20534,rc=b.__chunk_20050,oc=b.__chunk_18622,ic=b.__chunk_16170,lc=b.__chunk_16129,uc=b.__chunk_14459,cc=b.__chunk_12737,pc=b.__chunk_10501,dc=b.__chunk_10252,mc=b.__chunk_6225,hc=b.__chunk_5932,fc=b.__chunk_5835,gc=b.__chunk_5455,_c=b.__chunk_4819,yc=b.__chunk_4515,kc=b.__chunk_4318,vc=b.__chunk_3337,bc=b.__chunk_2504,wc=b.__chunk_899,xc=b.__chunk_770,Pa=$i(C,C,C),Ic=Pa.__NEXT_FONT_MANIFEST,jc=Pa.__REACT_LOADABLE_MANIFEST,Ec=Pa.__RSC_SERVER_MANIFEST,gp=((q,te,kt)=>(te._ENTRIES={},q.__RSC_SERVER_MANIFEST=Ec,te.__RSC_MANIFEST=te.__RSC_MANIFEST||{},te.__RSC_MANIFEST["/api/external-links/route"]={moduleLoading:{prefix:"/_next/"},ssrModuleMapping:{},edgeSSRModuleMapping:{412:{"*":{id:"56097",name:"*",chunks:[],async:!1}},413:{"*":{id:"423",name:"*",chunks:[],async:!1}},594:{"*":{id:"53884",name:"*",chunks:[],async:!1}},733:{"*":{id:"38746",name:"*",chunks:[],async:!1}},886:{"*":{id:"87252",name:"*",chunks:[],async:!1}},894:{"*":{id:"75942",name:"*",chunks:[],async:!1}},1295:{"*":{id:"76105",name:"*",chunks:[],async:!1}},2337:{"*":{id:"40229",name:"*",chunks:[],async:!1}},2363:{"*":{id:"31641",name:"*",chunks:[],async:!1}},2558:{"*":{id:"70544",name:"*",chunks:[],async:!1}},2678:{"*":{id:"94626",name:"*",chunks:[],async:!1}},3531:{"*":{id:"45819",name:"*",chunks:[],async:!1}},4165:{"*":{id:"78519",name:"*",chunks:[],async:!1}},4911:{"*":{id:"65319",name:"*",chunks:[],async:!1}},4970:{"*":{id:"63992",name:"*",chunks:[],async:!1}},5227:{"*":{id:"81749",name:"*",chunks:[],async:!1}},5529:{"*":{id:"94425",name:"*",chunks:[],async:!1}},5884:{"*":{id:"98327",name:"*",chunks:[],async:!1}},6158:{"*":{id:"8596",name:"*",chunks:[],async:!1}},6411:{"*":{id:"55390",name:"*",chunks:[],async:!1}},6614:{"*":{id:"55516",name:"*",chunks:[],async:!1}},6688:{"*":{id:"776",name:"*",chunks:[],async:!1}},6874:{"*":{id:"71571",name:"*",chunks:[],async:!1}},6975:{"*":{id:"14823",name:"*",chunks:[],async:!1}},7118:{"*":{id:"10757",name:"*",chunks:[],async:!1}},7313:{"*":{id:"84175",name:"*",chunks:[],async:!1}},7329:{"*":{id:"69721",name:"*",chunks:[],async:!1}},7555:{"*":{id:"68019",name:"*",chunks:[],async:!1}},7568:{"*":{id:"40470",name:"*",chunks:[],async:!1}},7931:{"*":{id:"89113",name:"*",chunks:[],async:!1}},8155:{"*":{id:"7299",name:"*",chunks:[],async:!1}},8586:{"*":{id:"62976",name:"*",chunks:[],async:!1}},8640:{"*":{id:"5462",name:"*",chunks:[],async:!1}},9665:{"*":{id:"47927",name:"*",chunks:[],async:!1}}},clientModules:{"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/client/components/app-router.js":{id:6158,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/client/components/app-router.js":{id:6158,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/client/components/client-page.js":{id:894,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/client/components/client-page.js":{id:894,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/client/components/client-segment.js":{id:4970,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/client/components/client-segment.js":{id:4970,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/client/components/error-boundary.js":{id:6614,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/client/components/error-boundary.js":{id:6614,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/client/components/http-access-fallback/error-boundary.js":{id:6975,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/client/components/http-access-fallback/error-boundary.js":{id:6975,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/client/components/layout-router.js":{id:7555,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/client/components/layout-router.js":{id:7555,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/client/components/metadata/async-metadata.js":{id:4911,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/client/components/metadata/async-metadata.js":{id:4911,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/client/components/metadata/metadata-boundary.js":{id:9665,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/client/components/metadata/metadata-boundary.js":{id:9665,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/client/components/render-from-template-context.js":{id:1295,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/client/components/render-from-template-context.js":{id:1295,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/client/components/router-reducer/fetch-server-response.js":{id:8586,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/client/components/router-reducer/fetch-server-response.js":{id:8586,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/shared/lib/app-router-context.shared-runtime.js":{id:5227,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/shared/lib/app-router-context.shared-runtime.js":{id:5227,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/shared/lib/hooks-client-context.shared-runtime.js":{id:886,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/shared/lib/hooks-client-context.shared-runtime.js":{id:886,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/shared/lib/server-inserted-html.shared-runtime.js":{id:7568,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/shared/lib/server-inserted-html.shared-runtime.js":{id:7568,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/shared/lib/server-inserted-metadata.shared-runtime.js":{id:8640,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/shared/lib/server-inserted-metadata.shared-runtime.js":{id:8640,name:"*",chunks:[],async:!1},'/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/font/google/target.css?{"path":"src/app/layout.tsx","import":"Inter","arguments":[{"subsets":["latin"]}],"variableName":"inter"}':{id:8346,name:"*",chunks:["18","static/chunks/18-38072a8067fea0f2.js","328","static/chunks/328-00159b5e32cc8d68.js","588","static/chunks/588-724c70dc56b71275.js","663","static/chunks/663-4915b4e4bd6ece43.js","70","static/chunks/70-e2e4ebd5ffa7fffa.js","177","static/chunks/app/layout-6d7c9af4e43ae306.js"],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/provider.tsx":{id:6411,name:"*",chunks:["18","static/chunks/18-38072a8067fea0f2.js","328","static/chunks/328-00159b5e32cc8d68.js","588","static/chunks/588-724c70dc56b71275.js","663","static/chunks/663-4915b4e4bd6ece43.js","70","static/chunks/70-e2e4ebd5ffa7fffa.js","177","static/chunks/app/layout-6d7c9af4e43ae306.js"],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/ui/toaster.tsx":{id:2558,name:"*",chunks:["18","static/chunks/18-38072a8067fea0f2.js","328","static/chunks/328-00159b5e32cc8d68.js","588","static/chunks/588-724c70dc56b71275.js","663","static/chunks/663-4915b4e4bd6ece43.js","70","static/chunks/70-e2e4ebd5ffa7fffa.js","177","static/chunks/app/layout-6d7c9af4e43ae306.js"],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/styles/globals.css":{id:5786,name:"*",chunks:["18","static/chunks/18-38072a8067fea0f2.js","328","static/chunks/328-00159b5e32cc8d68.js","588","static/chunks/588-724c70dc56b71275.js","663","static/chunks/663-4915b4e4bd6ece43.js","70","static/chunks/70-e2e4ebd5ffa7fffa.js","177","static/chunks/app/layout-6d7c9af4e43ae306.js"],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/client/app-dir/link.js":{id:6874,name:"*",chunks:["874","static/chunks/874-388fc2c45cfe879a.js","18","static/chunks/18-38072a8067fea0f2.js","328","static/chunks/328-00159b5e32cc8d68.js","588","static/chunks/588-724c70dc56b71275.js","753","static/chunks/753-48868819506ab8be.js","831","static/chunks/831-0d52bc7b8e6a04dd.js","111","static/chunks/111-7a11da38c580ada5.js","567","static/chunks/567-b71d91cd8494cb9b.js","974","static/chunks/app/page-aa57a2b711e41e2a.js"],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/node_modules/next/dist/esm/client/app-dir/link.js":{id:6874,name:"*",chunks:["874","static/chunks/874-388fc2c45cfe879a.js","18","static/chunks/18-38072a8067fea0f2.js","328","static/chunks/328-00159b5e32cc8d68.js","588","static/chunks/588-724c70dc56b71275.js","753","static/chunks/753-48868819506ab8be.js","831","static/chunks/831-0d52bc7b8e6a04dd.js","111","static/chunks/111-7a11da38c580ada5.js","567","static/chunks/567-b71d91cd8494cb9b.js","974","static/chunks/app/page-aa57a2b711e41e2a.js"],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/admin/access-key-manager.tsx":{id:7931,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/admin/token-pricing-card.tsx":{id:412,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/feedback/form.tsx":{id:7329,name:"*",chunks:["874","static/chunks/874-388fc2c45cfe879a.js","18","static/chunks/18-38072a8067fea0f2.js","328","static/chunks/328-00159b5e32cc8d68.js","588","static/chunks/588-724c70dc56b71275.js","753","static/chunks/753-48868819506ab8be.js","831","static/chunks/831-0d52bc7b8e6a04dd.js","111","static/chunks/111-7a11da38c580ada5.js","567","static/chunks/567-b71d91cd8494cb9b.js","974","static/chunks/app/page-aa57a2b711e41e2a.js"],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/keyword-editor/keyword-editor-container.tsx":{id:7118,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/layout/logo.tsx":{id:5884,name:"*",chunks:["874","static/chunks/874-388fc2c45cfe879a.js","18","static/chunks/18-38072a8067fea0f2.js","328","static/chunks/328-00159b5e32cc8d68.js","588","static/chunks/588-724c70dc56b71275.js","753","static/chunks/753-48868819506ab8be.js","831","static/chunks/831-0d52bc7b8e6a04dd.js","111","static/chunks/111-7a11da38c580ada5.js","567","static/chunks/567-b71d91cd8494cb9b.js","974","static/chunks/app/page-aa57a2b711e41e2a.js"],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/locale/swither-select.tsx":{id:8155,name:"*",chunks:["874","static/chunks/874-388fc2c45cfe879a.js","18","static/chunks/18-38072a8067fea0f2.js","328","static/chunks/328-00159b5e32cc8d68.js","588","static/chunks/588-724c70dc56b71275.js","753","static/chunks/753-48868819506ab8be.js","831","static/chunks/831-0d52bc7b8e6a04dd.js","111","static/chunks/111-7a11da38c580ada5.js","567","static/chunks/567-b71d91cd8494cb9b.js","974","static/chunks/app/page-aa57a2b711e41e2a.js"],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/settings/settings-button.tsx":{id:2678,name:"*",chunks:["874","static/chunks/874-388fc2c45cfe879a.js","18","static/chunks/18-38072a8067fea0f2.js","328","static/chunks/328-00159b5e32cc8d68.js","588","static/chunks/588-724c70dc56b71275.js","753","static/chunks/753-48868819506ab8be.js","831","static/chunks/831-0d52bc7b8e6a04dd.js","111","static/chunks/111-7a11da38c580ada5.js","567","static/chunks/567-b71d91cd8494cb9b.js","974","static/chunks/app/page-aa57a2b711e41e2a.js"],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/theme-toggle.tsx":{id:6688,name:"*",chunks:["874","static/chunks/874-388fc2c45cfe879a.js","18","static/chunks/18-38072a8067fea0f2.js","328","static/chunks/328-00159b5e32cc8d68.js","588","static/chunks/588-724c70dc56b71275.js","753","static/chunks/753-48868819506ab8be.js","831","static/chunks/831-0d52bc7b8e6a04dd.js","111","static/chunks/111-7a11da38c580ada5.js","567","static/chunks/567-b71d91cd8494cb9b.js","974","static/chunks/app/page-aa57a2b711e41e2a.js"],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/ui/dialog.tsx":{id:4165,name:"*",chunks:["874","static/chunks/874-388fc2c45cfe879a.js","18","static/chunks/18-38072a8067fea0f2.js","328","static/chunks/328-00159b5e32cc8d68.js","588","static/chunks/588-724c70dc56b71275.js","753","static/chunks/753-48868819506ab8be.js","831","static/chunks/831-0d52bc7b8e6a04dd.js","111","static/chunks/111-7a11da38c580ada5.js","567","static/chunks/567-b71d91cd8494cb9b.js","974","static/chunks/app/page-aa57a2b711e41e2a.js"],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/keys/copy-access-key-button.tsx":{id:594,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/settings/api-settings.tsx":{id:733,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/settings/blacklist-manager.tsx":{id:2337,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/settings/preferred-manager.tsx":{id:3531,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/ui/tabs.tsx":{id:7313,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/auth/admin-login-form.tsx":{id:413,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/auth/login-form.tsx":{id:2363,name:"*",chunks:[],async:!1},"/Users/Zhuanz/Downloads/auto-external-links-main/src/components/billing/top-up-form.tsx":{id:5529,name:"*",chunks:[],async:!1}},entryCSSFiles:{"/Users/Zhuanz/Downloads/auto-external-links-main/src/":[],"/Users/Zhuanz/Downloads/auto-external-links-main/src/app/layout":[{inlined:!1,path:"static/css/2fa2b5aa9f89efa1.css"}],"/Users/Zhuanz/Downloads/auto-external-links-main/src/app/not-found":[],"/Users/Zhuanz/Downloads/auto-external-links-main/src/app/page":[],"/Users/Zhuanz/Downloads/auto-external-links-main/src/app/api/external-links/route":[]},rscModuleMapping:{},edgeRscModuleMapping:{}},te.__BUILD_MANIFEST={polyfillFiles:["static/chunks/polyfills-42372ed130431b0a.js"],devFiles:[],ampDevFiles:[],lowPriorityFiles:[],rootMainFiles:["static/chunks/webpack-71e3073034177556.js","static/chunks/4bd1b696-ee16c391371d9e7f.js","static/chunks/317-4ba3a178d400b340.js","static/chunks/main-app-ea5364cd3e9fac40.js"],rootMainFilesTree:{},pages:{"/_app":["static/chunks/webpack-71e3073034177556.js","static/chunks/framework-f593a28cde54158e.js","static/chunks/main-aab1fe9e560ba1d1.js","static/chunks/pages/_app-da15c11dea942c36.js"],"/_error":["static/chunks/webpack-71e3073034177556.js","static/chunks/framework-f593a28cde54158e.js","static/chunks/main-aab1fe9e560ba1d1.js","static/chunks/pages/_error-cc3f077a18ea1793.js"]},ampFirstPages:[]},te.__BUILD_MANIFEST.lowPriorityFiles=["/static/YOEvNBe1YRTSdsb_KivMO/_buildManifest.js",,"/static/YOEvNBe1YRTSdsb_KivMO/_ssgManifest.js"],q.__REACT_LOADABLE_MANIFEST=jc,q.__NEXT_FONT_MANIFEST=Ic,q.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",(()=>{"use strict";var pe={},he={};function S(O){var F=he[O];if(F!==void 0)return F.exports;var Y=he[O]={exports:{}},se=!0;try{pe[O](Y,Y.exports,S),se=!1}finally{se&&delete he[O]}return Y.exports}S.m=pe,S.amdO={},(()=>{var O=[];S.O=(F,Y,se,ie)=>{if(Y){ie=ie||0;for(var ee=O.length;ee>0&&O[ee-1][2]>ie;ee--)O[ee]=O[ee-1];O[ee]=[Y,se,ie];return}for(var le=1/0,ee=0;ee<O.length;ee++){for(var[Y,se,ie]=O[ee],B=!0,ne=0;ne<Y.length;ne++)(!1&ie||le>=ie)&&Object.keys(S.O).every(Pe=>S.O[Pe](Y[ne]))?Y.splice(ne--,1):(B=!1,ie<le&&(le=ie));if(B){O.splice(ee--,1);var K=se();K!==void 0&&(F=K)}}return F}})(),S.n=O=>{var F=O&&O.__esModule?()=>O.default:()=>O;return S.d(F,{a:F}),F},(()=>{var O,F=Object.getPrototypeOf?Y=>Object.getPrototypeOf(Y):Y=>Y.__proto__;S.t=function(Y,se){if(1&se&&(Y=this(Y)),8&se||typeof Y=="object"&&Y&&(4&se&&Y.__esModule||16&se&&typeof Y.then=="function"))return Y;var ie=Object.create(null);S.r(ie);var ee={};O=O||[null,F({}),F([]),F(F)];for(var le=2&se&&Y;typeof le=="object"&&!~O.indexOf(le);le=F(le))Object.getOwnPropertyNames(le).forEach(B=>ee[B]=()=>Y[B]);return ee.default=()=>Y,S.d(ie,ee),ie}})(),S.d=(O,F)=>{for(var Y in F)S.o(F,Y)&&!S.o(O,Y)&&Object.defineProperty(O,Y,{enumerable:!0,get:F[Y]})},S.e=()=>Promise.resolve(),S.g=function(){if(typeof te=="object")return te;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),S.o=(O,F)=>Object.prototype.hasOwnProperty.call(O,F),S.r=O=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})},(()=>{var O={149:0};S.O.j=se=>O[se]===0;var F=(se,ie)=>{var ee,le,[B,ne,K]=ie,H=0;if(B.some(Ee=>O[Ee]!==0)){for(ee in ne)S.o(ne,ee)&&(S.m[ee]=ne[ee]);if(K)var ye=K(S)}for(se&&se(ie);H<B.length;H++)le=B[H],S.o(O,le)&&O[le]&&O[le][0](),O[le]=0;return S.O(ye)},Y=q.webpackChunk_N_E=q.webpackChunk_N_E||[];Y.forEach(F.bind(null,0)),Y.push=F.bind(null,Y.push.bind(Y))})(),S.nc=void 0})(),(q.webpackChunk_N_E=q.webpackChunk_N_E||[]).push([[64],{770:xc,899:wc,2504:bc,3337:vc,4318:kc,4515:yc,4819:_c,5455:gc,5835:fc,5932:hc,6225:mc,10252:dc,10501:pc,12737:cc,14459:uc,16129:lc,16170:ic,18622:oc,20050:rc,20534:sc,21408:nc,24842:ac,25951:tc,26804:ec,27075:Qu,28123:Xu,29160:Gu,29691:Wu,32058:Bi,32223:zi,32410:Ju,34319:Hu,35297:Ku,37612:Zi,37753:Vu,38730:Bu,39055:zu,39890:Zu,40007:Lu,41411:Fu,44430:qu,45375:Uu,46711:Du,47827:$u,51251:Yu,54181:Pu,54195:Mu,55421:Cu,57779:Ou,60424:Au,61480:Nu,64144:Ru,64356:Tu,65912:Li,66464:Su,67411:Eu,67855:ju,69079:Iu,69103:xu,70424:wu,71092:bu,71290:vu,73144:ku,76237:yu,76243:_u,77404:gu,77621:fu,77935:hu,80002:mu,81238:du,81818:pu,82490:cu,83543:uu,83689:lu,84102:iu,85168:ou,88006:ru,89079:su,90897:nu,92295:au,92438:tu,93936:eu,94186:Ql,94337:Xl,96534:Gl,96610:Wl,97205:Jl,97426:Hl,97530:Kl,99143:Vl}]),(q.webpackChunk_N_E=q.webpackChunk_N_E||[]).push([[988],{6133:Bl,22710:zl,27223:Zl}]),(q.webpackChunk_N_E=q.webpackChunk_N_E||[]).push([[949],{9656:Ll,24949:Fl}]),(q.webpackChunk_N_E=q.webpackChunk_N_E||[]).push([[683],{11562:yl,21353:_l,38910:gl,76766:fl,85885:hl}]),(q.webpackChunk_N_E=q.webpackChunk_N_E||[]).push([[581],{32945:al,35237:tl,39491:el,42409:Qi,56474:Xi,65667:Gi,70974:Wi}]),(q.webpackChunk_N_E=q.webpackChunk_N_E||[]).push([[432],{23498:ul,93432:ll}]),(q.webpackChunk_N_E=q.webpackChunk_N_E||[]).push([[86],{2709:Dl,6640:$l,21438:Yl,23768:Pl,25325:Ml,25481:Cl,38062:Ol,56567:Al,58429:Nl,58829:Rl,59908:Tl,75565:Sl,86116:El,87903:jl,89874:ql,97472:Il}]),(q.webpackChunk_N_E=q.webpackChunk_N_E||[]).push([[799],{97799:bl}]),(q.webpackChunk_N_E=q.webpackChunk_N_E||[]).push([[24],{2758:vl,2793:ml,18535:xl,31239:kl,52748:dl,65662:pl,89538:il}]),(q.webpackChunk_N_E=q.webpackChunk_N_E||[]).push([[76],{2421:ol,7218:Hi,32042:Ki,37076:sl,51817:Ji,78446:Vi}]),(q.webpackChunk_N_E=q.webpackChunk_N_E||[]).push([[507],{16299:(pe,he,S)=>{"use strict";S.r(he),S.d(he,{"406ac46e86d11021b42b2b6f7a751c1aec1df9f321":()=>F.SQ,"4082fbaa96fc13fd557ac521c7d38744bc62c7d0f3":()=>F.BU,"60064f58dce69fd87795d97a80d927e732cbfc8c08":()=>F.L9,"7054a05d6b3fa459cdf8848e85a29e363c666f3ce3":()=>O.F,"70fe885fa7669e3795aee230f7e998238a89ff4df0":()=>F.ZU,"7fac6c6034cd81c225371fb5bc72d5b53fae0269d4":()=>O.z});var O=S(75168),F=S(37076)},17440:(pe,he,S)=>{"use strict";var O=S(25356).Buffer;let F=O!==void 0,Y=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,se=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function ie(B,ne,K){K==null&&ne!==null&&typeof ne=="object"&&(K=ne,ne=void 0),F&&O.isBuffer(B)&&(B=B.toString()),B&&B.charCodeAt(0)===65279&&(B=B.slice(1));let H=JSON.parse(B,ne);if(H===null||typeof H!="object")return H;let ye=K&&K.protoAction||"error",Ee=K&&K.constructorAction||"error";if(ye==="ignore"&&Ee==="ignore")return H;if(ye!=="ignore"&&Ee!=="ignore"){if(Y.test(B)===!1&&se.test(B)===!1)return H}else if(ye!=="ignore"&&Ee==="ignore"){if(Y.test(B)===!1)return H}else if(se.test(B)===!1)return H;return ee(H,{protoAction:ye,constructorAction:Ee,safe:K&&K.safe})}function ee(B,{protoAction:ne="error",constructorAction:K="error",safe:H}={}){let ye=[B];for(;ye.length;){let Ee=ye;for(let xe of(ye=[],Ee)){if(ne!=="ignore"&&Object.prototype.hasOwnProperty.call(xe,"__proto__")){if(H===!0)return null;if(ne==="error")throw SyntaxError("Object contains forbidden prototype property");delete xe.__proto__}if(K!=="ignore"&&Object.prototype.hasOwnProperty.call(xe,"constructor")&&Object.prototype.hasOwnProperty.call(xe.constructor,"prototype")){if(H===!0)return null;if(K==="error")throw SyntaxError("Object contains forbidden prototype property");delete xe.constructor}for(let Pe in xe){let Ze=xe[Pe];Ze&&typeof Ze=="object"&&ye.push(Ze)}}}return B}function le(B,ne,K){let H=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return ie(B,ne,K)}finally{Error.stackTraceLimit=H}}pe.exports=le,pe.exports.default=le,pe.exports.parse=le,pe.exports.safeParse=function(B,ne){let K=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return ie(B,ne,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=K}},pe.exports.scan=ee},25356:Fi,59311:(pe,he,S)=>{"use strict";S.r(he),S.d(he,{ComponentMod:()=>Q,default:()=>L});var O,F={};S.r(F),S.d(F,{GET:()=>ct,dynamic:()=>xe,runtime:()=>Pe});var Y={};S.r(Y),S.d(Y,{patchFetch:()=>tt,routeModule:()=>Ke,serverHooks:()=>Ye,workAsyncStorage:()=>Qe,workUnitAsyncStorage:()=>et});var se=S(58429),ie=S(89874),ee=S(58829),le=S(56567),B=S(64144),ne=S(55421),K=S(70974),H=S(38910),ye=S(75168),Ee=S(89538);let xe="force-dynamic",Pe="edge",Ze=H.Ik({text:H.Yj({required_error:"\u6587\u672C\u53C2\u6570 text \u4E3A\u5FC5\u586B",invalid_type_error:"\u6587\u672C\u53C2\u6570 text \u5FC5\u987B\u662F\u5B57\u7B26\u4E32"}).min(1,"\u6587\u672C\u53C2\u6570 text \u4E0D\u80FD\u4E3A\u7A7A"),fingerprint:H.Yj().optional(),apiKey:H.Yj().optional(),baseUrl:H.Yj().optional(),model:H.Yj().optional(),provider:H.k5(["openai","custom"]).optional(),blacklist:H.YO(H.Yj()).default([]),preferredSites:H.YO(H.Yj()).default([])});function Xe(D,ue){let de=[...D.getAll(ue),...D.getAll(`${ue}[]`)];if(de.length===0){let _e=D.get(ue);_e&&de.push(_e)}return Array.from(new Set(de.flatMap(_e=>_e.split(",")).map(_e=>_e.trim()).filter(Boolean)))}async function ct(D){let ue=new URL(D.url).searchParams,de=ue.get("accessKey")??void 0;if(!de)return K.Rp.json({success:!1,error:{code:"UNAUTHORIZED",message:"\u672A\u88AB\u6388\u6743\u4F7F\u7528 Elink"}},{status:401});let _e=await(0,Ee.Ym)(de);if(!_e)return K.Rp.json({success:!1,error:{code:"UNAUTHORIZED",message:"\u672A\u88AB\u6388\u6743\u4F7F\u7528 Elink"}},{status:401});let $e={text:ue.get("text"),fingerprint:ue.get("fingerprint")??void 0,apiKey:ue.get("apiKey")??void 0,baseUrl:ue.get("baseUrl")??void 0,model:ue.get("model")??void 0,provider:ue.get("provider")??void 0,blacklist:Xe(ue,"blacklist"),preferredSites:Xe(ue,"preferredSites")},Se=Ze.safeParse($e);if(!Se.success){let ve=Se.error.issues.map(He=>({path:He.path.join("."),message:He.message}));return K.Rp.json({success:!1,error:{code:"INVALID_QUERY",message:"\u8BF7\u6C42\u53C2\u6570\u4E0D\u5408\u6CD5",details:ve}},{status:400})}let{text:R,fingerprint:at,apiKey:pt,baseUrl:Pt,model:Ae,blacklist:Yt,preferredSites:$t,provider:Xt}=Se.data,Dt=Xt??(pt?"custom":"openai");if(Dt==="custom"&&!pt)return K.Rp.json({success:!1,error:{code:"INVALID_QUERY",message:"\u4F7F\u7528\u81EA\u5B9A\u4E49\u6A21\u578B\u65F6\u5FC5\u987B\u63D0\u4F9B apiKey \u53C2\u6570\uFF08\u4EE5\u53CA\u53EF\u9009\u7684 baseUrl\uFF09"}},{status:400});try{let ve=await(0,ye.z)(R,at,0,pt||void 0,(Dt==="openai"?Pt??"https://api.openai.com/v1":Pt)||void 0,Ae||void 0,_e.email);if(ve.error){let Oe=ve.error.code==="RATE_LIMITED"?429:400;return K.Rp.json({success:!1,error:{code:ve.error.code,message:ve.error.message}},{status:Oe})}if(!ve.data)return K.Rp.json({success:!1,error:{code:"AI_ERROR",message:"\u5173\u952E\u8BCD\u5206\u6790\u5931\u8D25\uFF1A\u672A\u8FD4\u56DE\u4EFB\u4F55\u6570\u636E"}},{status:500});let He=ve.data.keywords,vt={},nt=null;try{vt=await(0,ye.F)(He.map(Oe=>({keyword:Oe.keyword,query:Oe.query})),Yt,$t)}catch(Oe){nt=Oe instanceof Error?Oe:Error(String(Oe)),console.error("[external-links-api] \u83B7\u53D6\u5916\u94FE\u5931\u8D25",nt)}let Ut=He.map(Oe=>{let dt=vt[Oe.keyword];return{...Oe,link:dt?.link??null,title:dt?.title??null,alternatives:dt?.alternatives??{preferred:[],regular:[]}}});return K.Rp.json({success:!0,data:{keywords:Ut,usage:ve.data.usage,linkFetchError:nt?{message:nt.message,name:nt.name}:null}})}catch(ve){return console.error("[external-links-api] \u8C03\u7528\u5931\u8D25",ve),K.Rp.json({success:!1,error:{code:"INTERNAL_ERROR",message:"\u5916\u94FE\u4F18\u5316 API \u8C03\u7528\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5"}},{status:500})}}let Ke=new le.AppRouteRouteModule({definition:{kind:B.A.APP_ROUTE,page:"/api/external-links/route",pathname:"/api/external-links",filename:"route",bundlePath:"app/api/external-links/route"},resolvedPagePath:"/Users/Zhuanz/Downloads/auto-external-links-main/src/app/api/external-links/route.ts",nextConfigOutput:"standalone",userland:F}),{workAsyncStorage:Qe,workUnitAsyncStorage:et,serverHooks:Ye}=Ke;function tt(){return(0,ne.V5)({workAsyncStorage:Qe,workUnitAsyncStorage:et})}let Ne=(O=q.__RSC_MANIFEST)==null?void 0:O["/api/external-links/route"],E=(D=>D?JSON.parse(D):void 0)(q.__RSC_SERVER_MANIFEST);Ne&&E&&(0,ie.fQ)({page:"/api/external-links/route",clientReferenceManifest:Ne,serverActionsManifest:E,serverModuleMap:(0,se.e)({serverActionsManifest:E})});let Q=Y,L=ee.s.wrap(Ke,{nextConfig:{env:{},eslint:{ignoreDuringBuilds:!1},typescript:{ignoreBuildErrors:!1,tsconfigPath:"tsconfig.json"},distDir:".next",cleanDistDir:!0,assetPrefix:"",cacheMaxMemorySize:52428800,configOrigin:"next.config.js",useFileSystemPublicRoutes:!0,generateEtags:!0,pageExtensions:["tsx","ts","jsx","js"],poweredByHeader:!0,compress:!0,images:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:60,formats:["image/webp"],dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",remotePatterns:[],unoptimized:!1},devIndicators:{position:"bottom-left"},onDemandEntries:{maxInactiveAge:6e4,pagesBufferLength:5},amp:{canonicalBase:""},basePath:"",sassOptions:{},trailingSlash:!1,i18n:null,productionBrowserSourceMaps:!1,excludeDefaultMomentLocales:!0,serverRuntimeConfig:{},publicRuntimeConfig:{},reactProductionProfiling:!1,reactStrictMode:null,reactMaxHeadersLength:6e3,httpAgentOptions:{keepAlive:!0},logging:{},expireTime:31536e3,staticPageGenerationTimeout:60,output:"standalone",modularizeImports:{"@mui/icons-material":{transform:"@mui/icons-material/{{member}}"},lodash:{transform:"lodash/{{member}}"}},outputFileTracingRoot:"/Users/Zhuanz/Downloads/auto-external-links-main",experimental:{nodeMiddleware:!1,cacheLife:{default:{stale:300,revalidate:900,expire:4294967294},seconds:{stale:0,revalidate:1,expire:60},minutes:{stale:300,revalidate:60,expire:3600},hours:{stale:300,revalidate:3600,expire:86400},days:{stale:300,revalidate:86400,expire:604800},weeks:{stale:300,revalidate:604800,expire:2592e3},max:{stale:300,revalidate:2592e3,expire:4294967294}},cacheHandlers:{},cssChunking:!0,multiZoneDraftMode:!1,appNavFailHandling:!1,prerenderEarlyExit:!0,serverMinification:!0,serverSourceMaps:!1,linkNoTouchStart:!1,caseSensitiveRoutes:!1,clientSegmentCache:!1,dynamicOnHover:!1,preloadEntriesOnStart:!0,clientRouterFilter:!0,clientRouterFilterRedirects:!1,fetchCacheKeyPrefix:"",middlewarePrefetch:"flexible",optimisticClientCache:!0,manualClientBasePath:!1,cpus:7,memoryBasedWorkersCount:!1,imgOptConcurrency:null,imgOptTimeoutInSeconds:7,imgOptMaxInputPixels:268402689,imgOptSequentialRead:null,isrFlushToDisk:!0,workerThreads:!1,optimizeCss:!1,nextScriptWorkers:!1,scrollRestoration:!1,externalDir:!1,disableOptimizedLoading:!1,gzipSize:!0,craCompat:!1,esmExternals:!0,fullySpecified:!1,swcTraceProfiling:!1,forceSwcTransforms:!1,largePageDataBytes:128e3,typedRoutes:!1,typedEnv:!1,parallelServerCompiles:!1,parallelServerBuildTraces:!1,ppr:!1,authInterrupts:!1,webpackMemoryOptimizations:!1,optimizeServerReact:!0,useEarlyImport:!1,viewTransition:!1,routerBFCache:!1,staleTimes:{dynamic:0,static:300},serverComponentsHmrCache:!0,staticGenerationMaxConcurrency:8,staticGenerationMinPagesPerWorker:25,dynamicIO:!1,inlineCss:!1,useCache:!1,optimizePackageImports:["lucide-react","date-fns","lodash-es","ramda","antd","react-bootstrap","ahooks","@ant-design/icons","@headlessui/react","@headlessui-float/react","@heroicons/react/20/solid","@heroicons/react/24/solid","@heroicons/react/24/outline","@visx/visx","@tremor/react","rxjs","@mui/material","@mui/icons-material","recharts","react-use","effect","@effect/schema","@effect/platform","@effect/platform-node","@effect/platform-browser","@effect/platform-bun","@effect/sql","@effect/sql-mssql","@effect/sql-mysql2","@effect/sql-pg","@effect/sql-squlite-node","@effect/sql-squlite-bun","@effect/sql-squlite-wasm","@effect/sql-squlite-react-native","@effect/rpc","@effect/rpc-http","@effect/typeclass","@effect/experimental","@effect/opentelemetry","@material-ui/core","@material-ui/icons","@tabler/icons-react","mui-core","react-icons/ai","react-icons/bi","react-icons/bs","react-icons/cg","react-icons/ci","react-icons/di","react-icons/fa","react-icons/fa6","react-icons/fc","react-icons/fi","react-icons/gi","react-icons/go","react-icons/gr","react-icons/hi","react-icons/hi2","react-icons/im","react-icons/io","react-icons/io5","react-icons/lia","react-icons/lib","react-icons/lu","react-icons/md","react-icons/pi","react-icons/ri","react-icons/rx","react-icons/si","react-icons/sl","react-icons/tb","react-icons/tfi","react-icons/ti","react-icons/vsc","react-icons/wi"]},htmlLimitedBots:"Mediapartners-Google|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|Yeti",bundlePagesRouterDependencies:!1,configFile:"/Users/Zhuanz/Downloads/auto-external-links-main/next.config.js",configFileName:"next.config.js",serverExternalPackages:["nodemailer"],turbopack:{root:"/Users/Zhuanz/Downloads/auto-external-links-main"}}})},65521:qi,75168:(pe,he,S)=>{"use strict";let O;S.d(he,{F:()=>Ea,z:()=>ja});var F,Y,se,ie,ee,le,B,ne,K,H,ye,Ee,xe,Pe,Ze,Xe,ct,Ke,Qe,et,Ye,tt,Ne,E,Q,L,D,ue,de=S(32042);S(7218);var _e="vercel.ai.error",$e=Symbol.for(_e),Se=class ys extends Error{constructor({name:t,message:s,cause:a}){super(s),this[F]=!0,this.name=t,this.cause=a}static isInstance(t){return ys.hasMarker(t,_e)}static hasMarker(t,s){let a=Symbol.for(s);return t!=null&&typeof t=="object"&&a in t&&typeof t[a]=="boolean"&&t[a]===!0}};F=$e;var R=Se,at="AI_APICallError",pt=`vercel.ai.error.${at}`,Pt=Symbol.for(pt),Ae=class extends R{constructor({message:e,url:t,requestBodyValues:s,statusCode:a,responseHeaders:r,responseBody:o,cause:i,isRetryable:u=a!=null&&(a===408||a===409||a===429||a>=500),data:c}){super({name:at,message:e,cause:i}),this[Y]=!0,this.url=t,this.requestBodyValues=s,this.statusCode=a,this.responseHeaders=r,this.responseBody=o,this.isRetryable=u,this.data=c}static isInstance(e){return R.hasMarker(e,pt)}};Y=Pt;var Yt="AI_EmptyResponseBodyError",$t=`vercel.ai.error.${Yt}`,Xt=Symbol.for($t),Dt=class extends R{constructor({message:e="Empty response body"}={}){super({name:Yt,message:e}),this[se]=!0}static isInstance(e){return R.hasMarker(e,$t)}};function ve(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}se=Xt;var He="AI_InvalidArgumentError",vt=`vercel.ai.error.${He}`,nt=Symbol.for(vt),Ut=class extends R{constructor({message:e,cause:t,argument:s}){super({name:He,message:e,cause:t}),this[ie]=!0,this.argument=s}static isInstance(e){return R.hasMarker(e,vt)}};ie=nt;var Oe="AI_InvalidPromptError",dt=`vercel.ai.error.${Oe}`,ks=Symbol.for(dt),ze=class extends R{constructor({prompt:e,message:t,cause:s}){super({name:Oe,message:`Invalid prompt: ${t}`,cause:s}),this[ee]=!0,this.prompt=e}static isInstance(e){return R.hasMarker(e,dt)}};ee=ks;var Ya="AI_InvalidResponseDataError",$a=`vercel.ai.error.${Ya}`,vs=Symbol.for($a),Qt=class extends R{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:Ya,message:t}),this[le]=!0,this.data=e}static isInstance(e){return R.hasMarker(e,$a)}};le=vs;var Da="AI_JSONParseError",Ua=`vercel.ai.error.${Da}`,bs=Symbol.for(Ua),bt=class extends R{constructor({text:e,cause:t}){super({name:Da,message:`JSON parsing failed: Text: ${e}.
Error message: ${ve(t)}`,cause:t}),this[B]=!0,this.text=e}static isInstance(e){return R.hasMarker(e,Ua)}};B=bs;var qa="AI_LoadAPIKeyError",Fa=`vercel.ai.error.${qa}`,ws=Symbol.for(Fa),qt=class extends R{constructor({message:e}){super({name:qa,message:e}),this[ne]=!0}static isInstance(e){return R.hasMarker(e,Fa)}};ne=ws;var Sc=Symbol.for("vercel.ai.error.AI_LoadSettingError"),Tc=Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),La="AI_NoSuchModelError",Za=`vercel.ai.error.${La}`,xs=Symbol.for(Za),Is=class extends R{constructor({errorName:e=La,modelId:t,modelType:s,message:a=`No such ${s}: ${t}`}){super({name:e,message:a}),this[K]=!0,this.modelId=t,this.modelType=s}static isInstance(e){return R.hasMarker(e,Za)}};K=xs;var za="AI_TooManyEmbeddingValuesForCallError",Ba=`vercel.ai.error.${za}`,js=Symbol.for(Ba),Es=class extends R{constructor(e){super({name:za,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[H]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return R.hasMarker(e,Ba)}};H=js;var Va="AI_TypeValidationError",Ka=`vercel.ai.error.${Va}`,Ss=Symbol.for(Ka),Be=class Na extends R{constructor({value:t,cause:s}){super({name:Va,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${ve(s)}`,cause:s}),this[ye]=!0,this.value=t}static isInstance(t){return R.hasMarker(t,Ka)}static wrap({value:t,cause:s}){return Na.isInstance(s)&&s.value===t?s:new Na({value:t,cause:s})}};ye=Ss;var Ha="AI_UnsupportedFunctionalityError",Ja=`vercel.ai.error.${Ha}`,Ts=Symbol.for(Ja),fe=class extends R{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:Ha,message:t}),this[Ee]=!0,this.functionality=e}static isInstance(e){return R.hasMarker(e,Ja)}};function Ft(e){return e===null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"||(Array.isArray(e)?e.every(Ft):typeof e=="object"&&Object.entries(e).every(([t,s])=>typeof t=="string"&&Ft(s)))}function Wa(e){return Array.isArray(e)&&e.every(Ft)}function ea(e){return e!=null&&typeof e=="object"&&Object.entries(e).every(([t,s])=>typeof t=="string"&&Ft(s))}Ee=Ts;let Rs=(e,t=21)=>(s=t)=>{let a="",r=0|s;for(;r--;)a+=e[Math.random()*e.length|0];return a};var ta=S(17440);function qe(...e){return e.reduce((t,s)=>({...t,...s??{}}),{})}async function Ns(e){return e==null?Promise.resolve():new Promise(t=>setTimeout(t,e))}function wt(e){let t={};return e.headers.forEach((s,a)=>{t[a]=s}),t}var st=({prefix:e,size:t=16,alphabet:s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{let r=Rs(s,t);if(e==null)return r;if(s.includes(a))throw new Ut({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${s}".`});return o=>`${e}${a}${r(o)}`},rt=st();function Lt(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}var Zt=Symbol.for("vercel.ai.validator");function Je({value:e,schema:t}){var s;let a=typeof t=="object"&&t!==null&&Zt in t&&t[Zt]===!0&&"validate"in t?t:(s=t,{[Zt]:!0,validate:r=>{let o=s.safeParse(r);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}});try{if(a.validate==null)return{success:!0,value:e};let r=a.validate(e);return r.success?r:{success:!1,error:Be.wrap({value:e,cause:r.error})}}catch(r){return{success:!1,error:Be.wrap({value:e,cause:r})}}}function mt({text:e,schema:t}){try{let s=ta.parse(e);if(t==null)return{success:!0,value:s,rawValue:s};let a=Je({value:s,schema:t});return a.success?{...a,rawValue:s}:a}catch(s){return{success:!1,error:bt.isInstance(s)?s:new bt({text:e,cause:s})}}}function Ga(e){try{return ta.parse(e),!0}catch{return!1}}function aa({provider:e,providerOptions:t,schema:s}){if(t?.[e]==null)return;let a=Je({value:t[e],schema:s});if(!a.success)throw new Ut({argument:"providerOptions",message:`invalid ${e} provider options`,cause:a.error});return a.value}var As=()=>te.fetch,Ve=async({url:e,headers:t,body:s,failedResponseHandler:a,successfulResponseHandler:r,abortSignal:o,fetch:i})=>Xa({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(s),values:s},failedResponseHandler:a,successfulResponseHandler:r,abortSignal:o,fetch:i}),Os=async({url:e,headers:t,formData:s,failedResponseHandler:a,successfulResponseHandler:r,abortSignal:o,fetch:i})=>Xa({url:e,headers:t,body:{content:s,values:Object.fromEntries(s.entries())},failedResponseHandler:a,successfulResponseHandler:r,abortSignal:o,fetch:i}),Xa=async({url:e,headers:t={},body:s,successfulResponseHandler:a,failedResponseHandler:r,abortSignal:o,fetch:i=As()})=>{try{var u;let c=await i(e,{method:"POST",headers:(u=t,Object.fromEntries(Object.entries(u).filter(([p,l])=>l!=null))),body:s.content,signal:o}),d=wt(c);if(!c.ok){let p;try{p=await r({response:c,url:e,requestBodyValues:s.values})}catch(l){throw Lt(l)||Ae.isInstance(l)?l:new Ae({message:"Failed to process error response",cause:l,statusCode:c.status,url:e,responseHeaders:d,requestBodyValues:s.values})}throw p.value}try{return await a({response:c,url:e,requestBodyValues:s.values})}catch(p){throw p instanceof Error&&(Lt(p)||Ae.isInstance(p))?p:new Ae({message:"Failed to process successful response",cause:p,statusCode:c.status,url:e,responseHeaders:d,requestBodyValues:s.values})}}catch(c){if(Lt(c))throw c;if(c instanceof TypeError&&c.message==="fetch failed"){let d=c.cause;if(d!=null)throw new Ae({message:`Cannot connect to API: ${d.message}`,cause:d,url:e,requestBodyValues:s.values,isRetryable:!0})}throw c}},na=e=>async({response:t})=>{let s=wt(t);if(t.body==null)throw new Dt({});return{responseHeaders:s,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(function(){let a,r,o,i="",u=[];function c(l,f){if(l==="")return void d(f);if(l.startsWith(":"))return;let j=l.indexOf(":");if(j===-1)return void p(l,"");let k=l.slice(0,j),h=j+1;p(k,h<l.length&&l[h]===" "?l.slice(h+1):l.slice(h))}function d(l){u.length>0&&(l.enqueue({event:a,data:u.join(`
`),id:r,retry:o}),u=[],a=void 0,o=void 0)}function p(l,f){switch(l){case"event":a=f;break;case"data":u.push(f);break;case"id":r=f;break;case"retry":let j=parseInt(f,10);isNaN(j)||(o=j)}}return new TransformStream({transform(l,f){let{lines:j,incompleteLine:k}=function(h,m){let g=[],x=h;for(let w=0;w<m.length;){let v=m[w++];v===`
`?(g.push(x),x=""):v==="\r"?(g.push(x),x="",m[w]===`
`&&w++):x+=v}return{lines:g,incompleteLine:x}}(i,l);i=k;for(let h=0;h<j.length;h++)c(j[h],f)},flush(l){c(i,l),d(l)}})}()).pipeThrough(new TransformStream({transform({data:a},r){a!=="[DONE]"&&r.enqueue(mt({text:a,schema:e}))}}))}},ht=e=>async({response:t,url:s,requestBodyValues:a})=>{let r=await t.text(),o=mt({text:r,schema:e}),i=wt(t);if(!o.success)throw new Ae({message:"Invalid JSON response",cause:o.error,statusCode:t.status,responseHeaders:i,responseBody:r,url:s,requestBodyValues:a});return{responseHeaders:i,value:o.value,rawValue:o.rawValue}},Cs=()=>async({response:e,url:t,requestBodyValues:s})=>{let a=wt(e);if(!e.body)throw new Ae({message:"Response body is empty",url:t,requestBodyValues:s,statusCode:e.status,responseHeaders:a,responseBody:void 0});try{let r=await e.arrayBuffer();return{responseHeaders:a,value:new Uint8Array(r)}}catch(r){throw new Ae({message:"Failed to read response as array buffer",url:t,requestBodyValues:s,statusCode:e.status,responseHeaders:a,responseBody:void 0,cause:r})}},{btoa:Ms,atob:Ps}=te;function zt(e){let t=Ps(e.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(t,s=>s.codePointAt(0))}function xt(e){let t="";for(let s=0;s<e.length;s++)t+=String.fromCodePoint(e[s]);return Ms(t)}var n=S(38910);function Qa(e){var t,s;return(s=(t=e?.content)==null?void 0:t.map(({token:a,logprob:r,top_logprobs:o})=>({token:a,logprob:r,topLogprobs:o?o.map(({token:i,logprob:u})=>({token:i,logprob:u})):[]})))!=null?s:void 0}function Bt(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var sa=n.Ik({error:n.Ik({message:n.Yj(),type:n.Yj().nullish(),param:n.bz().nullish(),code:n.KC([n.Yj(),n.ai()]).nullish()})}),Fe=(({errorSchema:e,errorToMessage:t,isRetryable:s})=>async({response:a,url:r,requestBodyValues:o})=>{let i=await a.text(),u=wt(a);if(i.trim()==="")return{responseHeaders:u,value:new Ae({message:a.statusText,url:r,requestBodyValues:o,statusCode:a.status,responseHeaders:u,responseBody:i,isRetryable:s?.(a)})};try{let c=function({text:d,schema:p}){try{let l=ta.parse(d);return p==null?l:function({value:f,schema:j}){let k=Je({value:f,schema:j});if(!k.success)throw Be.wrap({value:f,cause:k.error});return k.value}({value:l,schema:p})}catch(l){throw bt.isInstance(l)||Be.isInstance(l)?l:new bt({text:d,cause:l})}}({text:i,schema:e});return{responseHeaders:u,value:new Ae({message:t(c),url:r,requestBodyValues:o,statusCode:a.status,responseHeaders:u,responseBody:i,data:c,isRetryable:s?.(a,c)})}}catch{return{responseHeaders:u,value:new Ae({message:a.statusText,url:r,requestBodyValues:o,statusCode:a.status,responseHeaders:u,responseBody:i,isRetryable:s?.(a)})}}})({errorSchema:sa,errorToMessage:e=>e.error.message});function Vt({id:e,model:t,created:s}){return{id:e??void 0,modelId:t??void 0,timestamp:s!=null?new Date(1e3*s):void 0}}var Ys=class{constructor(e,t,s){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=s}get supportsStructuredOutputs(){var e;return(e=this.settings.structuredOutputs)!=null?e:ra(this.modelId)}get defaultObjectGenerationMode(){return this.modelId.startsWith("gpt-4o-audio-preview")?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:s,temperature:a,topP:r,topK:o,frequencyPenalty:i,presencePenalty:u,stopSequences:c,responseFormat:d,seed:p,providerMetadata:l}){var f,j,k,h,m,g,x,w,v,I,T;let M=e.type,_=[];o!=null&&_.push({type:"unsupported-setting",setting:"topK"}),d?.type!=="json"||d.schema==null||this.supportsStructuredOutputs||_.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let y=this.settings.useLegacyFunctionCalling;if(y&&this.settings.parallelToolCalls===!0)throw new fe({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(y&&this.supportsStructuredOutputs)throw new fe({functionality:"structuredOutputs with useLegacyFunctionCalling"});let{messages:$,warnings:A}=function({prompt:J,useLegacyFunctionCalling:N=!1,systemMessageMode:W="system"}){let G=[],ge=[];for(let{role:V,content:z}of J)switch(V){case"system":switch(W){case"system":G.push({role:"system",content:z});break;case"developer":G.push({role:"developer",content:z});break;case"remove":ge.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${W}`)}break;case"user":if(z.length===1&&z[0].type==="text"){G.push({role:"user",content:z[0].text});break}G.push({role:"user",content:z.map((U,Z)=>{var Ie,be,Me,re;switch(U.type){case"text":return{type:"text",text:U.text};case"image":return{type:"image_url",image_url:{url:U.image instanceof URL?U.image.toString():`data:${(Ie=U.mimeType)!=null?Ie:"image/jpeg"};base64,${xt(U.image)}`,detail:(Me=(be=U.providerMetadata)==null?void 0:be.openai)==null?void 0:Me.imageDetail}};case"file":if(U.data instanceof URL)throw new fe({functionality:"'File content parts with URL data' functionality not supported."});switch(U.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:U.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:U.data,format:"mp3"}};case"application/pdf":return{type:"file",file:{filename:(re=U.filename)!=null?re:`part-${Z}.pdf`,file_data:`data:application/pdf;base64,${U.data}`}};default:throw new fe({functionality:`File content part type ${U.mimeType} in user messages`})}}})});break;case"assistant":{let U="",Z=[];for(let Ie of z)switch(Ie.type){case"text":U+=Ie.text;break;case"tool-call":Z.push({id:Ie.toolCallId,type:"function",function:{name:Ie.toolName,arguments:JSON.stringify(Ie.args)}})}if(N){if(Z.length>1)throw new fe({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});G.push({role:"assistant",content:U,function_call:Z.length>0?Z[0].function:void 0})}else G.push({role:"assistant",content:U,tool_calls:Z.length>0?Z:void 0});break}case"tool":for(let U of z)N?G.push({role:"function",name:U.toolName,content:JSON.stringify(U.result)}):G.push({role:"tool",tool_call_id:U.toolCallId,content:JSON.stringify(U.result)});break;default:throw Error(`Unsupported role: ${V}`)}return{messages:G,warnings:ge}}({prompt:t,useLegacyFunctionCalling:y,systemMessageMode:ra(v=this.modelId)?(T=(I=Us[v])==null?void 0:I.systemMessageMode)!=null?T:"developer":"system"});_.push(...A);let P={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"||void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:s,temperature:a,top_p:r,frequency_penalty:i,presence_penalty:u,response_format:d?.type==="json"?this.supportsStructuredOutputs&&d.schema!=null?{type:"json_schema",json_schema:{schema:d.schema,strict:!0,name:(f=d.name)!=null?f:"response",description:d.description}}:{type:"json_object"}:void 0,stop:c,seed:p,max_completion_tokens:(j=l?.openai)==null?void 0:j.maxCompletionTokens,store:(k=l?.openai)==null?void 0:k.store,metadata:(h=l?.openai)==null?void 0:h.metadata,prediction:(m=l?.openai)==null?void 0:m.prediction,reasoning_effort:(x=(g=l?.openai)==null?void 0:g.reasoningEffort)!=null?x:this.settings.reasoningEffort,messages:$};switch(ra(this.modelId)?(P.temperature!=null&&(P.temperature=void 0,_.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),P.top_p!=null&&(P.top_p=void 0,_.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),P.frequency_penalty!=null&&(P.frequency_penalty=void 0,_.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),P.presence_penalty!=null&&(P.presence_penalty=void 0,_.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),P.logit_bias!=null&&(P.logit_bias=void 0,_.push({type:"other",message:"logitBias is not supported for reasoning models"})),P.logprobs!=null&&(P.logprobs=void 0,_.push({type:"other",message:"logprobs is not supported for reasoning models"})),P.top_logprobs!=null&&(P.top_logprobs=void 0,_.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),P.max_tokens!=null&&(P.max_completion_tokens==null&&(P.max_completion_tokens=P.max_tokens),P.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&P.temperature!=null&&(P.temperature=void 0,_.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),M){case"regular":{let{tools:J,tool_choice:N,functions:W,function_call:G,toolWarnings:ge}=function({mode:V,useLegacyFunctionCalling:z=!1,structuredOutputs:U}){var Z;let Ie=(Z=V.tools)!=null&&Z.length?V.tools:void 0,be=[];if(Ie==null)return{tools:void 0,tool_choice:void 0,toolWarnings:be};let Me=V.toolChoice;if(z){let oe=[];for(let we of Ie)we.type==="provider-defined"?be.push({type:"unsupported-tool",tool:we}):oe.push({name:we.name,description:we.description,parameters:we.parameters});if(Me==null)return{functions:oe,function_call:void 0,toolWarnings:be};switch(Me.type){case"auto":case"none":case void 0:return{functions:oe,function_call:void 0,toolWarnings:be};case"required":throw new fe({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:oe,function_call:{name:Me.toolName},toolWarnings:be}}}let re=[];for(let oe of Ie)oe.type==="provider-defined"?be.push({type:"unsupported-tool",tool:oe}):re.push({type:"function",function:{name:oe.name,description:oe.description,parameters:oe.parameters,strict:!!U||void 0}});if(Me==null)return{tools:re,tool_choice:void 0,toolWarnings:be};let je=Me.type;switch(je){case"auto":case"none":case"required":return{tools:re,tool_choice:je,toolWarnings:be};case"tool":return{tools:re,tool_choice:{type:"function",function:{name:Me.toolName}},toolWarnings:be};default:throw new fe({functionality:`Unsupported tool choice type: ${je}`})}}({mode:e,useLegacyFunctionCalling:y,structuredOutputs:this.supportsStructuredOutputs});return{args:{...P,tools:J,tool_choice:N,functions:W,function_call:G},warnings:[..._,...ge]}}case"object-json":return{args:{...P,response_format:this.supportsStructuredOutputs&&e.schema!=null?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:(w=e.name)!=null?w:"response",description:e.description}}:{type:"json_object"}},warnings:_};case"object-tool":return{args:y?{...P,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...P,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:!!this.supportsStructuredOutputs||void 0}}]},warnings:_};default:throw Error(`Unsupported type: ${M}`)}}async doGenerate(e){var t,s,a,r,o,i,u,c;let{args:d,warnings:p}=this.getArgs(e),{responseHeaders:l,value:f,rawValue:j}=await Ve({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:qe(this.config.headers(),e.headers),body:d,failedResponseHandler:Fe,successfulResponseHandler:ht($s),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:k,...h}=d,m=f.choices[0],g=(t=f.usage)==null?void 0:t.completion_tokens_details,x=(s=f.usage)==null?void 0:s.prompt_tokens_details,w={openai:{}};return g?.reasoning_tokens!=null&&(w.openai.reasoningTokens=g?.reasoning_tokens),g?.accepted_prediction_tokens!=null&&(w.openai.acceptedPredictionTokens=g?.accepted_prediction_tokens),g?.rejected_prediction_tokens!=null&&(w.openai.rejectedPredictionTokens=g?.rejected_prediction_tokens),x?.cached_tokens!=null&&(w.openai.cachedPromptTokens=x?.cached_tokens),{text:(a=m.message.content)!=null?a:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&m.message.function_call?[{toolCallType:"function",toolCallId:rt(),toolName:m.message.function_call.name,args:m.message.function_call.arguments}]:(r=m.message.tool_calls)==null?void 0:r.map(v=>{var I;return{toolCallType:"function",toolCallId:(I=v.id)!=null?I:rt(),toolName:v.function.name,args:v.function.arguments}}),finishReason:Bt(m.finish_reason),usage:{promptTokens:(i=(o=f.usage)==null?void 0:o.prompt_tokens)!=null?i:NaN,completionTokens:(c=(u=f.usage)==null?void 0:u.completion_tokens)!=null?c:NaN},rawCall:{rawPrompt:k,rawSettings:h},rawResponse:{headers:l,body:j},request:{body:JSON.stringify(d)},response:Vt(f),warnings:p,logprobs:Qa(m.logprobs),providerMetadata:w}}async doStream(e){let t;if(this.settings.simulateStreaming){let h=await this.doGenerate(e);return{stream:new ReadableStream({start(m){if(m.enqueue({type:"response-metadata",...h.response}),h.text&&m.enqueue({type:"text-delta",textDelta:h.text}),h.toolCalls)for(let g of h.toolCalls)m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:g.toolCallId,toolName:g.toolName,argsTextDelta:g.args}),m.enqueue({type:"tool-call",...g});m.enqueue({type:"finish",finishReason:h.finishReason,usage:h.usage,logprobs:h.logprobs,providerMetadata:h.providerMetadata}),m.close()}}),rawCall:h.rawCall,rawResponse:h.rawResponse,warnings:h.warnings}}let{args:s,warnings:a}=this.getArgs(e),r={...s,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:o,value:i}=await Ve({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:qe(this.config.headers(),e.headers),body:r,failedResponseHandler:Fe,successfulResponseHandler:na(Ds),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:u,...c}=s,d=[],p="unknown",l={promptTokens:void 0,completionTokens:void 0},f=!0,{useLegacyFunctionCalling:j}=this.settings,k={openai:{}};return{stream:i.pipeThrough(new TransformStream({transform(h,m){var g,x,w,v,I,T,M,_,y,$,A,P;if(!h.success){p="error",m.enqueue({type:"error",error:h.error});return}let J=h.value;if("error"in J){p="error",m.enqueue({type:"error",error:J.error});return}if(f&&(f=!1,m.enqueue({type:"response-metadata",...Vt(J)})),J.usage!=null){let{prompt_tokens:V,completion_tokens:z,prompt_tokens_details:U,completion_tokens_details:Z}=J.usage;l={promptTokens:V??void 0,completionTokens:z??void 0},Z?.reasoning_tokens!=null&&(k.openai.reasoningTokens=Z?.reasoning_tokens),Z?.accepted_prediction_tokens!=null&&(k.openai.acceptedPredictionTokens=Z?.accepted_prediction_tokens),Z?.rejected_prediction_tokens!=null&&(k.openai.rejectedPredictionTokens=Z?.rejected_prediction_tokens),U?.cached_tokens!=null&&(k.openai.cachedPromptTokens=U?.cached_tokens)}let N=J.choices[0];if(N?.finish_reason!=null&&(p=Bt(N.finish_reason)),N?.delta==null)return;let W=N.delta;W.content!=null&&m.enqueue({type:"text-delta",textDelta:W.content});let G=Qa(N?.logprobs);G?.length&&(t===void 0&&(t=[]),t.push(...G));let ge=j&&W.function_call!=null?[{type:"function",id:rt(),function:W.function_call,index:0}]:W.tool_calls;if(ge!=null)for(let V of ge){let z=V.index;if(d[z]==null){if(V.type!=="function")throw new Qt({data:V,message:"Expected 'function' type."});if(V.id==null)throw new Qt({data:V,message:"Expected 'id' to be a string."});if(((g=V.function)==null?void 0:g.name)==null)throw new Qt({data:V,message:"Expected 'function.name' to be a string."});d[z]={id:V.id,type:"function",function:{name:V.function.name,arguments:(x=V.function.arguments)!=null?x:""},hasFinished:!1};let Z=d[z];((w=Z.function)==null?void 0:w.name)!=null&&((v=Z.function)==null?void 0:v.arguments)!=null&&(Z.function.arguments.length>0&&m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:Z.id,toolName:Z.function.name,argsTextDelta:Z.function.arguments}),Ga(Z.function.arguments)&&(m.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(I=Z.id)!=null?I:rt(),toolName:Z.function.name,args:Z.function.arguments}),Z.hasFinished=!0));continue}let U=d[z];!U.hasFinished&&(((T=V.function)==null?void 0:T.arguments)!=null&&(U.function.arguments+=(_=(M=V.function)==null?void 0:M.arguments)!=null?_:""),m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:U.id,toolName:U.function.name,argsTextDelta:(y=V.function.arguments)!=null?y:""}),(($=U.function)==null?void 0:$.name)!=null&&((A=U.function)==null?void 0:A.arguments)!=null&&Ga(U.function.arguments)&&(m.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(P=U.id)!=null?P:rt(),toolName:U.function.name,args:U.function.arguments}),U.hasFinished=!0))}},flush(h){var m,g;h.enqueue({type:"finish",finishReason:p,logprobs:t,usage:{promptTokens:(m=l.promptTokens)!=null?m:NaN,completionTokens:(g=l.completionTokens)!=null?g:NaN},...k!=null?{providerMetadata:k}:{}})}})),rawCall:{rawPrompt:u,rawSettings:c},rawResponse:{headers:o},request:{body:JSON.stringify(r)},warnings:a}}},en=n.Ik({prompt_tokens:n.ai().nullish(),completion_tokens:n.ai().nullish(),prompt_tokens_details:n.Ik({cached_tokens:n.ai().nullish()}).nullish(),completion_tokens_details:n.Ik({reasoning_tokens:n.ai().nullish(),accepted_prediction_tokens:n.ai().nullish(),rejected_prediction_tokens:n.ai().nullish()}).nullish()}).nullish(),$s=n.Ik({id:n.Yj().nullish(),created:n.ai().nullish(),model:n.Yj().nullish(),choices:n.YO(n.Ik({message:n.Ik({role:n.eu("assistant").nullish(),content:n.Yj().nullish(),function_call:n.Ik({arguments:n.Yj(),name:n.Yj()}).nullish(),tool_calls:n.YO(n.Ik({id:n.Yj().nullish(),type:n.eu("function"),function:n.Ik({name:n.Yj(),arguments:n.Yj()})})).nullish()}),index:n.ai(),logprobs:n.Ik({content:n.YO(n.Ik({token:n.Yj(),logprob:n.ai(),top_logprobs:n.YO(n.Ik({token:n.Yj(),logprob:n.ai()}))})).nullable()}).nullish(),finish_reason:n.Yj().nullish()})),usage:en}),Ds=n.KC([n.Ik({id:n.Yj().nullish(),created:n.ai().nullish(),model:n.Yj().nullish(),choices:n.YO(n.Ik({delta:n.Ik({role:n.k5(["assistant"]).nullish(),content:n.Yj().nullish(),function_call:n.Ik({name:n.Yj().optional(),arguments:n.Yj().optional()}).nullish(),tool_calls:n.YO(n.Ik({index:n.ai(),id:n.Yj().nullish(),type:n.eu("function").nullish(),function:n.Ik({name:n.Yj().nullish(),arguments:n.Yj().nullish()})})).nullish()}).nullish(),logprobs:n.Ik({content:n.YO(n.Ik({token:n.Yj(),logprob:n.ai(),top_logprobs:n.YO(n.Ik({token:n.Yj(),logprob:n.ai()}))})).nullable()}).nullish(),finish_reason:n.Yj().nullish(),index:n.ai()})),usage:en}),sa]);function ra(e){return e.startsWith("o")}var Us={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function tn(e){return e?.tokens.map((t,s)=>({token:t,logprob:e.token_logprobs[s],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[s]).map(([a,r])=>({token:a,logprob:r})):[]}))}var qs=class{constructor(e,t,s){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=s}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:s,maxTokens:a,temperature:r,topP:o,topK:i,frequencyPenalty:u,presencePenalty:c,stopSequences:d,responseFormat:p,seed:l}){var f;let j=e.type,k=[];i!=null&&k.push({type:"unsupported-setting",setting:"topK"}),p!=null&&p.type!=="text"&&k.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:h,stopSequences:m}=function({prompt:w,inputFormat:v,user:I="user",assistant:T="assistant"}){if(v==="prompt"&&w.length===1&&w[0].role==="user"&&w[0].content.length===1&&w[0].content[0].type==="text")return{prompt:w[0].content[0].text};let M="";for(let{role:_,content:y}of(w[0].role==="system"&&(M+=`${w[0].content}

`,w=w.slice(1)),w))switch(_){case"system":throw new ze({message:"Unexpected system message in prompt: ${content}",prompt:w});case"user":{let $=y.map(A=>{switch(A.type){case"text":return A.text;case"image":throw new fe({functionality:"images"})}}).join("");M+=`${I}:
${$}

`;break}case"assistant":{let $=y.map(A=>{switch(A.type){case"text":return A.text;case"tool-call":throw new fe({functionality:"tool-call messages"})}}).join("");M+=`${T}:
${$}

`;break}case"tool":throw new fe({functionality:"tool messages"});default:throw Error(`Unsupported role: ${_}`)}return{prompt:M+=`${T}:
`,stopSequences:[`
${I}:`]}}({prompt:s,inputFormat:t}),g=[...m??[],...d??[]],x={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:a,temperature:r,top_p:o,frequency_penalty:u,presence_penalty:c,seed:l,prompt:h,stop:g.length>0?g:void 0};switch(j){case"regular":if((f=e.tools)!=null&&f.length)throw new fe({functionality:"tools"});if(e.toolChoice)throw new fe({functionality:"toolChoice"});return{args:x,warnings:k};case"object-json":throw new fe({functionality:"object-json mode"});case"object-tool":throw new fe({functionality:"object-tool mode"});default:throw Error(`Unsupported type: ${j}`)}}async doGenerate(e){let{args:t,warnings:s}=this.getArgs(e),{responseHeaders:a,value:r,rawValue:o}=await Ve({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:qe(this.config.headers(),e.headers),body:t,failedResponseHandler:Fe,successfulResponseHandler:ht(Fs),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:i,...u}=t,c=r.choices[0];return{text:c.text,usage:{promptTokens:r.usage.prompt_tokens,completionTokens:r.usage.completion_tokens},finishReason:Bt(c.finish_reason),logprobs:tn(c.logprobs),rawCall:{rawPrompt:i,rawSettings:u},rawResponse:{headers:a,body:o},response:Vt(r),warnings:s,request:{body:JSON.stringify(t)}}}async doStream(e){let t,{args:s,warnings:a}=this.getArgs(e),r={...s,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:o,value:i}=await Ve({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:qe(this.config.headers(),e.headers),body:r,failedResponseHandler:Fe,successfulResponseHandler:na(Ls),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:u,...c}=s,d="unknown",p={promptTokens:Number.NaN,completionTokens:Number.NaN},l=!0;return{stream:i.pipeThrough(new TransformStream({transform(f,j){if(!f.success){d="error",j.enqueue({type:"error",error:f.error});return}let k=f.value;if("error"in k){d="error",j.enqueue({type:"error",error:k.error});return}l&&(l=!1,j.enqueue({type:"response-metadata",...Vt(k)})),k.usage!=null&&(p={promptTokens:k.usage.prompt_tokens,completionTokens:k.usage.completion_tokens});let h=k.choices[0];h?.finish_reason!=null&&(d=Bt(h.finish_reason)),h?.text!=null&&j.enqueue({type:"text-delta",textDelta:h.text});let m=tn(h?.logprobs);m?.length&&(t===void 0&&(t=[]),t.push(...m))},flush(f){f.enqueue({type:"finish",finishReason:d,logprobs:t,usage:p})}})),rawCall:{rawPrompt:u,rawSettings:c},rawResponse:{headers:o},warnings:a,request:{body:JSON.stringify(r)}}}},Fs=n.Ik({id:n.Yj().nullish(),created:n.ai().nullish(),model:n.Yj().nullish(),choices:n.YO(n.Ik({text:n.Yj(),finish_reason:n.Yj(),logprobs:n.Ik({tokens:n.YO(n.Yj()),token_logprobs:n.YO(n.ai()),top_logprobs:n.YO(n.g1(n.Yj(),n.ai())).nullable()}).nullish()})),usage:n.Ik({prompt_tokens:n.ai(),completion_tokens:n.ai()})}),Ls=n.KC([n.Ik({id:n.Yj().nullish(),created:n.ai().nullish(),model:n.Yj().nullish(),choices:n.YO(n.Ik({text:n.Yj(),finish_reason:n.Yj().nullish(),index:n.ai(),logprobs:n.Ik({tokens:n.YO(n.Yj()),token_logprobs:n.YO(n.ai()),top_logprobs:n.YO(n.g1(n.Yj(),n.ai())).nullable()}).nullish()})),usage:n.Ik({prompt_tokens:n.ai(),completion_tokens:n.ai()}).nullish()}),sa]),Zs=class{constructor(e,t,s){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=s}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.settings.maxEmbeddingsPerCall)!=null?e:2048}get supportsParallelCalls(){var e;return(e=this.settings.supportsParallelCalls)==null||e}async doEmbed({values:e,headers:t,abortSignal:s}){if(e.length>this.maxEmbeddingsPerCall)throw new Es({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:a,value:r}=await Ve({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:qe(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:Fe,successfulResponseHandler:ht(zs),abortSignal:s,fetch:this.config.fetch});return{embeddings:r.data.map(o=>o.embedding),usage:r.usage?{tokens:r.usage.prompt_tokens}:void 0,rawResponse:{headers:a}}}},zs=n.Ik({data:n.YO(n.Ik({embedding:n.YO(n.ai())})),usage:n.Ik({prompt_tokens:n.ai()}).nullish()}),Bs={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},Vs=new Set(["gpt-image-1"]),Ks=class{constructor(e,t,s){this.modelId=e,this.settings=t,this.config=s,this.specificationVersion="v1"}get maxImagesPerCall(){var e,t;return(t=(e=this.settings.maxImagesPerCall)!=null?e:Bs[this.modelId])!=null?t:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:s,aspectRatio:a,seed:r,providerOptions:o,headers:i,abortSignal:u}){var c,d,p,l;let f=[];a!=null&&f.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),r!=null&&f.push({type:"unsupported-setting",setting:"seed"});let j=(p=(d=(c=this.config._internal)==null?void 0:c.currentDate)==null?void 0:d.call(c))!=null?p:new Date,{value:k,responseHeaders:h}=await Ve({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:qe(this.config.headers(),i),body:{model:this.modelId,prompt:e,n:t,size:s,...(l=o.openai)!=null?l:{},...Vs.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:Fe,successfulResponseHandler:ht(Hs),abortSignal:u,fetch:this.config.fetch});return{images:k.data.map(m=>m.b64_json),warnings:f,response:{timestamp:j,modelId:this.modelId,headers:h}}}},Hs=n.Ik({data:n.YO(n.Ik({b64_json:n.Yj()}))}),Js=n.Ik({include:n.YO(n.Yj()).nullish(),language:n.Yj().nullish(),prompt:n.Yj().nullish(),temperature:n.ai().min(0).max(1).nullish().default(0),timestampGranularities:n.YO(n.k5(["word","segment"])).nullish().default(["segment"])}),an={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},Ws=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({audio:e,mediaType:t,providerOptions:s}){var a,r,o,i,u;let c=aa({provider:"openai",providerOptions:s,schema:Js}),d=new FormData,p=e instanceof Uint8Array?new Blob([e]):new Blob([zt(e)]);if(d.append("model",this.modelId),d.append("file",new File([p],"audio",{type:t})),c){let l={include:(a=c.include)!=null?a:void 0,language:(r=c.language)!=null?r:void 0,prompt:(o=c.prompt)!=null?o:void 0,temperature:(i=c.temperature)!=null?i:void 0,timestamp_granularities:(u=c.timestampGranularities)!=null?u:void 0};for(let f in l){let j=l[f];j!==void 0&&d.append(f,String(j))}}return{formData:d,warnings:[]}}async doGenerate(e){var t,s,a,r,o,i;let u=(a=(s=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:s.call(t))!=null?a:new Date,{formData:c,warnings:d}=this.getArgs(e),{value:p,responseHeaders:l,rawValue:f}=await Os({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:qe(this.config.headers(),e.headers),formData:c,failedResponseHandler:Fe,successfulResponseHandler:ht(Gs),abortSignal:e.abortSignal,fetch:this.config.fetch}),j=p.language!=null&&p.language in an?an[p.language]:void 0;return{text:p.text,segments:(o=(r=p.words)==null?void 0:r.map(k=>({text:k.word,startSecond:k.start,endSecond:k.end})))!=null?o:[],language:j,durationInSeconds:(i=p.duration)!=null?i:void 0,warnings:d,response:{timestamp:u,modelId:this.modelId,headers:l,body:f}}}},Gs=n.Ik({text:n.Yj(),language:n.Yj().nullish(),duration:n.ai().nullish(),words:n.YO(n.Ik({word:n.Yj(),start:n.ai(),end:n.ai()})).nullish()});function nn({finishReason:e,hasToolCalls:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}var Xs=class{constructor(e,t){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsStructuredOutputs=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}getArgs({mode:e,maxTokens:t,temperature:s,stopSequences:a,topP:r,topK:o,presencePenalty:i,frequencyPenalty:u,seed:c,prompt:d,providerMetadata:p,responseFormat:l}){var f,j,k,h;let m=[],g=(h=this.modelId).startsWith("o")?h.startsWith("o1-mini")||h.startsWith("o1-preview")?{isReasoningModel:!0,systemMessageMode:"remove",requiredAutoTruncation:!1}:{isReasoningModel:!0,systemMessageMode:"developer",requiredAutoTruncation:!1}:{isReasoningModel:!1,systemMessageMode:"system",requiredAutoTruncation:!1},x=e.type;o!=null&&m.push({type:"unsupported-setting",setting:"topK"}),c!=null&&m.push({type:"unsupported-setting",setting:"seed"}),i!=null&&m.push({type:"unsupported-setting",setting:"presencePenalty"}),u!=null&&m.push({type:"unsupported-setting",setting:"frequencyPenalty"}),a!=null&&m.push({type:"unsupported-setting",setting:"stopSequences"});let{messages:w,warnings:v}=function({prompt:_,systemMessageMode:y}){let $=[],A=[];for(let{role:P,content:J}of _)switch(P){case"system":switch(y){case"system":$.push({role:"system",content:J});break;case"developer":$.push({role:"developer",content:J});break;case"remove":A.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${y}`)}break;case"user":$.push({role:"user",content:J.map((N,W)=>{var G,ge,V,z;switch(N.type){case"text":return{type:"input_text",text:N.text};case"image":return{type:"input_image",image_url:N.image instanceof URL?N.image.toString():`data:${(G=N.mimeType)!=null?G:"image/jpeg"};base64,${xt(N.image)}`,detail:(V=(ge=N.providerMetadata)==null?void 0:ge.openai)==null?void 0:V.imageDetail};case"file":if(N.data instanceof URL)throw new fe({functionality:"File URLs in user messages"});if(N.mimeType==="application/pdf")return{type:"input_file",filename:(z=N.filename)!=null?z:`part-${W}.pdf`,file_data:`data:application/pdf;base64,${N.data}`};throw new fe({functionality:"Only PDF files are supported in user messages"})}})});break;case"assistant":for(let N of J)switch(N.type){case"text":$.push({role:"assistant",content:[{type:"output_text",text:N.text}]});break;case"tool-call":$.push({type:"function_call",call_id:N.toolCallId,name:N.toolName,arguments:JSON.stringify(N.args)})}break;case"tool":for(let N of J)$.push({type:"function_call_output",call_id:N.toolCallId,output:JSON.stringify(N.result)});break;default:throw Error(`Unsupported role: ${P}`)}return{messages:$,warnings:A}}({prompt:d,systemMessageMode:g.systemMessageMode});m.push(...v);let I=aa({provider:"openai",providerOptions:p,schema:lr}),T=(f=I?.strictSchemas)==null||f,M={model:this.modelId,input:w,temperature:s,top_p:r,max_output_tokens:t,...l?.type==="json"&&{text:{format:l.schema!=null?{type:"json_schema",strict:T,name:(j=l.name)!=null?j:"response",description:l.description,schema:l.schema}:{type:"json_object"}}},metadata:I?.metadata,parallel_tool_calls:I?.parallelToolCalls,previous_response_id:I?.previousResponseId,store:I?.store,user:I?.user,instructions:I?.instructions,...g.isReasoningModel&&(I?.reasoningEffort!=null||I?.reasoningSummary!=null)&&{reasoning:{...I?.reasoningEffort!=null&&{effort:I.reasoningEffort},...I?.reasoningSummary!=null&&{summary:I.reasoningSummary}}},...g.requiredAutoTruncation&&{truncation:"auto"}};switch(g.isReasoningModel&&(M.temperature!=null&&(M.temperature=void 0,m.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),M.top_p!=null&&(M.top_p=void 0,m.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))),x){case"regular":{let{tools:_,tool_choice:y,toolWarnings:$}=function({mode:A,strict:P}){var J;let N=(J=A.tools)!=null&&J.length?A.tools:void 0,W=[];if(N==null)return{tools:void 0,tool_choice:void 0,toolWarnings:W};let G=A.toolChoice,ge=[];for(let z of N)switch(z.type){case"function":ge.push({type:"function",name:z.name,description:z.description,parameters:z.parameters,strict:!!P||void 0});break;case"provider-defined":z.id==="openai.web_search_preview"?ge.push({type:"web_search_preview",search_context_size:z.args.searchContextSize,user_location:z.args.userLocation}):W.push({type:"unsupported-tool",tool:z});break;default:W.push({type:"unsupported-tool",tool:z})}if(G==null)return{tools:ge,tool_choice:void 0,toolWarnings:W};let V=G.type;switch(V){case"auto":case"none":case"required":return{tools:ge,tool_choice:V,toolWarnings:W};case"tool":return G.toolName==="web_search_preview"?{tools:ge,tool_choice:{type:"web_search_preview"},toolWarnings:W}:{tools:ge,tool_choice:{type:"function",name:G.toolName},toolWarnings:W};default:throw new fe({functionality:`Unsupported tool choice type: ${V}`})}}({mode:e,strict:T});return{args:{...M,tools:_,tool_choice:y},warnings:[...m,...$]}}case"object-json":return{args:{...M,text:{format:e.schema!=null?{type:"json_schema",strict:T,name:(k=e.name)!=null?k:"response",description:e.description,schema:e.schema}:{type:"json_object"}}},warnings:m};case"object-tool":return{args:{...M,tool_choice:{type:"function",name:e.tool.name},tools:[{type:"function",name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:T}]},warnings:m};default:throw Error(`Unsupported type: ${x}`)}}async doGenerate(e){var t,s,a,r,o,i,u;let{args:c,warnings:d}=this.getArgs(e),{responseHeaders:p,value:l,rawValue:f}=await Ve({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:qe(this.config.headers(),e.headers),body:c,failedResponseHandler:Fe,successfulResponseHandler:ht(n.Ik({id:n.Yj(),created_at:n.ai(),model:n.Yj(),output:n.YO(n.gM("type",[n.Ik({type:n.eu("message"),role:n.eu("assistant"),content:n.YO(n.Ik({type:n.eu("output_text"),text:n.Yj(),annotations:n.YO(n.Ik({type:n.eu("url_citation"),start_index:n.ai(),end_index:n.ai(),url:n.Yj(),title:n.Yj()}))}))}),n.Ik({type:n.eu("function_call"),call_id:n.Yj(),name:n.Yj(),arguments:n.Yj()}),n.Ik({type:n.eu("web_search_call")}),n.Ik({type:n.eu("computer_call")}),n.Ik({type:n.eu("reasoning"),summary:n.YO(n.Ik({type:n.eu("summary_text"),text:n.Yj()}))})])),incomplete_details:n.Ik({reason:n.Yj()}).nullable(),usage:sn})),abortSignal:e.abortSignal,fetch:this.config.fetch}),j=l.output.filter(m=>m.type==="message").flatMap(m=>m.content).filter(m=>m.type==="output_text"),k=l.output.filter(m=>m.type==="function_call").map(m=>({toolCallType:"function",toolCallId:m.call_id,toolName:m.name,args:m.arguments})),h=(s=(t=l.output.find(m=>m.type==="reasoning"))==null?void 0:t.summary)!=null?s:null;return{text:j.map(m=>m.text).join(`
`),sources:j.flatMap(m=>m.annotations.map(g=>{var x,w,v;return{sourceType:"url",id:(v=(w=(x=this.config).generateId)==null?void 0:w.call(x))!=null?v:rt(),url:g.url,title:g.title}})),finishReason:nn({finishReason:(a=l.incomplete_details)==null?void 0:a.reason,hasToolCalls:k.length>0}),toolCalls:k.length>0?k:void 0,reasoning:h?h.map(m=>({type:"text",text:m.text})):void 0,usage:{promptTokens:l.usage.input_tokens,completionTokens:l.usage.output_tokens},rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:p,body:f},request:{body:JSON.stringify(c)},response:{id:l.id,timestamp:new Date(1e3*l.created_at),modelId:l.model},providerMetadata:{openai:{responseId:l.id,cachedPromptTokens:(o=(r=l.usage.input_tokens_details)==null?void 0:r.cached_tokens)!=null?o:null,reasoningTokens:(u=(i=l.usage.output_tokens_details)==null?void 0:i.reasoning_tokens)!=null?u:null}},warnings:d}}async doStream(e){let{args:t,warnings:s}=this.getArgs(e),{responseHeaders:a,value:r}=await Ve({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:qe(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:Fe,successfulResponseHandler:na(ir),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=this,i="unknown",u=NaN,c=NaN,d=null,p=null,l=null,f={},j=!1;return{stream:r.pipeThrough(new TransformStream({transform(k,h){var m,g,x,w,v,I,T,M,_;if(!k.success){i="error",h.enqueue({type:"error",error:k.error});return}let y=k.value;if(y.type==="response.output_item.added")y.item.type==="function_call"&&(f[y.output_index]={toolName:y.item.name,toolCallId:y.item.call_id},h.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:y.item.call_id,toolName:y.item.name,argsTextDelta:y.item.arguments}));else if(y.type==="response.function_call_arguments.delta"){let $=f[y.output_index];$!=null&&h.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:$.toolCallId,toolName:$.toolName,argsTextDelta:y.delta})}else y.type==="response.created"?(l=y.response.id,h.enqueue({type:"response-metadata",id:y.response.id,timestamp:new Date(1e3*y.response.created_at),modelId:y.response.model})):y.type==="response.output_text.delta"?h.enqueue({type:"text-delta",textDelta:y.delta}):y.type==="response.reasoning_summary_text.delta"?h.enqueue({type:"reasoning",textDelta:y.delta}):y.type==="response.output_item.done"&&y.item.type==="function_call"?(f[y.output_index]=void 0,j=!0,h.enqueue({type:"tool-call",toolCallType:"function",toolCallId:y.item.call_id,toolName:y.item.name,args:y.item.arguments})):(_=y).type==="response.completed"||_.type==="response.incomplete"?(i=nn({finishReason:(m=y.response.incomplete_details)==null?void 0:m.reason,hasToolCalls:j}),u=y.response.usage.input_tokens,c=y.response.usage.output_tokens,d=(x=(g=y.response.usage.input_tokens_details)==null?void 0:g.cached_tokens)!=null?x:d,p=(v=(w=y.response.usage.output_tokens_details)==null?void 0:w.reasoning_tokens)!=null?v:p):y.type==="response.output_text.annotation.added"&&h.enqueue({type:"source",source:{sourceType:"url",id:(M=(T=(I=o.config).generateId)==null?void 0:T.call(I))!=null?M:rt(),url:y.annotation.url,title:y.annotation.title}})},flush(k){k.enqueue({type:"finish",finishReason:i,usage:{promptTokens:u,completionTokens:c},...(d!=null||p!=null)&&{providerMetadata:{openai:{responseId:l,cachedPromptTokens:d,reasoningTokens:p}}}})}})),rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:a},request:{body:JSON.stringify(t)},warnings:s}}},sn=n.Ik({input_tokens:n.ai(),input_tokens_details:n.Ik({cached_tokens:n.ai().nullish()}).nullish(),output_tokens:n.ai(),output_tokens_details:n.Ik({reasoning_tokens:n.ai().nullish()}).nullish()}),Qs=n.Ik({type:n.eu("response.output_text.delta"),delta:n.Yj()}),er=n.Ik({type:n.k5(["response.completed","response.incomplete"]),response:n.Ik({incomplete_details:n.Ik({reason:n.Yj()}).nullish(),usage:sn})}),tr=n.Ik({type:n.eu("response.created"),response:n.Ik({id:n.Yj(),created_at:n.ai(),model:n.Yj()})}),ar=n.Ik({type:n.eu("response.output_item.done"),output_index:n.ai(),item:n.gM("type",[n.Ik({type:n.eu("message")}),n.Ik({type:n.eu("function_call"),id:n.Yj(),call_id:n.Yj(),name:n.Yj(),arguments:n.Yj(),status:n.eu("completed")})])}),nr=n.Ik({type:n.eu("response.function_call_arguments.delta"),item_id:n.Yj(),output_index:n.ai(),delta:n.Yj()}),sr=n.Ik({type:n.eu("response.output_item.added"),output_index:n.ai(),item:n.gM("type",[n.Ik({type:n.eu("message")}),n.Ik({type:n.eu("function_call"),id:n.Yj(),call_id:n.Yj(),name:n.Yj(),arguments:n.Yj()})])}),rr=n.Ik({type:n.eu("response.output_text.annotation.added"),annotation:n.Ik({type:n.eu("url_citation"),url:n.Yj(),title:n.Yj()})}),or=n.Ik({type:n.eu("response.reasoning_summary_text.delta"),item_id:n.Yj(),output_index:n.ai(),summary_index:n.ai(),delta:n.Yj()}),ir=n.KC([Qs,er,tr,ar,nr,sr,rr,or,n.Ik({type:n.Yj()}).passthrough()]),lr=n.Ik({metadata:n.bz().nullish(),parallelToolCalls:n.zM().nullish(),previousResponseId:n.Yj().nullish(),store:n.zM().nullish(),user:n.Yj().nullish(),reasoningEffort:n.Yj().nullish(),strictSchemas:n.zM().nullish(),instructions:n.Yj().nullish(),reasoningSummary:n.Yj().nullish()}),ur=n.Ik({}),cr={webSearchPreview:function({searchContextSize:e,userLocation:t}={}){return{type:"provider-defined",id:"openai.web_search_preview",args:{searchContextSize:e,userLocation:t},parameters:ur}}},pr=n.Ik({instructions:n.Yj().nullish(),speed:n.ai().min(.25).max(4).default(1).nullish()}),dr=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({text:e,voice:t="alloy",outputFormat:s="mp3",speed:a,instructions:r,providerOptions:o}){let i=[],u=aa({provider:"openai",providerOptions:o,schema:pr}),c={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:a,instructions:r};if(s&&(["mp3","opus","aac","flac","wav","pcm"].includes(s)?c.response_format=s:i.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${s}. Using mp3 instead.`})),u){let d={};for(let p in d){let l=d[p];l!==void 0&&(c[p]=l)}}return{requestBody:c,warnings:i}}async doGenerate(e){var t,s,a;let r=(a=(s=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:s.call(t))!=null?a:new Date,{requestBody:o,warnings:i}=this.getArgs(e),{value:u,responseHeaders:c,rawValue:d}=await Ve({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:qe(this.config.headers(),e.headers),body:o,failedResponseHandler:Fe,successfulResponseHandler:Cs(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:u,warnings:i,request:{body:JSON.stringify(o)},response:{timestamp:r,modelId:this.modelId,headers:c,body:d}}}};function rn(e={}){var t,s,a,r;let o=(t=(r=e.baseURL)==null?void 0:r.replace(/\/$/,""))!=null?t:"https://api.openai.com/v1",i=(s=e.compatibility)!=null?s:"compatible",u=(a=e.name)!=null?a:"openai",c=()=>({Authorization:`Bearer ${function({apiKey:g,environmentVariableName:x,apiKeyParameterName:w="apiKey",description:v}){if(typeof g=="string")return g;if(g!=null)throw new qt({message:`${v} API key must be a string.`});if(typeof process>"u")throw new qt({message:`${v} API key is missing. Pass it using the '${w}' parameter. Environment variables is not supported in this environment.`});if((g=process.env[x])==null)throw new qt({message:`${v} API key is missing. Pass it using the '${w}' parameter or the ${x} environment variable.`});if(typeof g!="string")throw new qt({message:`${v} API key must be a string. The value of the ${x} environment variable is not a string.`});return g}({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),d=(g,x={})=>new Ys(g,x,{provider:`${u}.chat`,url:({path:w})=>`${o}${w}`,headers:c,compatibility:i,fetch:e.fetch}),p=(g,x={})=>new qs(g,x,{provider:`${u}.completion`,url:({path:w})=>`${o}${w}`,headers:c,compatibility:i,fetch:e.fetch}),l=(g,x={})=>new Zs(g,x,{provider:`${u}.embedding`,url:({path:w})=>`${o}${w}`,headers:c,fetch:e.fetch}),f=(g,x={})=>new Ks(g,x,{provider:`${u}.image`,url:({path:w})=>`${o}${w}`,headers:c,fetch:e.fetch}),j=g=>new Ws(g,{provider:`${u}.transcription`,url:({path:x})=>`${o}${x}`,headers:c,fetch:e.fetch}),k=g=>new dr(g,{provider:`${u}.speech`,url:({path:x})=>`${o}${x}`,headers:c,fetch:e.fetch}),h=(g,x)=>{if(new.target)throw Error("The OpenAI model function cannot be called with the new keyword.");return g==="gpt-3.5-turbo-instruct"?p(g,x):d(g,x)},m=function(g,x){return h(g,x)};return m.languageModel=h,m.chat=d,m.completion=p,m.responses=g=>new Xs(g,{provider:`${u}.responses`,url:({path:x})=>`${o}${x}`,headers:c,fetch:e.fetch}),m.embedding=l,m.textEmbedding=l,m.textEmbeddingModel=l,m.image=f,m.imageModel=f,m.transcription=j,m.transcriptionModel=j,m.speech=k,m.speechModel=k,m.tools=cr,m}var mr=rn({compatibility:"strict"}),hr=S(61480),on=S(69079);let fr=Symbol("Let zodToJsonSchema decide on which parser to use"),ln={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},gr=e=>typeof e=="string"?{...ln,name:e}:{...ln,...e},_r=e=>{let t=gr(e),s=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:s,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([a,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,a],jsonSchema:void 0}]))}};function un(e,t,s,a){a?.errorMessages&&s&&(e.errorMessage={...e.errorMessage,[t]:s})}function ae(e,t,s,a,r){e[t]=s,un(e,t,a,r)}function cn(e,t){return X(e.type._def,t)}let yr=(e,t)=>X(e.innerType._def,t),kr=(e,t)=>{let s={type:"integer",format:"unix-time"};if(t.target==="openApi3")return s;for(let a of e.checks)switch(a.kind){case"min":ae(s,"minimum",a.value,a.message,t);break;case"max":ae(s,"maximum",a.value,a.message,t)}return s},vr=e=>(!("type"in e)||e.type!=="string")&&"allOf"in e,De={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(O===void 0&&(O=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),O),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function pn(e,t){let s={type:"string"};if(e.checks)for(let a of e.checks)switch(a.kind){case"min":ae(s,"minLength",typeof s.minLength=="number"?Math.max(s.minLength,a.value):a.value,a.message,t);break;case"max":ae(s,"maxLength",typeof s.maxLength=="number"?Math.min(s.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":Ue(s,"email",a.message,t);break;case"format:idn-email":Ue(s,"idn-email",a.message,t);break;case"pattern:zod":Te(s,De.email,a.message,t)}break;case"url":Ue(s,"uri",a.message,t);break;case"uuid":Ue(s,"uuid",a.message,t);break;case"regex":Te(s,a.regex,a.message,t);break;case"cuid":Te(s,De.cuid,a.message,t);break;case"cuid2":Te(s,De.cuid2,a.message,t);break;case"startsWith":Te(s,RegExp(`^${oa(a.value,t)}`),a.message,t);break;case"endsWith":Te(s,RegExp(`${oa(a.value,t)}$`),a.message,t);break;case"datetime":Ue(s,"date-time",a.message,t);break;case"date":Ue(s,"date",a.message,t);break;case"time":Ue(s,"time",a.message,t);break;case"duration":Ue(s,"duration",a.message,t);break;case"length":ae(s,"minLength",typeof s.minLength=="number"?Math.max(s.minLength,a.value):a.value,a.message,t),ae(s,"maxLength",typeof s.maxLength=="number"?Math.min(s.maxLength,a.value):a.value,a.message,t);break;case"includes":Te(s,RegExp(oa(a.value,t)),a.message,t);break;case"ip":a.version!=="v6"&&Ue(s,"ipv4",a.message,t),a.version!=="v4"&&Ue(s,"ipv6",a.message,t);break;case"base64url":Te(s,De.base64url,a.message,t);break;case"jwt":Te(s,De.jwt,a.message,t);break;case"cidr":a.version!=="v6"&&Te(s,De.ipv4Cidr,a.message,t),a.version!=="v4"&&Te(s,De.ipv6Cidr,a.message,t);break;case"emoji":Te(s,De.emoji(),a.message,t);break;case"ulid":Te(s,De.ulid,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":Ue(s,"binary",a.message,t);break;case"contentEncoding:base64":ae(s,"contentEncoding","base64",a.message,t);break;case"pattern:zod":Te(s,De.base64,a.message,t)}break;case"nanoid":Te(s,De.nanoid,a.message,t)}return s}function oa(e,t){return t.patternStrategy==="escape"?function(s){let a="";for(let r=0;r<s.length;r++)br.has(s[r])||(a+="\\"),a+=s[r];return a}(e):e}let br=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Ue(e,t,s,a){e.format||e.anyOf?.some(r=>r.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...s&&a.errorMessages&&{errorMessage:{format:s}}})):ae(e,"format",t,s,a)}function Te(e,t,s,a){e.pattern||e.allOf?.some(r=>r.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:dn(t,a),...s&&a.errorMessages&&{errorMessage:{pattern:s}}})):ae(e,"pattern",dn(t,a),s,a)}function dn(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let s={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=s.i?e.source.toLowerCase():e.source,r="",o=!1,i=!1,u=!1;for(let c=0;c<a.length;c++){if(o){r+=a[c],o=!1;continue}if(s.i){if(i){if(a[c].match(/[a-z]/)){u?(r+=a[c],r+=`${a[c-2]}-${a[c]}`.toUpperCase(),u=!1):a[c+1]==="-"&&a[c+2]?.match(/[a-z]/)?(r+=a[c],u=!0):r+=`${a[c]}${a[c].toUpperCase()}`;continue}}else if(a[c].match(/[a-z]/)){r+=`[${a[c]}${a[c].toUpperCase()}]`;continue}}if(s.m){if(a[c]==="^"){r+=`(^|(?<=[\r
]))`;continue}else if(a[c]==="$"){r+=`($|(?=[\r
]))`;continue}}if(s.s&&a[c]==="."){r+=i?`${a[c]}\r
`:`[${a[c]}\r
]`;continue}r+=a[c],a[c]==="\\"?o=!0:i&&a[c]==="]"?i=!1:i||a[c]!=="["||(i=!0)}try{new RegExp(r)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return r}function mn(e,t){if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&e.keyType?._def.typeName===n.kY.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((a,r)=>({...a,[r]:X(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",r]})??{}}),{}),additionalProperties:!1};let s={type:"object",additionalProperties:X(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if(t.target==="openApi3")return s;if(e.keyType?._def.typeName===n.kY.ZodString&&e.keyType._def.checks?.length){let{type:a,...r}=pn(e.keyType._def,t);return{...s,propertyNames:r}}if(e.keyType?._def.typeName===n.kY.ZodEnum)return{...s,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===n.kY.ZodBranded&&e.keyType._def.type._def.typeName===n.kY.ZodString&&e.keyType._def.type._def.checks?.length){let{type:a,...r}=cn(e.keyType._def,t);return{...s,propertyNames:r}}return s}let Kt={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},hn=(e,t)=>{let s=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((a,r)=>X(a._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(a=>!!a&&(!t.strictUnions||typeof a=="object"&&Object.keys(a).length>0));return s.length?{anyOf:s}:void 0},wr=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return X(e.innerType._def,t);let s=X(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return s?{anyOf:[{not:{}},s]}:{}},xr=(e,t)=>{if(t.pipeStrategy==="input")return X(e.in._def,t);if(t.pipeStrategy==="output")return X(e.out._def,t);let s=X(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=X(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",s?"1":"0"]});return{allOf:[s,a].filter(r=>r!==void 0)}},Ir=(e,t)=>X(e.innerType._def,t);function X(e,t,s=!1){let a=t.seen.get(e);if(t.override){let i=t.override?.(e,t,a,s);if(i!==fr)return i}if(a&&!s){let i=jr(a,t);if(i!==void 0)return i}let r={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,r);let o=Sr(e,e.typeName,t);return o&&Tr(e,t,o),r.jsonSchema=o,o}let jr=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Er(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((s,a)=>t.currentPath[a]===s)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):t.$refStrategy==="seen"?{}:void 0}},Er=(e,t)=>{let s=0;for(;s<e.length&&s<t.length&&e[s]===t[s];s++);return[(e.length-s).toString(),...t.slice(s)].join("/")},Sr=(e,t,s)=>{switch(t){case n.kY.ZodString:return pn(e,s);case n.kY.ZodNumber:return function(a,r){let o={type:"number"};if(!a.checks)return o;for(let i of a.checks)switch(i.kind){case"int":o.type="integer",un(o,"type",i.message,r);break;case"min":r.target==="jsonSchema7"?i.inclusive?ae(o,"minimum",i.value,i.message,r):ae(o,"exclusiveMinimum",i.value,i.message,r):(i.inclusive||(o.exclusiveMinimum=!0),ae(o,"minimum",i.value,i.message,r));break;case"max":r.target==="jsonSchema7"?i.inclusive?ae(o,"maximum",i.value,i.message,r):ae(o,"exclusiveMaximum",i.value,i.message,r):(i.inclusive||(o.exclusiveMaximum=!0),ae(o,"maximum",i.value,i.message,r));break;case"multipleOf":ae(o,"multipleOf",i.value,i.message,r)}return o}(e,s);case n.kY.ZodObject:return function(a,r){let o=r.target==="openAi",i={type:"object",...Object.entries(a.shape()).reduce((u,[c,d])=>{if(d===void 0||d._def===void 0)return u;let p=d.isOptional();p&&o&&(d instanceof n.Ii&&(d=d._def.innerType),d.isNullable()||(d=d.nullable()),p=!1);let l=X(d._def,{...r,currentPath:[...r.currentPath,"properties",c],propertyPath:[...r.currentPath,"properties",c]});return l===void 0?u:{properties:{...u.properties,[c]:l},required:p?u.required:[...u.required,c]}},{properties:{},required:[]}),additionalProperties:r.removeAdditionalStrategy==="strict"?a.catchall._def.typeName==="ZodNever"?a.unknownKeys!=="strict":X(a.catchall._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]})??!0:a.catchall._def.typeName==="ZodNever"?a.unknownKeys==="passthrough":X(a.catchall._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]})??!0};return i.required.length||delete i.required,i}(e,s);case n.kY.ZodBigInt:return function(a,r){let o={type:"integer",format:"int64"};if(!a.checks)return o;for(let i of a.checks)switch(i.kind){case"min":r.target==="jsonSchema7"?i.inclusive?ae(o,"minimum",i.value,i.message,r):ae(o,"exclusiveMinimum",i.value,i.message,r):(i.inclusive||(o.exclusiveMinimum=!0),ae(o,"minimum",i.value,i.message,r));break;case"max":r.target==="jsonSchema7"?i.inclusive?ae(o,"maximum",i.value,i.message,r):ae(o,"exclusiveMaximum",i.value,i.message,r):(i.inclusive||(o.exclusiveMaximum=!0),ae(o,"maximum",i.value,i.message,r));break;case"multipleOf":ae(o,"multipleOf",i.value,i.message,r)}return o}(e,s);case n.kY.ZodBoolean:return{type:"boolean"};case n.kY.ZodDate:return function a(r,o,i){let u=i??o.dateStrategy;if(Array.isArray(u))return{anyOf:u.map((c,d)=>a(r,o,c))};switch(u){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return kr(r,o)}}(e,s);case n.kY.ZodUndefined:return{not:{}};case n.kY.ZodNull:return s.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"};case n.kY.ZodArray:return function(a,r){let o={type:"array"};return a.type?._def&&a.type?._def?.typeName!==n.kY.ZodAny&&(o.items=X(a.type._def,{...r,currentPath:[...r.currentPath,"items"]})),a.minLength&&ae(o,"minItems",a.minLength.value,a.minLength.message,r),a.maxLength&&ae(o,"maxItems",a.maxLength.value,a.maxLength.message,r),a.exactLength&&(ae(o,"minItems",a.exactLength.value,a.exactLength.message,r),ae(o,"maxItems",a.exactLength.value,a.exactLength.message,r)),o}(e,s);case n.kY.ZodUnion:case n.kY.ZodDiscriminatedUnion:return function(a,r){if(r.target==="openApi3")return hn(a,r);let o=a.options instanceof Map?Array.from(a.options.values()):a.options;if(o.every(i=>i._def.typeName in Kt&&(!i._def.checks||!i._def.checks.length))){let i=o.reduce((u,c)=>{let d=Kt[c._def.typeName];return d&&!u.includes(d)?[...u,d]:u},[]);return{type:i.length>1?i:i[0]}}if(o.every(i=>i._def.typeName==="ZodLiteral"&&!i.description)){let i=o.reduce((u,c)=>{let d=typeof c._def.value;switch(d){case"string":case"number":case"boolean":return[...u,d];case"bigint":return[...u,"integer"];case"object":if(c._def.value===null)return[...u,"null"];default:return u}},[]);if(i.length===o.length){let u=i.filter((c,d,p)=>p.indexOf(c)===d);return{type:u.length>1?u:u[0],enum:o.reduce((c,d)=>c.includes(d._def.value)?c:[...c,d._def.value],[])}}}else if(o.every(i=>i._def.typeName==="ZodEnum"))return{type:"string",enum:o.reduce((i,u)=>[...i,...u._def.values.filter(c=>!i.includes(c))],[])};return hn(a,r)}(e,s);case n.kY.ZodIntersection:return function(a,r){let o=[X(a.left._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),X(a.right._def,{...r,currentPath:[...r.currentPath,"allOf","1"]})].filter(c=>!!c),i=r.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,u=[];return o.forEach(c=>{if(vr(c))u.push(...c.allOf),c.unevaluatedProperties===void 0&&(i=void 0);else{let d=c;if("additionalProperties"in c&&c.additionalProperties===!1){let{additionalProperties:p,...l}=c;d=l}else i=void 0;u.push(d)}}),u.length?{allOf:u,...i}:void 0}(e,s);case n.kY.ZodTuple:return function(a,r){return a.rest?{type:"array",minItems:a.items.length,items:a.items.map((o,i)=>X(o._def,{...r,currentPath:[...r.currentPath,"items",`${i}`]})).reduce((o,i)=>i===void 0?o:[...o,i],[]),additionalItems:X(a.rest._def,{...r,currentPath:[...r.currentPath,"additionalItems"]})}:{type:"array",minItems:a.items.length,maxItems:a.items.length,items:a.items.map((o,i)=>X(o._def,{...r,currentPath:[...r.currentPath,"items",`${i}`]})).reduce((o,i)=>i===void 0?o:[...o,i],[])}}(e,s);case n.kY.ZodRecord:return mn(e,s);case n.kY.ZodLiteral:return function(a,r){let o=typeof a.value;return o!=="bigint"&&o!=="number"&&o!=="boolean"&&o!=="string"?{type:Array.isArray(a.value)?"array":"object"}:r.target==="openApi3"?{type:o==="bigint"?"integer":o,enum:[a.value]}:{type:o==="bigint"?"integer":o,const:a.value}}(e,s);case n.kY.ZodEnum:return{type:"string",enum:Array.from(e.values)};case n.kY.ZodNativeEnum:return function(a){let r=a.values,o=Object.keys(a.values).filter(u=>typeof r[r[u]]!="number").map(u=>r[u]),i=Array.from(new Set(o.map(u=>typeof u)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:o}}(e);case n.kY.ZodNullable:return function(a,r){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(a.innerType._def.typeName)&&(!a.innerType._def.checks||!a.innerType._def.checks.length))return r.target==="openApi3"?{type:Kt[a.innerType._def.typeName],nullable:!0}:{type:[Kt[a.innerType._def.typeName],"null"]};if(r.target==="openApi3"){let i=X(a.innerType._def,{...r,currentPath:[...r.currentPath]});return i&&"$ref"in i?{allOf:[i],nullable:!0}:i&&{...i,nullable:!0}}let o=X(a.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","0"]});return o&&{anyOf:[o,{type:"null"}]}}(e,s);case n.kY.ZodOptional:return wr(e,s);case n.kY.ZodMap:return function(a,r){return r.mapStrategy==="record"?mn(a,r):{type:"array",maxItems:125,items:{type:"array",items:[X(a.keyType._def,{...r,currentPath:[...r.currentPath,"items","items","0"]})||{},X(a.valueType._def,{...r,currentPath:[...r.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,s);case n.kY.ZodSet:return function(a,r){let o={type:"array",uniqueItems:!0,items:X(a.valueType._def,{...r,currentPath:[...r.currentPath,"items"]})};return a.minSize&&ae(o,"minItems",a.minSize.value,a.minSize.message,r),a.maxSize&&ae(o,"maxItems",a.maxSize.value,a.maxSize.message,r),o}(e,s);case n.kY.ZodLazy:return X(e.getter()._def,s);case n.kY.ZodPromise:return X(e.type._def,s);case n.kY.ZodNaN:case n.kY.ZodNever:return{not:{}};case n.kY.ZodEffects:return function(a,r){return r.effectStrategy==="input"?X(a.schema._def,r):{}}(e,s);case n.kY.ZodAny:case n.kY.ZodUnknown:return{};case n.kY.ZodDefault:return function(a,r){return{...X(a.innerType._def,r),default:a.defaultValue()}}(e,s);case n.kY.ZodBranded:return cn(e,s);case n.kY.ZodReadonly:return Ir(e,s);case n.kY.ZodCatch:return yr(e,s);case n.kY.ZodPipeline:return xr(e,s);case n.kY.ZodFunction:case n.kY.ZodVoid:case n.kY.ZodSymbol:default:return}},Tr=(e,t,s)=>(e.description&&(s.description=e.description,t.markdownDescription&&(s.markdownDescription=e.description)),s),Rr=(e,t)=>{let s=_r(t),a=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((c,[d,p])=>({...c,[d]:X(p._def,{...s,currentPath:[...s.basePath,s.definitionPath,d]},!0)??{}}),{}):void 0,r=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,o=X(e._def,r===void 0?s:{...s,currentPath:[...s.basePath,s.definitionPath,r]},!1)??{},i=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;i!==void 0&&(o.title=i);let u=r===void 0?a?{...o,[s.definitionPath]:a}:o:{$ref:[...s.$refStrategy==="relative"?[]:s.basePath,s.definitionPath,r].join("/"),[s.definitionPath]:{...a,[r]:o}};return s.target==="jsonSchema7"?u.$schema="http://json-schema.org/draft-07/schema#":(s.target==="jsonSchema2019-09"||s.target==="openAi")&&(u.$schema="https://json-schema.org/draft/2019-09/schema#"),s.target==="openAi"&&("anyOf"in u||"oneOf"in u||"allOf"in u||"type"in u&&Array.isArray(u.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),u};var It={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},jt={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},Et={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},St={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},Tt={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},Nr=[It,jt,Et,St,Tt],Rc={[It.code]:It,[jt.code]:jt,[Et.code]:Et,[St.code]:St,[Tt.code]:Tt};It.name,It.code,jt.name,jt.code,Et.name,Et.code,St.name,St.code,Tt.name,Tt.code;var Nc=Nr.map(e=>e.code);function Ar(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=mt({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=mt({text:function(s){let a=["ROOT"],r=-1,o=null;function i(p,l,f){switch(p){case'"':r=l,a.pop(),a.push(f),a.push("INSIDE_STRING");break;case"f":case"t":case"n":r=l,o=l,a.pop(),a.push(f),a.push("INSIDE_LITERAL");break;case"-":a.pop(),a.push(f),a.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=l,a.pop(),a.push(f),a.push("INSIDE_NUMBER");break;case"{":r=l,a.pop(),a.push(f),a.push("INSIDE_OBJECT_START");break;case"[":r=l,a.pop(),a.push(f),a.push("INSIDE_ARRAY_START")}}function u(p,l){switch(p){case",":a.pop(),a.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=l,a.pop()}}function c(p,l){switch(p){case",":a.pop(),a.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=l,a.pop()}}for(let p=0;p<s.length;p++){let l=s[p];switch(a[a.length-1]){case"ROOT":i(l,p,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':a.pop(),a.push("INSIDE_OBJECT_KEY");break;case"}":r=p,a.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":l==='"'&&(a.pop(),a.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":l==='"'&&(a.pop(),a.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":l===":"&&(a.pop(),a.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":i(l,p,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":u(l,p);break;case"INSIDE_STRING":switch(l){case'"':a.pop(),r=p;break;case"\\":a.push("INSIDE_STRING_ESCAPE");break;default:r=p}break;case"INSIDE_ARRAY_START":l==="]"?(r=p,a.pop()):(r=p,i(l,p,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":a.pop(),a.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=p,a.pop();break;default:r=p}break;case"INSIDE_ARRAY_AFTER_COMMA":i(l,p,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":a.pop(),r=p;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=p;break;case"e":case"E":case"-":case".":break;case",":a.pop(),a[a.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&c(l,p),a[a.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&u(l,p);break;case"}":a.pop(),a[a.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&u(l,p);break;case"]":a.pop(),a[a.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&c(l,p);break;default:a.pop()}break;case"INSIDE_LITERAL":{let f=s.substring(o,p+1);"false".startsWith(f)||"true".startsWith(f)||"null".startsWith(f)?r=p:(a.pop(),a[a.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?u(l,p):a[a.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&c(l,p))}}}let d=s.slice(0,r+1);for(let p=a.length-1;p>=0;p--)switch(a[p]){case"INSIDE_STRING":d+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":d+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":d+="]";break;case"INSIDE_LITERAL":{let l=s.substring(o,s.length);"true".startsWith(l)?d+="true".slice(l.length):"false".startsWith(l)?d+="false".slice(l.length):"null".startsWith(l)&&(d+="null".slice(l.length))}}return d}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}var Ht=[{code:"0",name:"text",parse:e=>{if(typeof e!="string")throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},{code:"3",name:"error",parse:e=>{if(typeof e!="string")throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},{code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},{code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},{code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},{code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},{code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},{code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},{code:"f",name:"start_step",parse:e=>{if(e==null||typeof e!="object"||!("messageId"in e)||typeof e.messageId!="string")throw Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},{code:"g",name:"reasoning",parse:e=>{if(typeof e!="string")throw Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},{code:"h",name:"source",parse:e=>{if(e==null||typeof e!="object")throw Error('"source" parts expect a Source object.');return{type:"source",value:e}}},{code:"i",name:"redacted_reasoning",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string")throw Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},{code:"j",name:"reasoning_signature",parse:e=>{if(e==null||typeof e!="object"||!("signature"in e)||typeof e.signature!="string")throw Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},{code:"k",name:"file",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string"||!("mimeType"in e)||typeof e.mimeType!="string")throw Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}}],Or=Object.fromEntries(Ht.map(e=>[e.code,e]));Object.fromEntries(Ht.map(e=>[e.name,e.code]));var Cr=Ht.map(e=>e.code),Mr=e=>{let t=e.indexOf(":");if(t===-1)throw Error("Failed to parse stream string. No separator found.");let s=e.slice(0,t);if(!Cr.includes(s))throw Error(`Failed to parse stream string. Invalid code ${s}.`);let a=JSON.parse(e.slice(t+1));return Or[s].parse(a)};function fn(e,t){let s=Ht.find(a=>a.name===e);if(!s)throw Error(`Invalid stream part type: ${e}`);return`${s.code}:${JSON.stringify(t)}
`}async function Ac({stream:e,onTextPart:t,onReasoningPart:s,onReasoningSignaturePart:a,onRedactedReasoningPart:r,onSourcePart:o,onFilePart:i,onDataPart:u,onErrorPart:c,onToolCallStreamingStartPart:d,onToolCallDeltaPart:p,onToolCallPart:l,onToolResultPart:f,onMessageAnnotationsPart:j,onFinishMessagePart:k,onFinishStepPart:h,onStartStepPart:m}){let g=e.getReader(),x=new TextDecoder,w=[],v=0;for(;;){let{value:I}=await g.read();if(I&&(w.push(I),v+=I.length,I[I.length-1]!==10))continue;if(w.length===0)break;let T=function(M,_){let y=new Uint8Array(_),$=0;for(let A of M)y.set(A,$),$+=A.length;return M.length=0,y}(w,v);for(let{type:M,value:_}of(v=0,x.decode(T,{stream:!0}).split(`
`).filter(y=>y!=="").map(Mr)))switch(M){case"text":await t?.(_);break;case"reasoning":await s?.(_);break;case"reasoning_signature":await a?.(_);break;case"redacted_reasoning":await r?.(_);break;case"file":await i?.(_);break;case"source":await o?.(_);break;case"data":await u?.(_);break;case"error":await c?.(_);break;case"message_annotations":await j?.(_);break;case"tool_call_streaming_start":await d?.(_);break;case"tool_call_delta":await p?.(_);break;case"tool_call":await l?.(_);break;case"tool_result":await f?.(_);break;case"finish_message":await k?.(_);break;case"finish_step":await h?.(_);break;case"start_step":await m?.(_);break;default:throw Error(`Unknown stream part type: ${M}`)}}}async function Oc({stream:e,onTextPart:t}){let s=e.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:a,value:r}=await s.read();if(a)break;await t(r)}}var ia=Symbol.for("vercel.ai.schema");function la(e){return typeof e=="object"&&e!==null&&ia in e&&e[ia]===!0&&"jsonSchema"in e&&"validate"in e?e:function(t,{validate:s}={}){return{[ia]:!0,_type:void 0,[Zt]:!0,jsonSchema:t,validate:s}}(Rr(e,{$refStrategy:"none",target:"jsonSchema7"}),{validate:t=>{let s=e.safeParse(t);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}var Pr=Object.defineProperty,ua=(e,t)=>{for(var s in t)Pr(e,s,{get:t[s],enumerable:!0})};function ca(e,{contentType:t,dataStreamVersion:s}){let a=new Headers(e??{});return a.has("Content-Type")||a.set("Content-Type",t),s!==void 0&&a.set("X-Vercel-AI-Data-Stream",s),a}function Cc(e,{contentType:t,dataStreamVersion:s}){let a={};if(e!=null)for(let[r,o]of Object.entries(e))a[r]=o;return a["Content-Type"]==null&&(a["Content-Type"]=t),s!==void 0&&(a["X-Vercel-AI-Data-Stream"]=s),a}function Mc({response:e,status:t,statusText:s,headers:a,stream:r}){e.writeHead(t??200,s,a);let o=r.getReader();(async()=>{try{for(;;){let{done:i,value:u}=await o.read();if(i)break;e.write(u)}}catch(i){throw i}finally{e.end()}})()}var gn="AI_InvalidArgumentError",_n=`vercel.ai.error.${gn}`,Yr=Symbol.for(_n),ce=class extends R{constructor({parameter:e,value:t,message:s}){super({name:gn,message:`Invalid argument for parameter ${e}: ${s}`}),this[xe]=!0,this.parameter=e,this.value=t}static isInstance(e){return R.hasMarker(e,_n)}};xe=Yr;var yn="AI_RetryError",kn=`vercel.ai.error.${yn}`,$r=Symbol.for(kn),vn=class extends R{constructor({message:e,reason:t,errors:s}){super({name:yn,message:e}),this[Pe]=!0,this.reason=t,this.errors=s,this.lastError=s[s.length-1]}static isInstance(e){return R.hasMarker(e,kn)}};Pe=$r;var Dr=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:s=2}={})=>async a=>bn(a,{maxRetries:e,delayInMs:t,backoffFactor:s});async function bn(e,{maxRetries:t,delayInMs:s,backoffFactor:a},r=[]){try{return await e()}catch(o){if(Lt(o)||t===0)throw o;let i=o==null?"unknown error":typeof o=="string"?o:o instanceof Error?o.message:JSON.stringify(o),u=[...r,o],c=u.length;if(c>t)throw new vn({message:`Failed after ${c} attempts. Last error: ${i}`,reason:"maxRetriesExceeded",errors:u});if(o instanceof Error&&Ae.isInstance(o)&&o.isRetryable===!0&&c<=t)return await Ns(s),bn(e,{maxRetries:t,delayInMs:a*s,backoffFactor:a},u);throw c===1?o:new vn({message:`Failed after ${c} attempts with non-retryable error: '${i}'`,reason:"errorNotRetryable",errors:u})}}function Ur({maxRetries:e}){if(e!=null){if(!Number.isInteger(e))throw new ce({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new ce({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let t=e??2;return{maxRetries:t,retry:Dr({maxRetries:t})}}function pa({operationId:e,telemetry:t}){return{"operation.name":`${e}${t?.functionId!=null?` ${t.functionId}`:""}`,"resource.name":t?.functionId,"ai.operationId":e,"ai.telemetry.functionId":t?.functionId}}function qr({model:e,settings:t,telemetry:s,headers:a}){var r;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((o,[i,u])=>(o[`ai.settings.${i}`]=u,o),{}),...Object.entries((r=s?.metadata)!=null?r:{}).reduce((o,[i,u])=>(o[`ai.telemetry.metadata.${i}`]=u,o),{}),...Object.entries(a??{}).reduce((o,[i,u])=>(u!==void 0&&(o[`ai.request.headers.${i}`]=u),o),{})}}var Fr={startSpan:()=>Jt,startActiveSpan:(e,t,s,a)=>typeof t=="function"?t(Jt):typeof s=="function"?s(Jt):typeof a=="function"?a(Jt):void 0},Jt={spanContext:()=>Lr,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},Lr={traceId:"",spanId:"",traceFlags:0};function Zr({isEnabled:e=!1,tracer:t}={}){return e?t||hr.u.getTracer("ai"):Fr}function da({name:e,tracer:t,attributes:s,fn:a,endWhenDone:r=!0}){return t.startActiveSpan(e,{attributes:s},async o=>{try{let i=await a(o);return r&&o.end(),i}catch(i){try{i instanceof Error?(o.recordException({name:i.name,message:i.message,stack:i.stack}),o.setStatus({code:on.s.ERROR,message:i.message})):o.setStatus({code:on.s.ERROR})}finally{o.end()}throw i}})}function ft({telemetry:e,attributes:t}){return e?.isEnabled!==!0?{}:Object.entries(t).reduce((s,[a,r])=>{if(r===void 0)return s;if(typeof r=="object"&&"input"in r&&typeof r.input=="function"){if(e?.recordInputs===!1)return s;let o=r.input();return o===void 0?s:{...s,[a]:o}}if(typeof r=="object"&&"output"in r&&typeof r.output=="function"){if(e?.recordOutputs===!1)return s;let o=r.output();return o===void 0?s:{...s,[a]:o}}return{...s,[a]:r}},{})}var zr="AI_NoImageGeneratedError",Br=`vercel.ai.error.${zr}`;Ze=Symbol.for(Br);var Vr=class{constructor({data:e,mimeType:t}){let s=e instanceof Uint8Array;this.base64Data=s?void 0:e,this.uint8ArrayData=s?e:void 0,this.mimeType=t}get base64(){return this.base64Data==null&&(this.base64Data=xt(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=zt(this.base64Data)),this.uint8ArrayData}},Pc=class extends Vr{constructor(e){super(e),this.type="file"}},Kr=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],Hr=e=>{let t=typeof e=="string"?zt(e):e,s=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(s+10)},wn="AI_NoObjectGeneratedError",xn=`vercel.ai.error.${wn}`,Jr=Symbol.for(xn),We=class extends R{constructor({message:e="No object generated.",cause:t,text:s,response:a,usage:r,finishReason:o}){super({name:wn,message:e,cause:t}),this[Xe]=!0,this.text=s,this.response=a,this.usage=r,this.finishReason=o}static isInstance(e){return R.hasMarker(e,xn)}};Xe=Jr;var In="AI_DownloadError",jn=`vercel.ai.error.${In}`,Wr=Symbol.for(jn),ma=class extends R{constructor({url:e,statusCode:t,statusText:s,cause:a,message:r=a==null?`Failed to download ${e}: ${t} ${s}`:`Failed to download ${e}: ${a}`}){super({name:In,message:r,cause:a}),this[ct]=!0,this.url=e,this.statusCode=t,this.statusText=s}static isInstance(e){return R.hasMarker(e,jn)}};async function Gr({url:e}){var t;let s=e.toString();try{let a=await fetch(s);if(!a.ok)throw new ma({url:s,statusCode:a.status,statusText:a.statusText});return{data:new Uint8Array(await a.arrayBuffer()),mimeType:(t=a.headers.get("content-type"))!=null?t:void 0}}catch(a){throw ma.isInstance(a)?a:new ma({url:s,cause:a})}}ct=Wr;var En="AI_InvalidDataContentError",Sn=`vercel.ai.error.${En}`,Xr=Symbol.for(Sn),Tn=class extends R{constructor({content:e,cause:t,message:s=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:En,message:s,cause:t}),this[Ke]=!0,this.content=e}static isInstance(e){return R.hasMarker(e,Sn)}};Ke=Xr;var Rn=n.KC([n.Yj(),n.Nl(Uint8Array),n.Nl(ArrayBuffer),n.Ie(e=>{var t,s;return(s=(t=te.Buffer)==null?void 0:t.isBuffer(e))!=null&&s},{message:"Must be a Buffer"})]);function ha(e){return typeof e=="string"?e:e instanceof ArrayBuffer?xt(new Uint8Array(e)):xt(e)}function Wt(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return zt(e)}catch(t){throw new Tn({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new Tn({content:e})}var Nn="AI_InvalidMessageRoleError",An=`vercel.ai.error.${Nn}`,Qr=Symbol.for(An),eo=class extends R{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:Nn,message:t}),this[Qe]=!0,this.role=e}static isInstance(e){return R.hasMarker(e,An)}};async function On({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:s=()=>!1,downloadImplementation:a=Gr}){let r=await to(e.messages,a,t,s);return[...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(o=>function(i,u){var c,d,p,l,f,j;let k=i.role;switch(k){case"system":return{role:"system",content:i.content,providerMetadata:(c=i.providerOptions)!=null?c:i.experimental_providerMetadata};case"user":return typeof i.content=="string"?{role:"user",content:[{type:"text",text:i.content}],providerMetadata:(d=i.providerOptions)!=null?d:i.experimental_providerMetadata}:{role:"user",content:i.content.map(h=>function(m,g){var x,w,v,I;let T,M,_;if(m.type==="text")return{type:"text",text:m.text,providerMetadata:(x=m.providerOptions)!=null?x:m.experimental_providerMetadata};let y=m.mimeType,$=m.type;switch($){case"image":T=m.image;break;case"file":T=m.data;break;default:throw Error(`Unsupported part type: ${$}`)}try{M=typeof T=="string"?new URL(T):T}catch{M=T}if(M instanceof URL)if(M.protocol==="data:"){let{mimeType:A,base64Content:P}=function(J){try{let[N,W]=J.split(",");return{mimeType:N.split(";")[0].split(":")[1],base64Content:W}}catch{return{mimeType:void 0,base64Content:void 0}}}(M.toString());if(A==null||P==null)throw Error(`Invalid data URL format in part ${$}`);y=A,_=Wt(P)}else{let A=g[M.toString()];A?(_=A.data,y!=null||(y=A.mimeType)):_=M}else _=Wt(M);switch($){case"image":return _ instanceof Uint8Array&&(y=(w=function({data:A,signatures:P}){let J=typeof A=="string"&&A.startsWith("SUQz")||typeof A!="string"&&A.length>10&&A[0]===73&&A[1]===68&&A[2]===51?Hr(A):A;for(let N of P)if(typeof J=="string"?J.startsWith(N.base64Prefix):J.length>=N.bytesPrefix.length&&N.bytesPrefix.every((W,G)=>J[G]===W))return N.mimeType}({data:_,signatures:Kr}))!=null?w:y),{type:"image",image:_,mimeType:y,providerMetadata:(v=m.providerOptions)!=null?v:m.experimental_providerMetadata};case"file":if(y==null)throw Error("Mime type is missing for file part");return{type:"file",data:_ instanceof Uint8Array?ha(_):_,filename:m.filename,mimeType:y,providerMetadata:(I=m.providerOptions)!=null?I:m.experimental_providerMetadata}}}(h,u)).filter(h=>h.type!=="text"||h.text!==""),providerMetadata:(p=i.providerOptions)!=null?p:i.experimental_providerMetadata};case"assistant":return typeof i.content=="string"?{role:"assistant",content:[{type:"text",text:i.content}],providerMetadata:(l=i.providerOptions)!=null?l:i.experimental_providerMetadata}:{role:"assistant",content:i.content.filter(h=>h.type!=="text"||h.text!=="").map(h=>{var m;let g=(m=h.providerOptions)!=null?m:h.experimental_providerMetadata;switch(h.type){case"file":return{type:"file",data:h.data instanceof URL?h.data:ha(h.data),filename:h.filename,mimeType:h.mimeType,providerMetadata:g};case"reasoning":return{type:"reasoning",text:h.text,signature:h.signature,providerMetadata:g};case"redacted-reasoning":return{type:"redacted-reasoning",data:h.data,providerMetadata:g};case"text":return{type:"text",text:h.text,providerMetadata:g};case"tool-call":return{type:"tool-call",toolCallId:h.toolCallId,toolName:h.toolName,args:h.args,providerMetadata:g}}}),providerMetadata:(f=i.providerOptions)!=null?f:i.experimental_providerMetadata};case"tool":return{role:"tool",content:i.content.map(h=>{var m;return{type:"tool-result",toolCallId:h.toolCallId,toolName:h.toolName,result:h.result,content:h.experimental_content,isError:h.isError,providerMetadata:(m=h.providerOptions)!=null?m:h.experimental_providerMetadata}}),providerMetadata:(j=i.providerOptions)!=null?j:i.experimental_providerMetadata};default:throw new eo({role:k})}}(o,r))]}async function to(e,t,s,a){let r=e.filter(o=>o.role==="user").map(o=>o.content).filter(o=>Array.isArray(o)).flat().filter(o=>o.type==="image"||o.type==="file").filter(o=>o.type!=="image"||s!==!0).map(o=>o.type==="image"?o.image:o.data).map(o=>typeof o=="string"&&(o.startsWith("http:")||o.startsWith("https:"))?new URL(o):o).filter(o=>o instanceof URL).filter(o=>!a(o));return Object.fromEntries((await Promise.all(r.map(async o=>({url:o,data:await t({url:o})})))).map(({url:o,data:i})=>[o.toString(),i]))}function Cn({maxTokens:e,temperature:t,topP:s,topK:a,presencePenalty:r,frequencyPenalty:o,stopSequences:i,seed:u}){if(e!=null){if(!Number.isInteger(e))throw new ce({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new ce({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new ce({parameter:"temperature",value:t,message:"temperature must be a number"});if(s!=null&&typeof s!="number")throw new ce({parameter:"topP",value:s,message:"topP must be a number"});if(a!=null&&typeof a!="number")throw new ce({parameter:"topK",value:a,message:"topK must be a number"});if(r!=null&&typeof r!="number")throw new ce({parameter:"presencePenalty",value:r,message:"presencePenalty must be a number"});if(o!=null&&typeof o!="number")throw new ce({parameter:"frequencyPenalty",value:o,message:"frequencyPenalty must be a number"});if(u!=null&&!Number.isInteger(u))throw new ce({parameter:"seed",value:u,message:"seed must be an integer"});return{maxTokens:e,temperature:t??0,topP:s,topK:a,presencePenalty:r,frequencyPenalty:o,stopSequences:i!=null&&i.length>0?i:void 0,seed:u}}function Mn(e){var t,s,a;let r=[];for(let o of e){let i;try{i=new URL(o.url)}catch{throw Error(`Invalid URL: ${o.url}`)}switch(i.protocol){case"http:":case"https:":if((t=o.contentType)!=null&&t.startsWith("image/"))r.push({type:"image",image:i});else{if(!o.contentType)throw Error("If the attachment is not an image, it must specify a content type");r.push({type:"file",data:i,mimeType:o.contentType})}break;case"data:":{let u,c,d;try{[u,c]=o.url.split(","),d=u.split(";")[0].split(":")[1]}catch{throw Error(`Error processing data URL: ${o.url}`)}if(d==null||c==null)throw Error(`Invalid data URL format: ${o.url}`);if((s=o.contentType)!=null&&s.startsWith("image/"))r.push({type:"image",image:Wt(c)});else if((a=o.contentType)!=null&&a.startsWith("text/"))r.push({type:"text",text:function(p){try{return new TextDecoder().decode(p)}catch{throw Error("Error decoding Uint8Array to text")}}(Wt(c))});else{if(!o.contentType)throw Error("If the attachment is not an image or text, it must specify a content type");r.push({type:"file",data:c,mimeType:o.contentType})}break}default:throw Error(`Unsupported URL protocol: ${i.protocol}`)}}return r}Qe=Qr;var Pn="AI_MessageConversionError",Yn=`vercel.ai.error.${Pn}`,ao=Symbol.for(Yn),fa=class extends R{constructor({originalMessage:e,message:t}){super({name:Pn,message:t}),this[et]=!0,this.originalMessage=e}static isInstance(e){return R.hasMarker(e,Yn)}};et=ao;var ga=n.RZ(()=>n.KC([n.ch(),n.Yj(),n.ai(),n.zM(),n.g1(n.Yj(),ga),n.YO(ga)])),me=n.g1(n.Yj(),n.g1(n.Yj(),ga)),no=n.YO(n.KC([n.Ik({type:n.eu("text"),text:n.Yj()}),n.Ik({type:n.eu("image"),data:n.Yj(),mimeType:n.Yj().optional()})])),$n=n.Ik({type:n.eu("text"),text:n.Yj(),providerOptions:me.optional(),experimental_providerMetadata:me.optional()}),so=n.Ik({type:n.eu("image"),image:n.KC([Rn,n.Nl(URL)]),mimeType:n.Yj().optional(),providerOptions:me.optional(),experimental_providerMetadata:me.optional()}),Dn=n.Ik({type:n.eu("file"),data:n.KC([Rn,n.Nl(URL)]),filename:n.Yj().optional(),mimeType:n.Yj(),providerOptions:me.optional(),experimental_providerMetadata:me.optional()}),ro=n.Ik({type:n.eu("reasoning"),text:n.Yj(),providerOptions:me.optional(),experimental_providerMetadata:me.optional()}),oo=n.Ik({type:n.eu("redacted-reasoning"),data:n.Yj(),providerOptions:me.optional(),experimental_providerMetadata:me.optional()}),io=n.Ik({type:n.eu("tool-call"),toolCallId:n.Yj(),toolName:n.Yj(),args:n.L5(),providerOptions:me.optional(),experimental_providerMetadata:me.optional()}),lo=n.Ik({type:n.eu("tool-result"),toolCallId:n.Yj(),toolName:n.Yj(),result:n.L5(),content:no.optional(),isError:n.zM().optional(),providerOptions:me.optional(),experimental_providerMetadata:me.optional()}),uo=n.Ik({role:n.eu("system"),content:n.Yj(),providerOptions:me.optional(),experimental_providerMetadata:me.optional()}),co=n.Ik({role:n.eu("user"),content:n.KC([n.Yj(),n.YO(n.KC([$n,so,Dn]))]),providerOptions:me.optional(),experimental_providerMetadata:me.optional()}),po=n.Ik({role:n.eu("assistant"),content:n.KC([n.Yj(),n.YO(n.KC([$n,Dn,ro,oo,io]))]),providerOptions:me.optional(),experimental_providerMetadata:me.optional()}),mo=n.Ik({role:n.eu("tool"),content:n.YO(lo),providerOptions:me.optional(),experimental_providerMetadata:me.optional()}),ho=n.KC([uo,co,po,mo]);function Un({prompt:e,tools:t}){if(e.prompt==null&&e.messages==null)throw new ze({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new ze({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new ze({prompt:e,message:"system must be a string"});if(e.prompt!=null){if(typeof e.prompt!="string")throw new ze({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(e.messages!=null){let s=function(r){if(!Array.isArray(r))throw new ze({prompt:r,message:`messages must be an array of CoreMessage or UIMessage
Received non-array value: ${JSON.stringify(r)}`,cause:r});if(r.length===0)return"messages";let o=r.map(fo);if(o.some(u=>u==="has-ui-specific-parts"))return"ui-messages";let i=o.findIndex(u=>u!=="has-core-specific-parts"&&u!=="message");if(i===-1)return"messages";throw new ze({prompt:r,message:`messages must be an array of CoreMessage or UIMessage
Received message of type: "${o[i]}" at index ${i}
messages[${i}]: ${JSON.stringify(r[i])}`,cause:r})}(e.messages)==="ui-messages"?function(r,o){var i,u;let c=(i=o?.tools)!=null?i:{},d=[];for(let p=0;p<r.length;p++){let l=r[p],f=p===r.length-1,{role:j,content:k,experimental_attachments:h}=l;switch(j){case"system":d.push({role:"system",content:k});break;case"user":if(l.parts==null)d.push({role:"user",content:h?[{type:"text",text:k},...Mn(h)]:k});else{let m=l.parts.filter(g=>g.type==="text").map(g=>({type:"text",text:g.text}));d.push({role:"user",content:h?[...m,...Mn(h)]:m})}break;case"assistant":{if(l.parts!=null){let x=function(){let T=[];for(let _ of I)switch(_.type){case"file":case"text":T.push(_);break;case"reasoning":for(let y of _.details)switch(y.type){case"text":T.push({type:"reasoning",text:y.text,signature:y.signature});break;case"redacted":T.push({type:"redacted-reasoning",data:y.data})}break;case"tool-invocation":T.push({type:"tool-call",toolCallId:_.toolInvocation.toolCallId,toolName:_.toolInvocation.toolName,args:_.toolInvocation.args});break;default:throw Error(`Unsupported part: ${_}`)}d.push({role:"assistant",content:T});let M=I.filter(_=>_.type==="tool-invocation").map(_=>_.toolInvocation);M.length>0&&d.push({role:"tool",content:M.map(_=>{if(!("result"in _))throw new fa({originalMessage:l,message:"ToolInvocation must have a result: "+JSON.stringify(_)});let{toolCallId:y,toolName:$,result:A}=_,P=c[$];return P?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:y,toolName:$,result:P.experimental_toToolResultContent(A),experimental_content:P.experimental_toToolResultContent(A)}:{type:"tool-result",toolCallId:y,toolName:$,result:A}})}),I=[],v=!1,w++},w=0,v=!1,I=[];for(let T of l.parts)switch(T.type){case"text":v&&x(),I.push(T);break;case"file":case"reasoning":I.push(T);break;case"tool-invocation":((u=T.toolInvocation.step)!=null?u:0)!==w&&x(),I.push(T),v=!0}x();break}let m=l.toolInvocations;if(m==null||m.length===0){d.push({role:"assistant",content:k});break}let g=m.reduce((x,w)=>{var v;return Math.max(x,(v=w.step)!=null?v:0)},0);for(let x=0;x<=g;x++){let w=m.filter(v=>{var I;return((I=v.step)!=null?I:0)===x});w.length!==0&&(d.push({role:"assistant",content:[...f&&k&&x===0?[{type:"text",text:k}]:[],...w.map(({toolCallId:v,toolName:I,args:T})=>({type:"tool-call",toolCallId:v,toolName:I,args:T}))]}),d.push({role:"tool",content:w.map(v=>{if(!("result"in v))throw new fa({originalMessage:l,message:"ToolInvocation must have a result: "+JSON.stringify(v)});let{toolCallId:I,toolName:T,result:M}=v,_=c[T];return _?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:I,toolName:T,result:_.experimental_toToolResultContent(M),experimental_content:_.experimental_toToolResultContent(M)}:{type:"tool-result",toolCallId:I,toolName:T,result:M}})}))}k&&!f&&d.push({role:"assistant",content:k});break}case"data":break;default:throw new fa({originalMessage:l,message:`Unsupported role: ${j}`})}}return d}(e.messages,{tools:t}):e.messages;if(s.length===0)throw new ze({prompt:e,message:"messages must not be empty"});let a=Je({value:s,schema:n.YO(ho)});if(!a.success)throw new ze({prompt:e,message:`message must be a CoreMessage or a UI message
Validation error: ${a.error.message}`,cause:a.error});return{type:"messages",messages:s,system:e.system}}throw Error("unreachable")}function fo(e){return typeof e=="object"&&e!==null&&(e.role==="function"||e.role==="data"||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":typeof e=="object"&&e!==null&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":typeof e=="object"&&e!==null&&"role"in e&&"content"in e&&typeof e.content=="string"&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function gt({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function _a({prompt:e,schema:t,schemaPrefix:s=t!=null?"JSON schema:":void 0,schemaSuffix:a=t!=null?"You MUST answer with a JSON object that matches the JSON schema above.":"You MUST answer with JSON."}){return[e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?"":void 0,s,t!=null?JSON.stringify(t):void 0,a].filter(r=>r!=null).join(`
`)}function go(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{let s=t.getReader();return{async next(){let{done:a,value:r}=await s.read();return a?{done:!0,value:void 0}:{done:!1,value:r}}}},t}var _o={type:"no-schema",jsonSchema:void 0,validatePartialResult:({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:(e,t)=>e===void 0?{success:!1,error:new We({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e},createElementStream(){throw new fe({functionality:"element streams in no-schema mode"})}},yo=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult:({value:t,textDelta:s})=>({success:!0,value:{partial:t,textDelta:s}}),validateFinalResult:t=>Je({value:t,schema:e}),createElementStream(){throw new fe({functionality:"element streams in object mode"})}}),ko=e=>{let{$schema:t,...s}=e.jsonSchema;return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:s}},required:["elements"],additionalProperties:!1},validatePartialResult({value:a,latestObject:r,isFirstDelta:o,isFinalDelta:i}){var u;if(!ea(a)||!Wa(a.elements))return{success:!1,error:new Be({value:a,cause:"value must be an object that contains an array of elements"})};let c=a.elements,d=[];for(let f=0;f<c.length;f++){let j=Je({value:c[f],schema:e});if(f!==c.length-1||i){if(!j.success)return j;d.push(j.value)}}let p=(u=r?.length)!=null?u:0,l="";return o&&(l+="["),p>0&&(l+=","),l+=d.slice(p).map(f=>JSON.stringify(f)).join(","),i&&(l+="]"),{success:!0,value:{partial:d,textDelta:l}}},validateFinalResult(a){if(!ea(a)||!Wa(a.elements))return{success:!1,error:new Be({value:a,cause:"value must be an object that contains an array of elements"})};let r=a.elements;for(let o of r){let i=Je({value:o,schema:e});if(!i.success)return i}return{success:!0,value:r}},createElementStream(a){let r=0;return go(a.pipeThrough(new TransformStream({transform(o,i){switch(o.type){case"object":{let u=o.object;for(;r<u.length;r++)i.enqueue(u[r]);break}case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${o}`)}}})))}}},vo=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},validateFinalResult(t){if(!ea(t)||typeof t.result!="string")return{success:!1,error:new Be({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let s=t.result;return e.includes(s)?{success:!0,value:s}:{success:!1,error:new Be({value:t,cause:"value must be a string in the enum"})}},validatePartialResult(){throw new fe({functionality:"partial results in enum mode"})},createElementStream(){throw new fe({functionality:"element streams in enum mode"})}});function bo(e){return JSON.stringify(e.map(t=>({...t,content:typeof t.content=="string"?t.content:t.content.map(wo)})))}function wo(e){return e.type==="image"?{...e,image:e.image instanceof Uint8Array?ha(e.image):e.image}:e}var xo=st({prefix:"aiobj",size:24});async function Io({model:e,enum:t,schema:s,schemaName:a,schemaDescription:r,mode:o,output:i="object",system:u,prompt:c,messages:d,maxRetries:p,abortSignal:l,headers:f,experimental_repairText:j,experimental_telemetry:k,experimental_providerMetadata:h,providerOptions:m=h,_internal:{generateId:g=xo,currentDate:x=()=>new Date}={},...w}){(function({output:y,mode:$,schema:A,schemaName:P,schemaDescription:J,enumValues:N}){if(y!=null&&y!=="object"&&y!=="array"&&y!=="enum"&&y!=="no-schema")throw new ce({parameter:"output",value:y,message:"Invalid output type."});if(y==="no-schema"){if($==="auto"||$==="tool")throw new ce({parameter:"mode",value:$,message:'Mode must be "json" for no-schema output.'});if(A!=null)throw new ce({parameter:"schema",value:A,message:"Schema is not supported for no-schema output."});if(J!=null)throw new ce({parameter:"schemaDescription",value:J,message:"Schema description is not supported for no-schema output."});if(P!=null)throw new ce({parameter:"schemaName",value:P,message:"Schema name is not supported for no-schema output."});if(N!=null)throw new ce({parameter:"enumValues",value:N,message:"Enum values are not supported for no-schema output."})}if(y==="object"){if(A==null)throw new ce({parameter:"schema",value:A,message:"Schema is required for object output."});if(N!=null)throw new ce({parameter:"enumValues",value:N,message:"Enum values are not supported for object output."})}if(y==="array"){if(A==null)throw new ce({parameter:"schema",value:A,message:"Element schema is required for array output."});if(N!=null)throw new ce({parameter:"enumValues",value:N,message:"Enum values are not supported for array output."})}if(y==="enum"){if(A!=null)throw new ce({parameter:"schema",value:A,message:"Schema is not supported for enum output."});if(J!=null)throw new ce({parameter:"schemaDescription",value:J,message:"Schema description is not supported for enum output."});if(P!=null)throw new ce({parameter:"schemaName",value:P,message:"Schema name is not supported for enum output."});if(N==null)throw new ce({parameter:"enumValues",value:N,message:"Enum values are required for enum output."});for(let W of N)if(typeof W!="string")throw new ce({parameter:"enumValues",value:W,message:"Enum values must be strings."})}})({output:i,mode:o,schema:s,schemaName:a,schemaDescription:r,enumValues:t});let{maxRetries:v,retry:I}=Ur({maxRetries:p}),T=function({output:y,schema:$,enumValues:A}){switch(y){case"object":return yo(la($));case"array":return ko(la($));case"enum":return vo(A);case"no-schema":return _o;default:throw Error(`Unsupported output: ${y}`)}}({output:i,schema:s,enumValues:t});T.type==="no-schema"&&o===void 0&&(o="json");let M=qr({model:e,telemetry:k,headers:f,settings:{...w,maxRetries:v}}),_=Zr(k);return da({name:"ai.generateObject",attributes:ft({telemetry:k,attributes:{...pa({operationId:"ai.generateObject",telemetry:k}),...M,"ai.prompt":{input:()=>JSON.stringify({system:u,prompt:c,messages:d})},"ai.schema":T.jsonSchema!=null?{input:()=>JSON.stringify(T.jsonSchema)}:void 0,"ai.schema.name":a,"ai.schema.description":r,"ai.settings.output":T.type,"ai.settings.mode":o}}),tracer:_,fn:async y=>{var $,A,P,J;let N,W,G,ge,V,z,U,Z,Ie,be;switch((o==="auto"||o==null)&&(o=e.defaultObjectGenerationMode),o){case"json":{let re=Un({prompt:{system:T.jsonSchema==null?_a({prompt:u}):e.supportsStructuredOutputs?u:_a({prompt:u,schema:T.jsonSchema}),prompt:c,messages:d},tools:void 0}),je=await On({prompt:re,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:($=e.supportsUrl)==null?void 0:$.bind(e)}),oe=await I(()=>da({name:"ai.generateObject.doGenerate",attributes:ft({telemetry:k,attributes:{...pa({operationId:"ai.generateObject.doGenerate",telemetry:k}),...M,"ai.prompt.format":{input:()=>re.type},"ai.prompt.messages":{input:()=>JSON.stringify(je)},"ai.settings.mode":o,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":w.frequencyPenalty,"gen_ai.request.max_tokens":w.maxTokens,"gen_ai.request.presence_penalty":w.presencePenalty,"gen_ai.request.temperature":w.temperature,"gen_ai.request.top_k":w.topK,"gen_ai.request.top_p":w.topP}}),tracer:_,fn:async we=>{var Gt,Rt,Nt,At,Ot,Ct;let ke=await e.doGenerate({mode:{type:"object-json",schema:T.jsonSchema,name:a,description:r},...Cn(w),inputFormat:re.type,prompt:je,providerMetadata:m,abortSignal:l,headers:f}),Le={id:(Rt=(Gt=ke.response)==null?void 0:Gt.id)!=null?Rt:g(),timestamp:(At=(Nt=ke.response)==null?void 0:Nt.timestamp)!=null?At:x(),modelId:(Ct=(Ot=ke.response)==null?void 0:Ot.modelId)!=null?Ct:e.modelId};if(ke.text===void 0)throw new We({message:"No object generated: the model did not return a response.",response:Le,usage:gt(ke.usage),finishReason:ke.finishReason});return we.setAttributes(ft({telemetry:k,attributes:{"ai.response.finishReason":ke.finishReason,"ai.response.object":{output:()=>ke.text},"ai.response.id":Le.id,"ai.response.model":Le.modelId,"ai.response.timestamp":Le.timestamp.toISOString(),"ai.usage.promptTokens":ke.usage.promptTokens,"ai.usage.completionTokens":ke.usage.completionTokens,"gen_ai.response.finish_reasons":[ke.finishReason],"gen_ai.response.id":Le.id,"gen_ai.response.model":Le.modelId,"gen_ai.usage.prompt_tokens":ke.usage.promptTokens,"gen_ai.usage.completion_tokens":ke.usage.completionTokens}})),{...ke,objectText:ke.text,responseData:Le}}}));N=oe.objectText,W=oe.finishReason,G=oe.usage,ge=oe.warnings,V=oe.rawResponse,Z=oe.logprobs,Ie=oe.providerMetadata,U=(A=oe.request)!=null?A:{},z=oe.responseData;break}case"tool":{let re=Un({prompt:{system:u,prompt:c,messages:d},tools:void 0}),je=await On({prompt:re,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(P=e.supportsUrl)==null?void 0:P.bind(e)}),oe=re.type,we=await I(()=>da({name:"ai.generateObject.doGenerate",attributes:ft({telemetry:k,attributes:{...pa({operationId:"ai.generateObject.doGenerate",telemetry:k}),...M,"ai.prompt.format":{input:()=>oe},"ai.prompt.messages":{input:()=>bo(je)},"ai.settings.mode":o,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":w.frequencyPenalty,"gen_ai.request.max_tokens":w.maxTokens,"gen_ai.request.presence_penalty":w.presencePenalty,"gen_ai.request.temperature":w.temperature,"gen_ai.request.top_k":w.topK,"gen_ai.request.top_p":w.topP}}),tracer:_,fn:async Gt=>{var Rt,Nt,At,Ot,Ct,ke,Le,ms;let Ce=await e.doGenerate({mode:{type:"object-tool",tool:{type:"function",name:a??"json",description:r??"Respond with a JSON object.",parameters:T.jsonSchema}},...Cn(w),inputFormat:oe,prompt:je,providerMetadata:m,abortSignal:l,headers:f}),Sa=(Nt=(Rt=Ce.toolCalls)==null?void 0:Rt[0])==null?void 0:Nt.args,lt={id:(Ot=(At=Ce.response)==null?void 0:At.id)!=null?Ot:g(),timestamp:(ke=(Ct=Ce.response)==null?void 0:Ct.timestamp)!=null?ke:x(),modelId:(ms=(Le=Ce.response)==null?void 0:Le.modelId)!=null?ms:e.modelId};if(Sa===void 0)throw new We({message:"No object generated: the tool was not called.",response:lt,usage:gt(Ce.usage),finishReason:Ce.finishReason});return Gt.setAttributes(ft({telemetry:k,attributes:{"ai.response.finishReason":Ce.finishReason,"ai.response.object":{output:()=>Sa},"ai.response.id":lt.id,"ai.response.model":lt.modelId,"ai.response.timestamp":lt.timestamp.toISOString(),"ai.usage.promptTokens":Ce.usage.promptTokens,"ai.usage.completionTokens":Ce.usage.completionTokens,"gen_ai.response.finish_reasons":[Ce.finishReason],"gen_ai.response.id":lt.id,"gen_ai.response.model":lt.modelId,"gen_ai.usage.input_tokens":Ce.usage.promptTokens,"gen_ai.usage.output_tokens":Ce.usage.completionTokens}})),{...Ce,objectText:Sa,responseData:lt}}}));N=we.objectText,W=we.finishReason,G=we.usage,ge=we.warnings,V=we.rawResponse,Z=we.logprobs,Ie=we.providerMetadata,U=(J=we.request)!=null?J:{},z=we.responseData;break}case void 0:throw Error("Model does not have a default object generation mode.");default:throw Error(`Unsupported mode: ${o}`)}function Me(re){let je=mt({text:re});if(!je.success)throw new We({message:"No object generated: could not parse the response.",cause:je.error,text:re,response:z,usage:gt(G),finishReason:W});let oe=T.validateFinalResult(je.value,{text:re,response:z,usage:gt(G)});if(!oe.success)throw new We({message:"No object generated: response did not match schema.",cause:oe.error,text:re,response:z,usage:gt(G),finishReason:W});return oe.value}try{be=Me(N)}catch(re){if(j!=null&&We.isInstance(re)&&(bt.isInstance(re.cause)||Be.isInstance(re.cause))){let je=await j({text:N,error:re.cause});if(je===null)throw re;be=Me(je)}else throw re}return y.setAttributes(ft({telemetry:k,attributes:{"ai.response.finishReason":W,"ai.response.object":{output:()=>JSON.stringify(be)},"ai.usage.promptTokens":G.promptTokens,"ai.usage.completionTokens":G.completionTokens}})),new jo({object:be,finishReason:W,usage:gt(G),warnings:ge,request:U,response:{...z,headers:V?.headers,body:V?.body},logprobs:Z,providerMetadata:Ie})}})}var jo=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.experimental_providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.logprobs=e.logprobs}toJsonResponse(e){var t;return new Response(JSON.stringify(this.object),{status:(t=e?.status)!=null?t:200,headers:ca(e?.headers,{contentType:"application/json; charset=utf-8"})})}},Yc=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise||(this.promise=new Promise((e,t)=>{this.status.type==="resolved"?e(this.status.value):this.status.type==="rejected"&&t(this.status.error),this._resolve=e,this._reject=t})),this.promise}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&((t=this._resolve)==null||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&((t=this._reject)==null||t.call(this,e))}};function qn(){let e,t;return{promise:new Promise((s,a)=>{e=s,t=a}),resolve:e,reject:t}}function $c(){let e=[],t=null,s=!1,a=qn(),r=async()=>{if(s&&e.length===0){t?.close();return}if(e.length===0)return a=qn(),await a.promise,r();try{let{value:o,done:i}=await e[0].read();i?(e.shift(),e.length>0?await r():s&&t?.close()):t?.enqueue(o)}catch(o){t?.error(o),e.shift(),s&&e.length===0&&t?.close()}};return{stream:new ReadableStream({start(o){t=o},pull:r,async cancel(){for(let o of e)await o.cancel();e=[],s=!0}}),addStream:o=>{if(s)throw Error("Cannot add inner stream: outer stream is closed");e.push(o.getReader()),a.resolve()},close:()=>{s=!0,a.resolve(),e.length===0&&t?.close()},terminate:()=>{s=!0,a.resolve(),e.forEach(o=>o.cancel()),e=[],t?.close()}}}st({prefix:"aiobj",size:24});var Fn="AI_NoOutputSpecifiedError",Ln=`vercel.ai.error.${Fn}`,Eo=Symbol.for(Ln),Dc=class extends R{constructor({message:e="No output specified."}={}){super({name:Fn,message:e}),this[Ye]=!0}static isInstance(e){return R.hasMarker(e,Ln)}};Ye=Eo;var Zn="AI_ToolExecutionError",zn=`vercel.ai.error.${Zn}`,So=Symbol.for(zn),Uc=class extends R{constructor({toolArgs:e,toolName:t,toolCallId:s,cause:a,message:r=`Error executing tool ${t}: ${ve(a)}`}){super({name:Zn,message:r,cause:a}),this[tt]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=s}static isInstance(e){return R.hasMarker(e,zn)}};tt=So;var qc=/^([\s\S]*?)(\s+)(\S*)$/,Bn="AI_InvalidToolArgumentsError",Vn=`vercel.ai.error.${Bn}`,To=Symbol.for(Vn),Kn=class extends R{constructor({toolArgs:e,toolName:t,cause:s,message:a=`Invalid arguments for tool ${t}: ${ve(s)}`}){super({name:Bn,message:a,cause:s}),this[Ne]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return R.hasMarker(e,Vn)}};Ne=To;var Hn="AI_NoSuchToolError",Jn=`vercel.ai.error.${Hn}`,Ro=Symbol.for(Jn),ya=class extends R{constructor({toolName:e,availableTools:t,message:s=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:Hn,message:s}),this[E]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return R.hasMarker(e,Jn)}};E=Ro;var Wn="AI_ToolCallRepairError",Gn=`vercel.ai.error.${Wn}`,No=Symbol.for(Gn),Ao=class extends R{constructor({cause:e,originalError:t,message:s=`Error repairing tool call: ${ve(e)}`}){super({name:Wn,message:s,cause:e}),this[Q]=!0,this.originalError=t}static isInstance(e){return R.hasMarker(e,Gn)}};async function Fc({toolCall:e,tools:t,repairToolCall:s,system:a,messages:r}){if(t==null)throw new ya({toolName:e.toolName});try{return await Xn({toolCall:e,tools:t})}catch(o){if(s==null||!(ya.isInstance(o)||Kn.isInstance(o)))throw o;let i=null;try{i=await s({toolCall:e,tools:t,parameterSchema:({toolName:u})=>asSchema3(t[u].parameters).jsonSchema,system:a,messages:r,error:o})}catch(u){throw new Ao({cause:u,originalError:o})}if(i==null)throw o;return await Xn({toolCall:i,tools:t})}}async function Xn({toolCall:e,tools:t}){let s=e.toolName,a=t[s];if(a==null)throw new ya({toolName:e.toolName,availableTools:Object.keys(t)});let r=asSchema3(a.parameters),o=e.args.trim()===""?safeValidateTypes3({value:{},schema:r}):safeParseJSON2({text:e.args,schema:r});if(o.success===!1)throw new Kn({toolName:s,toolArgs:e.args,cause:o.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:s,args:o.value}}function Lc({text:e="",files:t,reasoning:s,tools:a,toolCalls:r,toolResults:o,messageId:i,generateMessageId:u}){let c=[],d=[];return s.length>0&&d.push(...s.map(p=>p.type==="text"?{...p,type:"reasoning"}:{...p,type:"redacted-reasoning"})),t.length>0&&d.push(...t.map(p=>({type:"file",data:p.base64,mimeType:p.mimeType}))),e.length>0&&d.push({type:"text",text:e}),r.length>0&&d.push(...r),d.length>0&&c.push({role:"assistant",content:d,id:i}),o.length>0&&c.push({role:"tool",id:u(),content:o.map(p=>{let l=a[p.toolName];return l?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:p.toolCallId,toolName:p.toolName,result:l.experimental_toToolResultContent(p.result),experimental_content:l.experimental_toToolResultContent(p.result)}:{type:"tool-result",toolCallId:p.toolCallId,toolName:p.toolName,result:p.result}})}),c}Q=No,st({prefix:"aitxt",size:24}),st({prefix:"msg",size:24}),ua({},{object:()=>Po,text:()=>Mo});var Qn="AI_InvalidStreamPartError",es=`vercel.ai.error.${Qn}`,Oo=Symbol.for(es),Zc=class extends R{constructor({chunk:e,message:t}){super({name:Qn,message:t}),this[L]=!0,this.chunk=e}static isInstance(e){return R.hasMarker(e,es)}};L=Oo;var ts="vercel.ai.error.AI_MCPClientError",Co=Symbol.for(ts),_t=class extends R{constructor({name:e="MCPClientError",message:t,cause:s}){super({name:e,message:t,cause:s}),this[D]=!0}static isInstance(e){return R.hasMarker(e,ts)}};D=Co;var Mo=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt:({system:e})=>e,parsePartial:({text:e})=>({partial:e}),parseOutput:({text:e})=>e}),Po=({schema:e})=>{let t=la(e);return{type:"object",responseFormat:({model:s})=>({type:"json",schema:s.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt:({system:s,model:a})=>a.supportsStructuredOutputs?s:_a({prompt:s,schema:t.jsonSchema}),parsePartial({text:s}){let a=Ar(s);switch(a.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:a.value};default:{let r=a.state;throw Error(`Unsupported parse state: ${r}`)}}},parseOutput({text:s},a){let r=mt({text:s});if(!r.success)throw new We({message:"No object generated: could not parse the response.",cause:r.error,text:s,response:a.response,usage:a.usage,finishReason:a.finishReason});let o=Je({value:r.value,schema:t});if(!o.success)throw new We({message:"No object generated: response did not match schema.",cause:o.error,text:s,response:a.response,usage:a.usage,finishReason:a.finishReason});return o.value}}};async function zc({stream:e,onError:t}){let s=e.getReader();try{for(;;){let{done:a}=await s.read();if(a)break}}catch(a){t?.(a)}finally{s.releaseLock()}}function as(e,t){let s,a,r=e.getReader(),o=t.getReader(),i=!1,u=!1;async function c(p){try{s==null&&(s=r.read());let l=await s;s=void 0,l.done?p.close():p.enqueue(l.value)}catch(l){p.error(l)}}async function d(p){try{a==null&&(a=o.read());let l=await a;a=void 0,l.done?p.close():p.enqueue(l.value)}catch(l){p.error(l)}}return new ReadableStream({async pull(p){try{if(i)return void await d(p);if(u)return void await c(p);s==null&&(s=r.read()),a==null&&(a=o.read());let{result:l,reader:f}=await Promise.race([s.then(j=>({result:j,reader:r})),a.then(j=>({result:j,reader:o}))]);l.done||p.enqueue(l.value),f===r?(s=void 0,l.done&&(await d(p),i=!0)):(a=void 0,l.done&&(u=!0,await c(p)))}catch(l){p.error(l)}},cancel(){r.cancel(),o.cancel()}})}st({prefix:"aitxt",size:24}),st({prefix:"msg",size:24});var ns="AI_NoSuchProviderError",ss=`vercel.ai.error.${ns}`,Yo=Symbol.for(ss),Bc=class extends Is{constructor({modelId:e,modelType:t,providerId:s,availableProviders:a,message:r=`No such provider: ${s} (available providers: ${a.join()})`}){super({errorName:ns,modelId:e,modelType:t,message:r}),this[ue]=!0,this.providerId=s,this.availableProviders=a}static isInstance(e){return R.hasMarker(e,ss)}};ue=Yo;var $o="2024-11-05",Vc=[$o,"2024-10-07"],Do=n.Ik({name:n.Yj(),version:n.Yj()}).passthrough(),ot=n.Ik({_meta:n.lq(n.Ik({}).passthrough())}).passthrough(),Uo=n.Ik({method:n.Yj(),params:n.lq(ot)}),qo=n.Ik({experimental:n.lq(n.Ik({}).passthrough()),logging:n.lq(n.Ik({}).passthrough()),prompts:n.lq(n.Ik({listChanged:n.lq(n.zM())}).passthrough()),resources:n.lq(n.Ik({subscribe:n.lq(n.zM()),listChanged:n.lq(n.zM())}).passthrough()),tools:n.lq(n.Ik({listChanged:n.lq(n.zM())}).passthrough())}).passthrough(),Kc=ot.extend({protocolVersion:n.Yj(),capabilities:qo,serverInfo:Do,instructions:n.lq(n.Yj())}),Fo=ot.extend({nextCursor:n.lq(n.Yj())}),Lo=n.Ik({name:n.Yj(),description:n.lq(n.Yj()),inputSchema:n.Ik({type:n.eu("object"),properties:n.lq(n.Ik({}).passthrough())}).passthrough()}).passthrough(),Hc=Fo.extend({tools:n.YO(Lo)}),Zo=n.Ik({type:n.eu("text"),text:n.Yj()}).passthrough(),zo=n.Ik({type:n.eu("image"),data:n.Yj().base64(),mimeType:n.Yj()}).passthrough(),rs=n.Ik({uri:n.Yj(),mimeType:n.lq(n.Yj())}).passthrough(),Bo=rs.extend({text:n.Yj()}),Vo=rs.extend({blob:n.Yj().base64()}),Ko=n.Ik({type:n.eu("resource"),resource:n.KC([Bo,Vo])}).passthrough(),Jc=ot.extend({content:n.YO(n.KC([Zo,zo,Ko])),isError:n.zM().default(!1).optional()}).or(ot.extend({toolResult:n.L5()})),Ho=n.Ik({jsonrpc:n.eu("2.0"),id:n.KC([n.Yj(),n.ai().int()])}).merge(Uo).strict(),Jo=n.Ik({jsonrpc:n.eu("2.0"),id:n.KC([n.Yj(),n.ai().int()]),result:ot}).strict(),Wo=n.Ik({jsonrpc:n.eu("2.0"),id:n.KC([n.Yj(),n.ai().int()]),error:n.Ik({code:n.ai().int(),message:n.Yj(),data:n.lq(n.L5())})}).strict(),Go=n.Ik({jsonrpc:n.eu("2.0")}).merge(n.Ik({method:n.Yj(),params:n.lq(ot)})).strict(),Xo=n.KC([Ho,Go,Jo,Wo]),Wc=class{constructor({url:e,headers:t}){this.connected=!1,this.url=new URL(e),this.headers=t}async start(){return new Promise((e,t)=>{if(this.connected)return e();this.abortController=new AbortController,(async()=>{var s,a,r;try{let o=new Headers(this.headers);o.set("Accept","text/event-stream");let i=await fetch(this.url.href,{headers:o,signal:(s=this.abortController)==null?void 0:s.signal});if(!i.ok||!i.body){let d=new _t({message:`MCP SSE Transport Error: ${i.status} ${i.statusText}`});return(a=this.onerror)==null||a.call(this,d),t(d)}let u=i.body.pipeThrough(new TextDecoderStream).pipeThrough(createEventSourceParserStream()).getReader(),c=async()=>{var d,p,l;try{for(;;){let{done:f,value:j}=await u.read();if(f){if(this.connected)throw this.connected=!1,new _t({message:"MCP SSE Transport Error: Connection closed unexpectedly"});return}let{event:k,data:h}=j;if(k==="endpoint"){if(this.endpoint=new URL(h,this.url),this.endpoint.origin!==this.url.origin)throw new _t({message:`MCP SSE Transport Error: Endpoint origin does not match connection origin: ${this.endpoint.origin}`});this.connected=!0,e()}else if(k==="message")try{let m=Xo.parse(JSON.parse(h));(d=this.onmessage)==null||d.call(this,m)}catch(m){let g=new _t({message:"MCP SSE Transport Error: Failed to parse message",cause:m});(p=this.onerror)==null||p.call(this,g)}}}catch(f){if(f instanceof Error&&f.name==="AbortError")return;(l=this.onerror)==null||l.call(this,f),t(f)}};this.sseConnection={close:()=>u.cancel()},c()}catch(o){if(o instanceof Error&&o.name==="AbortError")return;(r=this.onerror)==null||r.call(this,o),t(o)}})()})}async close(){var e,t,s;this.connected=!1,(e=this.sseConnection)==null||e.close(),(t=this.abortController)==null||t.abort(),(s=this.onclose)==null||s.call(this)}async send(e){var t,s,a;if(!this.endpoint||!this.connected)throw new _t({message:"MCP SSE Transport Error: Not connected"});try{let r=new Headers(this.headers);r.set("Content-Type","application/json");let o={method:"POST",headers:r,body:JSON.stringify(e),signal:(t=this.abortController)==null?void 0:t.signal},i=await fetch(this.endpoint,o);if(!i.ok){let u=await i.text().catch(()=>null),c=new _t({message:`MCP SSE Transport Error: POSTing to endpoint (HTTP ${i.status}): ${u}`});(s=this.onerror)==null||s.call(this,c);return}}catch(r){(a=this.onerror)==null||a.call(this,r);return}}};function os(e={}){let t=new TextEncoder,s="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(a,r){r.enqueue(t.encode(a)),s+=a,e.onToken&&await e.onToken(a),e.onText&&typeof a=="string"&&await e.onText(a)},async flush(){e.onCompletion&&await e.onCompletion(s),e.onFinal&&await e.onFinal(s)}})}function ka(e,t){return e.pipeThrough(new TransformStream({transform:async(s,a)=>{var r;if(typeof s=="string")return void a.enqueue(s);if("event"in s){s.event==="on_chat_model_stream"&&is((r=s.data)==null?void 0:r.chunk,a);return}is(s,a)}})).pipeThrough(os(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(s,a)=>{a.enqueue(fn("text",s))}}))}function Qo(e,t){return ka(e,t).pipeThrough(new TextEncoderStream)}function ei(e,t){var s;let a=ka(e,t?.callbacks).pipeThrough(new TextEncoderStream),r=t?.data,o=t?.init;return new Response(r?as(r.stream,a):a,{status:(s=o?.status)!=null?s:200,statusText:o?.statusText,headers:ca(o?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function ti(e,t){t.dataStream.merge(ka(e,t.callbacks))}function is(e,t){if(typeof e.content=="string")t.enqueue(e.content);else for(let s of e.content)s.type==="text"&&t.enqueue(s.text)}function va(e,t){var s;let a,r=(a=!0,o=>(a&&(o=o.trimStart())&&(a=!1),o));return(s=e[Symbol.asyncIterator](),new ReadableStream({async pull(o){try{let{value:i,done:u}=await s.next();u?o.close():o.enqueue(i)}catch(i){o.error(i)}},cancel(){}})).pipeThrough(new TransformStream({async transform(o,i){i.enqueue(r(o.delta))}})).pipeThrough(os(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(o,i)=>{i.enqueue(fn("text",o))}}))}function ai(e,t){return va(e,t).pipeThrough(new TextEncoderStream)}function ni(e,t={}){var s;let{init:a,data:r,callbacks:o}=t,i=va(e,o).pipeThrough(new TextEncoderStream);return new Response(r?as(r.stream,i):i,{status:(s=a?.status)!=null?s:200,statusText:a?.statusText,headers:ca(a?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function si(e,t){t.dataStream.merge(va(e,t.callbacks))}ua({},{mergeIntoDataStream:()=>ti,toDataStream:()=>Qo,toDataStreamResponse:()=>ei}),ua({},{mergeIntoDataStream:()=>si,toDataStream:()=>ai,toDataStreamResponse:()=>ni});var ri=S(51817),ls=S(52748),oi=S(22710),ba=S(2793);let us="rate-limit:";async function cs(e){let t=await(0,oi.b3)(),s=t.get("x-real-ip")??t.get("x-forwarded-for")??"127.0.0.1";return e?`${s}:${e}`:s}function wa(){let e=new Date;return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())}async function ii(e){let t=await cs(e),s=`${us}${t}:${wa()}`,a=await ba.Yh.get(s);return a?Number.parseInt(a,10):0}async function li(e){let t=await cs(e),s=`${us}${t}:${wa()}`,a=await ba.Yh.incr(s);return a===1&&await ba.Yh.expire(s,function(){let r=new Date;return Math.floor((new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate()+1)).getTime()-r.getTime())/1e3)}()),a}async function ps(e,t=!1){return{remaining:Math.max(0,3-(t?await li(e):await ii(e))),reset:wa()+864e5,total:3}}function it(e,t){function s(r){return t?[t(r),void 0]:[r instanceof Error?r:Error(String(r)),void 0]}function a(r){return[void 0,r]}if(typeof e=="function")try{return a(e())}catch(r){return s(r)}return e.then(a).catch(s)}n.Ik({query:n.Yj().min(1,"\u641C\u7D22\u5173\u952E\u8BCD\u4E0D\u80FD\u4E3A\u7A7A").max(100,"\u641C\u7D22\u5173\u952E\u8BCD\u8FC7\u957F").describe("\u8981\u641C\u7D22\u7684\u5173\u952E\u8BCD\uFF0C\u5FC5\u987B\u4F7F\u7528\u82F1\u6587")});let ui=n.Ik({title:n.Yj(),link:n.Yj().url()}),ci=n.Ik({title:n.Yj(),link:n.Yj().url(),snippet:n.Yj().optional(),sitelinks:n.YO(ui).optional(),position:n.ai()}),pi=n.Ik({question:n.Yj(),snippet:n.Yj().optional(),title:n.Yj(),link:n.Yj().url()}),di=n.Ik({knowledgeGraph:n.Ik({title:n.Yj(),type:n.Yj().optional(),website:n.Yj().url().optional(),imageUrl:n.Yj().url().optional(),description:n.Yj().optional(),descriptionSource:n.Yj().optional(),descriptionLink:n.Yj().url().optional(),attributes:n.g1(n.Yj()).optional()}).optional(),organic:n.YO(ci),peopleAlsoAsk:n.YO(pi).optional(),relatedSearches:n.YO(n.Ik({query:n.Yj()})).optional()});n.Ik({query:n.Yj(),knowledgeGraph:n.Ik({title:n.Yj(),description:n.Yj().optional(),imageUrl:n.Yj().url().optional(),attributes:n.g1(n.Yj()).optional()}).optional(),topResults:n.YO(n.Ik({title:n.Yj(),link:n.Yj().url(),snippet:n.Yj().optional(),position:n.ai()})),relatedQuestions:n.YO(n.Ik({question:n.Yj(),answer:n.Yj().optional()})).optional(),relatedSearches:n.YO(n.Yj()).optional()});let mi=e=>di.parse(e),xa=ls._.SERPER_API_KEY;async function hi(e,t){if(!xa)throw Error("Missing SERPER_API_KEY");if(!t?.length){let[a,r]=await it(Ia(e));return a?(console.error("\u666E\u901A\u641C\u7D22\u5931\u8D25:",a),[]):[r]}let s=[...t.map(a=>Ia(`site:${a} ${e}`)),Ia(e)];return(await Promise.all(s.map(async a=>{let[r,o]=await it(a);return r?(console.error("\u641C\u7D22\u5931\u8D25:",r),[]):o}))).filter(a=>a.length>0)}async function Ia(e){if(!xa)throw Error("Missing SERPER_API_KEY");let[t,s]=await it(fetch("https://google.serper.dev/search",{method:"POST",headers:{"X-API-KEY":xa,"Content-Type":"application/json"},body:JSON.stringify({q:e,gl:"us",hl:"en",num:10})}));if(t)return console.error(`API \u8BF7\u6C42\u5931\u8D25 (${e}):`,t),[];if(!s.ok)return console.error(`\u641C\u7D22\u5931\u8D25: ${s.statusText}`),[];let[a,r]=await it(s.json());if(a)return console.error(`\u89E3\u6790\u54CD\u5E94\u5931\u8D25 (${e}):`,a),[];let[o,i]=it(()=>mi(r));return o?(console.error(`\u9A8C\u8BC1\u54CD\u5E94\u5931\u8D25 (${e}):`,o),[]):i.organic}var fi=S(37076);let ds=n.Ik({keyword:n.Yj().min(1).describe("Keyword from the original text, should be exactly the same, including case and format."),query:n.Yj().min(1).describe("Used to search for the best external link on Google, should be a question."),reason:n.Yj().describe("Convince the reader to explore this link behind the keyword or phrase, around 150 characters.")});async function ja(e,t,s=0,a,r,o,i){let u,c,d=await(0,ri.j2)(),p=!!d?.user,l=d?.user?.email??i??null;if(!p&&!a&&!l){let{remaining:g}=await ps(t,!1);if(g<=0)return{error:{code:"RATE_LIMITED",message:"\u672A\u6CE8\u518C\u7528\u6237\u6BCF\u65E5\u4F7F\u7528\u6B21\u6570\u6709\u9650\uFF0C\u8BF7\u767B\u5F55\u540E\u7EE7\u7EED\u4F7F\u7528\u6216\u8BBE\u7F6E\u60A8\u81EA\u5DF1\u7684 API Key"}}}let f=Math.min(Math.max(2,Math.min(20,2*Math.floor(e.length/1e3))),Math.max(0,20-s));if(f===0)return{error:{code:"AI_ERROR",message:"\u5DF2\u8FBE\u5230\u5173\u952E\u8BCD\u6570\u91CF\u4E0A\u9650\uFF0820\u4E2A\uFF09\uFF0C\u65E0\u6CD5\u6DFB\u52A0\u66F4\u591A\u5173\u952E\u8BCD"}};let j=n.Ik({keywords:n.YO(ds).min(Math.min(f,2)).max(f).describe(`Extract exactly ${f} most important keywords/phrases from the text. Each keyword should be unique and valuable for SEO.`)});if(a)u=rn({apiKey:a,baseURL:r})(o||"gpt-4o-mini");else{if(!ls._.OPENAI_API_KEY)return{error:{code:"AI_ERROR",message:"\u8BF7\u5148\u8BBE\u7F6E\u60A8\u7684 OpenAI API Key"}};u=mr(o||"gpt-4o-mini")}let[k,h]=await it(Io({model:u,system:`
    You are a SEO expert, you need to:
    1. Select exactly ${f} most valuable keywords/phrases from the text (never select from the heading or title)
    2. For each keyword:
      - Extract the exact keyword or phrase from the text (maintain original case and format). Each should be unique, never repeat.
      - Generate a search query in question form to find the best external link
      - Provide a brief convincing reason for the reader why they should explore the resource link
    
    IMPORTANT: You MUST extract exactly ${f} keywords, no more, no less.`,prompt:e,schema:j}),g=>Error("\u5206\u6790\u6587\u672C\u5931\u8D25",{cause:g}));if(k||p||a||await ps(t,!0),k)return console.error("\u5173\u952E\u8BCD\u5206\u6790\u5931\u8D25:",k),{error:{code:"AI_ERROR",message:function(g){let x=function(v){let I=[],T=[v],M=new Set;for(;T.length>0;){let _=T.shift();if(_==null)continue;let y=typeof _=="object"||typeof _=="function";if(y){if(M.has(_))continue;M.add(_)}if(I.push(_),_ instanceof Error&&_.cause&&T.push(_.cause),y){"cause"in _&&_.cause!=null&&T.push(_.cause);let $=_.errors;Array.isArray($)&&T.push(...$),"lastError"in _&&_.lastError!=null&&T.push(_.lastError)}}return I}(g);if(x.some(v=>{if(v instanceof Error){let I=v.message.toLowerCase();if(I.includes("connect timeout")||I.includes("timeout"))return!0}if(v&&typeof v=="object"){let I=v.code;if(I&&typeof I=="string"&&I==="UND_ERR_CONNECT_TIMEOUT")return!0;let T=v.reason,M=v.errors;if(typeof T=="string"&&T==="maxRetriesExceeded"&&Array.isArray(M))return M.some(y=>{if(!y||typeof y!="object")return!1;let $=y.code;return typeof $=="string"&&$==="UND_ERR_CONNECT_TIMEOUT"});let _=typeof v.statusCode=="number"?v.statusCode:typeof v.status=="number"?v.status:void 0;if(_===408||_===504)return!0}return!1}))return"\u5173\u952E\u8BCD\u5206\u6790\u5931\u8D25\uFF1A\u65E0\u6CD5\u8FDE\u63A5\u5230 OpenAI \u670D\u52A1\uFF08\u7F51\u7EDC\u8D85\u65F6\uFF09\u3002\u8BF7\u68C0\u67E5\u7F51\u7EDC\uFF0C\u6216\u5728\u8BBE\u7F6E\u9875\u9762\u914D\u7F6E\u53EF\u7528\u7684 API Key / Base URL \u540E\u518D\u8BD5\u3002";if(x.some(v=>!!v&&typeof v=="object"&&(typeof v.statusCode=="number"?v.statusCode:typeof v.status=="number"?v.status:void 0)===401))return"\u5173\u952E\u8BCD\u5206\u6790\u5931\u8D25\uFF1AOpenAI API \u8BA4\u8BC1\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5 API Key \u662F\u5426\u6709\u6548\u3002";if(x.some(v=>!!v&&typeof v=="object"&&(typeof v.statusCode=="number"?v.statusCode:typeof v.status=="number"?v.status:void 0)===403))return"\u5173\u952E\u8BCD\u5206\u6790\u5931\u8D25\uFF1AOpenAI API \u62D2\u7EDD\u8BBF\u95EE\uFF0C\u8BF7\u786E\u8BA4\u8D26\u53F7\u6743\u9650\u6216\u4F59\u989D\u3002";let w=x.map(v=>v instanceof Error?v.message:void 0).find(v=>v&&v!==g.message&&v!=="\u5206\u6790\u6587\u672C\u5931\u8D25");return w?`\u5173\u952E\u8BCD\u5206\u6790\u5931\u8D25\uFF1A${w}`:"\u5173\u952E\u8BCD\u5206\u6790\u5931\u8D25\uFF1A\u8BF7\u7A0D\u540E\u91CD\u8BD5\u3002"}(k)}};let m=h.object.keywords.map(g=>({...g,link:null,title:null}));if(l){let g=h.usage.totalTokens??0;if(g>0)try{let x=await(0,fi.L9)(l,g);c={costCharged:x.cost,remainingBalance:x.balance}}catch(x){return{error:{code:"AI_ERROR",message:x instanceof Error?x.message:"\u4F59\u989D\u6263\u8D39\u5931\u8D25\uFF0C\u8BF7\u5145\u503C\u540E\u91CD\u8BD5"}}}}return{data:{keywords:m,usage:{promptTokens:h.usage.promptTokens,completionTokens:h.usage.completionTokens,totalTokens:h.usage.totalTokens},billing:c}}}async function Ea(e,t,s){let a={};return await Promise.all(e.map(async({keyword:r,query:o})=>{let[i,u]=await it(hi(o,s));if(i||!u?.length)return;let[c,d]=u.flat().filter(l=>{try{let f=new URL(l.link).hostname.replace(/^www\./,"");return!t.includes(f)}catch{return!1}}).reduce((l,f)=>{try{let j=new URL(f.link).hostname.replace(/^www\./,"");return s.includes(j)?[[...l[0],f],l[1]]:[l[0],[...l[1],f]]}catch{return l}},[[],[]]),p=c[0]??d[0];p&&(a[r]={link:p.link,title:p.title,alternatives:{preferred:c,regular:d}})})),a}ds.extend({link:n.Yj().url().nullable(),title:n.Yj().nullable()}),(0,S(78446).D)([ja,Ea]),(0,de.A)(ja,"7fac6c6034cd81c225371fb5bc72d5b53fae0269d4",null),(0,de.A)(Ea,"7054a05d6b3fa459cdf8848e85a29e363c666f3ce3",null)},78335:Ui,96487:Di},pe=>{var he=O=>pe(pe.s=O);pe.O(0,[64,988,949,683,581,432,86,799,24,76],()=>he(59311));var S=pe.O();(te._ENTRIES=typeof te._ENTRIES>"u"?{}:te._ENTRIES)["middleware_app/api/external-links/route"]=S}]),function(){let pe={exports:{},loaded:!1};return function(S,O){var F=Object.create,Y=Object.defineProperty,se=Object.getOwnPropertyDescriptor,ie=Object.getOwnPropertyNames,ee=Object.getPrototypeOf,le=Object.prototype.hasOwnProperty,B=E=>Y(E,"__esModule",{value:!0}),ne=(E,Q)=>{B(E);for(var L in Q)Y(E,L,{get:Q[L],enumerable:!0})},K=(E,Q,L)=>{if(Q&&typeof Q=="object"||typeof Q=="function")for(let D of ie(Q))!le.call(E,D)&&D!=="default"&&Y(E,D,{get:()=>Q[D],enumerable:!(L=se(Q,D))||L.enumerable});return E},H=E=>K(B(Y(E!=null?F(ee(E)):{},"default",E&&E.__esModule&&"default"in E?{get:()=>E.default,enumerable:!0}:{value:E,enumerable:!0})),E);ne(O,{default:()=>et});var ye=H((fs(),vi(Mt))),Ee="@next/request-context",xe=Symbol.for(Ee),Pe=Symbol.for("internal.storage");function Ze(){let E=te;if(!E[xe]){let Q=new ye.AsyncLocalStorage,L={get:()=>Q.getStore(),[Pe]:Q};E[xe]=L}return E[xe]}var Xe=Ze();function ct(E,Q){return Xe[Pe].run(E,Q)}function Ke(E){let Q={};return E&&E.forEach((L,D)=>{Q[D]=L,D.toLowerCase()==="set-cookie"&&(Q[D]=Qe(L))}),Q}function Qe(E){let Q=[],L=0,D,ue,de,_e,$e;function Se(){for(;L<E.length&&/\s/.test(E.charAt(L));)L+=1;return L<E.length}function R(){return ue=E.charAt(L),ue!=="="&&ue!==";"&&ue!==","}for(;L<E.length;){for(D=L,$e=!1;Se();)if(ue=E.charAt(L),ue===","){for(de=L,L+=1,Se(),_e=L;L<E.length&&R();)L+=1;L<E.length&&E.charAt(L)==="="?($e=!0,L=_e,Q.push(E.substring(D,de)),D=L):L=de+1}else L+=1;(!$e||L>=E.length)&&Q.push(E.substring(D,E.length))}return Q}function et(E){let Q=E.staticRoutes.map(D=>({regexp:new RegExp(D.namedRegex),page:D.page})),L=E.dynamicRoutes?.map(D=>({regexp:new RegExp(D.namedRegex),page:D.page}))||[];return async function(D,ue){let de=new URL(D.url).pathname,_e={};if(E.nextConfig?.basePath&&de.startsWith(E.nextConfig.basePath)&&(de=de.replace(E.nextConfig.basePath,"")||"/"),E.nextConfig?.i18n)for(let Se of E.nextConfig.i18n.locales){let R=new RegExp(`^/${Se}($|/)`,"i");if(de.match(R)){de=de.replace(R,"/")||"/";break}}for(let Se of Q)if(Se.regexp.exec(de)){_e.name=Se.page;break}if(!_e.name){let Se=tt(de);for(let R of L||[]){if(Se&&!tt(R.page))continue;let at=R.regexp.exec(de);if(at){_e={name:R.page,params:at.groups};break}}}let $e=await ct({waitUntil:ue.waitUntil},()=>te._ENTRIES[`middleware_${E.name}`].default.call({},{request:{url:D.url,method:D.method,headers:Ke(D.headers),ip:Ye(D.headers,Ne.Ip),geo:{city:Ye(D.headers,Ne.City,!0),country:Ye(D.headers,Ne.Country,!0),latitude:Ye(D.headers,Ne.Latitude),longitude:Ye(D.headers,Ne.Longitude),region:Ye(D.headers,Ne.Region,!0)},nextConfig:E.nextConfig,page:_e,body:D.body}}));return $e.waitUntil&&ue.waitUntil($e.waitUntil),$e.response}}function Ye(E,Q,L=!1){let D=E.get(Q)||void 0;return L&&D?decodeURIComponent(D):D}function tt(E){return E==="/api"||E.startsWith("/api/")}var Ne;(function(E){E.City="x-vercel-ip-city",E.Country="x-vercel-ip-country",E.Ip="x-real-ip",E.Latitude="x-vercel-ip-latitude",E.Longitude="x-vercel-ip-longitude",E.Region="x-vercel-ip-country-region"})(Ne||(Ne={}))}(pe,pe.exports),pe.exports}.call({}).default({name:"app/api/external-links/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/admin",regex:"^/admin(?:/)?$",routeKeys:{},namedRegex:"^/admin(?:/)?$"},{page:"/auth/error",regex:"^/auth/error(?:/)?$",routeKeys:{},namedRegex:"^/auth/error(?:/)?$"},{page:"/checkout",regex:"^/checkout(?:/)?$",routeKeys:{},namedRegex:"^/checkout(?:/)?$"},{page:"/editor",regex:"^/editor(?:/)?$",routeKeys:{},namedRegex:"^/editor(?:/)?$"},{page:"/favicon.ico",regex:"^/favicon\\.ico(?:/)?$",routeKeys:{},namedRegex:"^/favicon\\.ico(?:/)?$"},{page:"/keys",regex:"^/keys(?:/)?$",routeKeys:{},namedRegex:"^/keys(?:/)?$"},{page:"/login",regex:"^/login(?:/)?$",routeKeys:{},namedRegex:"^/login(?:/)?$"},{page:"/logout",regex:"^/logout(?:/)?$",routeKeys:{},namedRegex:"^/logout(?:/)?$"},{page:"/settings",regex:"^/settings(?:/)?$",routeKeys:{},namedRegex:"^/settings(?:/)?$"},{page:"/thanks",regex:"^/thanks(?:/)?$",routeKeys:{},namedRegex:"^/thanks(?:/)?$"},{page:"/verify-request",regex:"^/verify\\-request(?:/)?$",routeKeys:{},namedRegex:"^/verify\\-request(?:/)?$"}],dynamicRoutes:[{page:"/api/auth/[...nextauth]",regex:"^/api/auth/(.+?)(?:/)?$",routeKeys:{nxtPnextauth:"nxtPnextauth"},namedRegex:"^/api/auth/(?<nxtPnextauth>.+?)(?:/)?$"}],nextConfig:{basePath:""}})))(C,C,C);export{gp as default};
